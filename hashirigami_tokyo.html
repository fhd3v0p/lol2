<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ëµ∞„ÇäÁ¥ô | SHADOW RUNNERS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap');
        
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #16161d;
            --bg-tertiary: #1e1e2e;
            --text-primary: #ff6b35;
            --text-secondary: #888;
            --accent-red: #ff2d55;
            --accent-purple: #af52de;
            --accent-blue: #007aff;
            --shadow-color: rgba(255, 45, 85, 0.3);
            --glow-color: rgba(255, 107, 53, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            color: var(--text-primary);
            font-family: 'Share Tech Mono', 'Noto Sans JP', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* –¢–µ–Ω–µ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –±–µ–≥—É—â–∏—Ö —Ç–µ–Ω–µ–π */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: -100%;
            width: 300%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 45, 85, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 30%, rgba(175, 82, 222, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 70%, rgba(255, 107, 53, 0.1) 0%, transparent 50%);
            animation: shadowRun 15s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes shadowRun {
            0% { transform: translateX(0); }
            100% { transform: translateX(100px); }
        }

        /* Glitch —ç—Ñ—Ñ–µ–∫—Ç */
        .glitch-container {
            position: relative;
            display: inline-block;
        }

        .glitch-container::before,
        .glitch-container::after {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            pointer-events: none;
        }

        .glitch-container.active::before {
            animation: glitch1 0.5s infinite;
            color: var(--accent-red);
            z-index: 1;
        }

        .glitch-container.active::after {
            animation: glitch2 0.5s infinite;
            color: var(--accent-blue);
            z-index: 2;
        }

        @keyframes glitch1 {
            0%, 100% { transform: translate(0); opacity: 0; }
            20% { transform: translate(-2px, 2px); opacity: 1; }
            40% { transform: translate(-2px, -2px); opacity: 1; }
            60% { transform: translate(2px, 2px); opacity: 1; }
            80% { transform: translate(2px, -2px); opacity: 1; }
        }

        @keyframes glitch2 {
            0%, 100% { transform: translate(0); opacity: 0; }
            30% { transform: translate(3px, 3px); opacity: 0.8; }
            60% { transform: translate(-3px, 3px); opacity: 0.8; }
        }

        .phone-container {
            width: 390px;
            height: 740px;
            margin: 20px auto;
            background: linear-gradient(145deg, #1a1a1a, #0f0f0f);
            border: 3px solid #333;
            border-radius: 30px;
            padding: 15px;
            box-shadow: 
                0 0 50px var(--shadow-color),
                inset 0 0 20px rgba(0, 0, 0, 0.5);
            position: relative;
            z-index: 10;
        }

        .screen {
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: inset 0 0 30px rgba(0, 0, 0, 0.8);
        }

        .phone-header {
            background: var(--bg-tertiary);
            padding: 10px 15px;
            font-size: 11px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .signal-bars {
            display: flex;
            gap: 2px;
        }

        .signal-bar {
            width: 3px;
            height: 8px;
            background: var(--text-primary);
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        .signal-bar.active {
            opacity: 1;
            box-shadow: 0 0 5px var(--glow-color);
        }

        .battery {
            color: var(--accent-red);
            animation: batteryPulse 3s infinite;
        }

        @keyframes batteryPulse {
            0%, 70% { opacity: 1; }
            85%, 100% { opacity: 0.3; }
        }

        .content-area {
            flex: 1;
            padding: 20px 15px;
            overflow-y: auto;
            position: relative;
        }

        /* –í–í–û–î–ù–´–ô –≠–ö–†–ê–ù */
        .intro-screen {
            text-align: center;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }

        .intro-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 20px;
            background: linear-gradient(45deg, var(--text-primary), var(--accent-red));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 4s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { filter: drop-shadow(0 0 10px var(--glow-color)); }
            to { filter: drop-shadow(0 0 30px var(--glow-color)); }
        }

        .intro-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .warning-box {
            background: rgba(255, 45, 85, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            animation: warningPulse 2s infinite;
        }

        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 45, 85, 0.3); }
            50% { box-shadow: 0 0 25px rgba(255, 45, 85, 0.6); }
        }

        .choice-button {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid #444;
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .choice-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-color), transparent);
            transition: left 0.5s;
        }

        .choice-button:hover::before {
            left: 100%;
        }

        .choice-button:hover {
            border-color: var(--text-primary);
            box-shadow: 0 0 20px var(--glow-color);
            transform: translateY(-2px);
        }

        .choice-button.dangerous {
            border-color: var(--accent-red);
            background: linear-gradient(135deg, rgba(255, 45, 85, 0.1), var(--bg-tertiary));
        }

        .choice-button.dangerous:hover {
            box-shadow: 0 0 20px rgba(255, 45, 85, 0.5);
        }

        .japanese-text {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 300;
        }

        .japanese-symbol {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 20px;
            color: var(--accent-red);
            display: inline-block;
            margin-right: 8px;
            animation: symbolGlow 3s infinite alternate;
        }

        @keyframes symbolGlow {
            from { text-shadow: 0 0 10px var(--accent-red); }
            to { text-shadow: 0 0 20px var(--accent-red), 0 0 30px var(--accent-red); }
        }

        /* –ò–ì–†–û–í–´–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .investigation-meter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #444;
            border-radius: 5px;
            padding: 8px;
            font-size: 10px;
            z-index: 100;
        }

        .meter-bar {
            width: 60px;
            height: 6px;
            background: #222;
            border-radius: 3px;
            margin-top: 4px;
            overflow: hidden;
        }

        .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-red));
            width: 0%;
            transition: width 0.5s ease;
        }

        .story-entry {
            background: rgba(255, 107, 53, 0.05);
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin: 15px 0;
            position: relative;
            animation: entrySlide 0.5s ease-out;
        }

        @keyframes entrySlide {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .story-entry.corrupted {
            background: rgba(255, 45, 85, 0.1);
            border-color: var(--accent-red);
            animation: entryGlitch 0.3s ease-out;
        }

        @keyframes entryGlitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .story-entry.shadow {
            background: rgba(175, 82, 222, 0.1);
            border-color: var(--accent-purple);
        }

        .story-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .story-content {
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .story-timestamp {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: right;
            opacity: 0.7;
        }

        .choices-container {
            padding: 15px;
            border-top: 1px solid #333;
            background: var(--bg-tertiary);
        }

        .interaction-prompt {
            text-align: center;
            color: var(--accent-purple);
            font-size: 12px;
            margin-bottom: 15px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –≠–õ–ï–ú–ï–ù–¢–´ */
        .mini-game {
            background: var(--bg-secondary);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
        }

        .shadow-tracker {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .shadow-spot {
            aspect-ratio: 1;
            background: var(--bg-tertiary);
            border: 2px solid #444;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .shadow-spot::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, var(--accent-purple), transparent);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .shadow-spot.active::before {
            opacity: 0.8;
            animation: shadowPulse 1s infinite;
        }

        @keyframes shadowPulse {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.5); }
        }

        .shadow-spot:hover {
            border-color: var(--text-primary);
            box-shadow: 0 0 15px var(--glow-color);
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }

        .progress-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #444;
            transition: background 0.3s;
        }

        .progress-dot.active {
            background: var(--text-primary);
            box-shadow: 0 0 10px var(--glow-color);
        }

        .progress-dot.completed {
            background: var(--accent-red);
        }

        /* –ê–ù–ò–ú–ê–¶–ò–ò –î–õ–Ø –ê–¢–ú–û–°–§–ï–†–´ */
        .atmospheric-text {
            opacity: 0;
            animation: fadeInUp 2s ease-out forwards;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .typing-effect {
            overflow: hidden;
            border-right: 2px solid var(--text-primary);
            animation: typing 3s steps(30) forwards, blink 0.5s infinite;
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blink {
            50% { border-color: transparent; }
        }

        .shadow-runner {
            position: absolute;
            width: 30px;
            height: 60px;
            background: linear-gradient(180deg, var(--accent-purple), transparent);
            border-radius: 50% 50% 0 0;
            opacity: 0.3;
            animation: runAcross 4s linear infinite;
        }

        @keyframes runAcross {
            0% { left: -30px; transform: scaleX(1); }
            50% { transform: scaleX(-1); }
            100% { left: calc(100% + 30px); transform: scaleX(-1); }
        }

        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="investigation-meter">
        <div class="japanese-text">ËøΩË∑°„É¨„Éô„É´</div>
        <div class="meter-bar">
            <div class="meter-fill" id="investigationFill"></div>
        </div>
    </div>

    <div class="phone-container">
        <div class="screen">
            <div class="phone-header">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <div class="signal-bars">
                        <div class="signal-bar active"></div>
                        <div class="signal-bar active"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                    </div>
                    <span class="japanese-text" style="font-size: 10px;">DoCoMo FOMA</span>
                </div>
                <div class="battery">08% ‚ö†Ô∏è</div>
            </div>

            <div id="gameContent" class="content-area">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è -->
            </div>

            <div id="choicesContainer" class="choices-container">
                <div class="interaction-prompt japanese-text">„Ç∑„Çπ„ÉÜ„É†Ëµ∑Âãï‰∏≠...</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#0a0a0f');
            tg.setBackgroundColor('#0a0a0f');
        }

        class HashirigamiGame {
            constructor() {
                this.gameContent = document.getElementById('gameContent');
                this.choicesContainer = document.getElementById('choicesContainer');
                this.investigationLevel = 0;
                this.gameState = {
                    chapter: 0,
                    shadowsFound: 0,
                    fearLevel: 0,
                    choicesMade: [],
                    playerName: '',
                    firstPlaythrough: true,
                    minigamesCompleted: [],
                    secretsUnlocked: []
                };

                if (tg?.initDataUnsafe?.user) {
                    this.gameState.playerName = tg.initDataUnsafe.user.first_name || '–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å';
                }

                this.init();
            }

            init() {
                this.showIntroScreen();
            }

            showIntroScreen() {
                this.gameContent.innerHTML = `
                    <div class="intro-screen">
                        <div class="intro-title">
                            <span class="glitch-container" data-text="Ëµ∞„ÇäÁ¥ô">Ëµ∞„ÇäÁ¥ô</span>
                        </div>
                        <div style="font-size: 18px; color: var(--accent-red); margin-bottom: 15px;">
                            SHADOW RUNNERS
                        </div>
                        <div class="intro-subtitle">
                            –¢–æ–∫–∏–æ, 2005 –≥–æ–¥<br>
                            –í –ø–æ–¥–∑–µ–º–Ω—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö —Å—Ç–∞–Ω—Ü–∏–∏ –°–∏–Ω–¥–∑—é–∫—É<br>
                            –ø–æ—è–≤–∏–ª–∏—Å—å —Å—Ç—Ä–∞–Ω–Ω—ã–µ —Ç–µ–Ω–∏, –∫–æ—Ç–æ—Ä—ã–µ –±–µ–≥—É—Ç<br>
                            –±—ã—Å—Ç—Ä–µ–µ —á–µ–ª–æ–≤–µ–∫–∞ –∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç –¥–≤–∏–∂–µ–Ω–∏—è<br>
                            —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–æ—Ö–æ–∂–∏—Ö.
                        </div>
                        
                        <div class="warning-box">
                            <div style="color: var(--accent-red); font-size: 12px; font-weight: bold;">‚ö†Ô∏è –ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï</div>
                            <div style="font-size: 11px; margin-top: 5px;">
                                –ù–∞–π–¥–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω –ø—Ä–æ–ø–∞–≤—à–µ–π –¥–µ–≤—É—à–∫–∏.<br>
                                –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.<br>
                                –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ –≤–∞—à —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.
                            </div>
                        </div>

                        <div style="margin: 30px 0;">
                            <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 10px;">
                                –í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è:
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: 'üîç –ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
                        action: () => this.startGame('casual'),
                        description: '–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–∂–∏–º —Å –º–∏–Ω–∏–º—É–º–æ–º —Ö–æ—Ä—Ä–æ—Ä–∞'
                    },
                    {
                        text: 'üëÅÔ∏è –ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ',
                        action: () => this.startGame('deep'),
                        description: '–ü–æ–ª–Ω–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ –≤ –º–∏—Å—Ç–∏–∫—É',
                        dangerous: true
                    },
                    {
                        text: 'üì± –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ',
                        action: () => this.showDeviceInfo(),
                        description: '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è'
                    }
                ]);

                // –ó–∞–ø—É—Å–∫–∞–µ–º –≥–ª–∏—Ç—á —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–µ
                setTimeout(() => {
                    const glitchEl = document.querySelector('.glitch-container');
                    if (glitchEl) glitchEl.classList.add('active');
                }, 2000);
            }

            startGame(mode) {
                this.gameState.mode = mode;
                this.gameState.chapter = 1;
                this.updateInvestigationLevel(10);
                this.showChapter1();
            }

            showChapter1() {
                this.addShadowRunner();
                
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-red);">
                                <span class="japanese-symbol">Âßã</span>–ì–õ–ê–í–ê 1: –ù–ê–•–û–î–ö–ê
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                23:47 ‚Ä¢ –°—Ç–∞–Ω—Ü–∏—è –°–∏–Ω–¥–∑—é–∫—É ‚Ä¢ –ü–æ–¥–∑–µ–º–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
                            </div>
                        </div>

                        <div class="story-entry atmospheric-text">
                            <div class="story-header">
                                <span>üì± –ó–∞–ø–∏—Å—å –æ—Ç –ª–∏—Ü–∞ –ú–∏–∫–∏ –¢–∞–Ω–∏–≥—É—á–∏ (Ë∞∑Âè£ÁæéÁ¥Ä)</span>
                                <span>15.11.05</span>
                            </div>
                            <div class="story-content">
                                –í–æ–∑–≤—Ä–∞—â–∞–ª–∞—Å—å –¥–æ–º–æ–π —Å —Ä–∞–±–æ—Ç—ã. –ü–æ—Å–ª–µ–¥–Ω–∏–π –ø–æ–µ–∑–¥, –ø—É—Å—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã. 
                                –ò –≤–¥—Ä—É–≥ –∑–∞–º–µ—Ç–∏–ª–∞ - –º–æ—è —Ç–µ–Ω—å –±–µ–∂–∏—Ç –Ω–µ –≤ —Ç—É —Å—Ç–æ—Ä–æ–Ω—É.
                                <br><br>
                                –Ø –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å. –¢–µ–Ω—å –ø—Ä–æ–¥–æ–ª–∂–∏–ª–∞ –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–∫–æ–ª—å–∑–Ω—É–ª–∞ –ø–æ —Å—Ç–µ–Ω–µ 
                                –∏ –∏—Å—á–µ–∑–ª–∞ –∑–∞ —É–≥–ª–æ–º. –ö–∞–∫ –±—É–¥—Ç–æ —É –Ω–µ—ë –µ—Å—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–æ–ª—è.
                            </div>
                        </div>

                        <div class="mini-game">
                            <div style="color: var(--accent-purple); margin-bottom: 15px;">
                                üéÆ –ò–ù–¢–ï–†–ê–ö–¢–ò–í: –ù–∞–π–¥–∏—Ç–µ –∞–Ω–æ–º–∞–ª—å–Ω—ã–µ —Ç–µ–Ω–∏
                            </div>
                            <div class="shadow-tracker" id="shadowTracker1">
                                ${Array(9).fill().map((_, i) => `
                                    <div class="shadow-spot" data-index="${i}" onclick="game.checkShadow(${i}, 'shadowTracker1')"></div>
                                `).join('')}
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –æ–±–ª–∞—Å—Ç–∏, –≥–¥–µ –º–æ–≥—É—Ç –ø—Ä—è—Ç–∞—Ç—å—Å—è –±–µ–≥—É—â–∏–µ —Ç–µ–Ω–∏
                            </div>
                        </div>

                        <div class="progress-indicator">
                            <div class="progress-dot active"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                            <div class="progress-dot"></div>
                        </div>
                    </div>
                `;

                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∏–Ω–∏-–∏–≥—Ä—É —Å —Ç–µ–Ω—è–º–∏
                this.initShadowGame('shadowTracker1', [2, 5, 7], () => {
                    this.updateInvestigationLevel(20);
                    this.setChoices([
                        {
                            text: 'üìù –ó–∞–ø–∏—Å–∞—Ç—å –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                            action: () => this.showChapter2(),
                            description: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–Ω—è—Ç—å –ª–æ–≥–∏–∫—É —è–≤–ª–µ–Ω–∏—è'
                        },
                        {
                            text: 'üèÉ‚Äç‚ôÄÔ∏è –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç—å –∑–∞ —Ç–µ–Ω—å—é',
                            action: () => this.showChapter2Alternative(),
                            description: '–†–∏—Å–∫, –Ω–æ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏',
                            dangerous: true
                        },
                        {
                            text: 'üì± –°–Ω—è—Ç—å –Ω–∞ –∫–∞–º–µ—Ä—É',
                            action: () => this.showCameraMinigame(),
                            description: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏—é'
                        }
                    ]);
                });

                this.setChoices([
                    {
                        text: '‚è≥ –ü–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–µ–Ω–µ–π...',
                        action: () => {},
                        description: '–°–Ω–∞—á–∞–ª–∞ –Ω–∞–π–¥–∏—Ç–µ –≤—Å–µ —Ç–µ–Ω–∏ –≤ –º–∏–Ω–∏-–∏–≥—Ä–µ'
                    }
                ]);
            }

            showChapter2() {
                this.gameState.chapter = 2;
                this.addShadowRunner();
                
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-red);">
                                <span class="japanese-symbol">ËøΩ</span>–ì–õ–ê–í–ê 2: –ü–†–ï–°–õ–ï–î–û–í–ê–ù–ò–ï
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                00:15 ‚Ä¢ –†–∞–π–æ–Ω –°–∏–±—É—è ‚Ä¢ –¢–æ—Ä–≥–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä 109
                            </div>
                        </div>

                        <div class="story-entry corrupted">
                            <div class="story-header">
                                <span>üì± –≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Ä¢ –ú–∏–∫–∏</span>
                                <span>16.11.05</span>
                            </div>
                            <div class="story-content">
                                –û–Ω–∏ –ø–æ–≤—Å—é–¥—É! –¢–µ–Ω–∏ –±–µ–≥—É—Ç –ø–æ —Å—Ç–µ–Ω–∞–º —Ç–æ—Ä–≥–æ–≤–æ–≥–æ —Ü–µ–Ω—Ç—Ä–∞. 
                                –ü–æ–≤—Ç–æ—Ä—è—é—Ç –¥–≤–∏–∂–µ–Ω–∏—è –ª—é–¥–µ–π, –Ω–æ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥.
                                <br><br>
                                <span style="color: var(--accent-red);">–°–ê–ú–û–ï –°–¢–†–ê–®–ù–û–ï:</span> 
                                –ö–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è, –µ–≥–æ —Ç–µ–Ω—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –±–µ–∂–∞—Ç—å. 
                                –ò —Ç–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –Ω–∞—á–∏–Ω–∞–µ—Ç –±–µ–∂–∞—Ç—å –∑–∞ –Ω–µ–π...
                            </div>
                        </div>

                        <div class="story-entry shadow">
                            <div class="story-header">
                                <span>üèÉ‚Äç‚ôÄÔ∏è –°–≤–∏–¥–µ—Ç–µ–ª—å: –û—Ö—Ä–∞–Ω–Ω–∏–∫ —Ü–µ–Ω—Ç—Ä–∞</span>
                                <span>16.11.05</span>
                            </div>
                            <div class="story-content">
                                "–ó–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é —Ç—Ä–æ–µ –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –Ω–∞—á–∞–ª–∏ –±–µ–≥–∞—Ç—å 
                                –ø–æ —Ü–µ–Ω—Ç—Ä—É –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏. –í—Ä–∞—á–∏ –Ω–µ –º–æ–≥—É—Ç –∏—Ö –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å. 
                                –ì–æ–≤–æ—Ä—è—Ç, —á—Ç–æ –ø—Ä–µ—Å–ª–µ–¥—É—é—Ç —Å–≤–æ—é —Ç–µ–Ω—å."
                            </div>
                        </div>

                        <div class="mini-game">
                            <div style="color: var(--accent-purple); margin-bottom: 15px;">
                                ‚ö° –†–ï–ê–ö–¶–ò–Ø: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É–±–µ–≥–∞—é—â—É—é —Ç–µ–Ω—å!
                            </div>
                            <div style="position: relative; height: 60px; background: var(--bg-tertiary); border-radius: 8px; overflow: hidden; margin: 15px 0;">
                                <div id="runningShadow" style="position: absolute; width: 30px; height: 50px; background: linear-gradient(180deg, var(--accent-purple), transparent); left: 0; top: 5px; border-radius: 50% 50% 0 0; transition: left 2s linear;"></div>
                                <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); color: var(--accent-red); font-size: 20px;">üéØ</div>
                            </div>
                            <button class="choice-button" id="catchShadowBtn" onclick="game.catchShadow()">
                                ‚ö° –ü–û–ô–ú–ê–¢–¨ –¢–ï–ù–¨
                            </button>
                            <div id="shadowResult" style="font-size: 11px; margin-top: 10px; text-align: center; color: var(--text-secondary);"></div>
                        </div>
                    </div>
                `;

                this.startShadowChase();
                
                setTimeout(() => {
                    this.updateInvestigationLevel(35);
                    this.setChoices([
                        {
                            text: 'üöá –°–ø—É—Å—Ç–∏—Ç—å—Å—è –≤ –º–µ—Ç—Ä–æ',
                            action: () => this.showChapter3(),
                            description: '–ò—Å–∫–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –∞–Ω–æ–º–∞–ª–∏–∏'
                        },
                        {
                            text: 'üìû –°–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ–ª–∏—Ü–∏–µ–π',
                            action: () => this.showPoliceRoute(),
                            description: '–ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å'
                        },
                        {
                            text: 'üè• –ù–∞–π—Ç–∏ –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏—Ö',
                            action: () => this.showVictimsRoute(),
                            description: '–ü–æ–º–æ—á—å –æ–¥–µ—Ä–∂–∏–º—ã–º –±–µ–≥–æ–º –ª—é–¥—è–º',
                            dangerous: true
                        }
                    ]);
                }, 3000);
            }

            showChapter3() {
                this.gameState.chapter = 3;
                this.updateInvestigationLevel(50);
                
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-red);">
                                <span class="japanese-symbol">Ê∑±</span>–ì–õ–ê–í–ê 3: –ò–°–¢–û–ß–ù–ò–ö
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                01:30 ‚Ä¢ –ü–æ–¥–∑–µ–º–∫–∞ ‚Ä¢ –ó–∞–±—Ä–æ—à–µ–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
                            </div>
                        </div>

                        <div class="story-entry corrupted">
                            <div class="story-header">
                                <span>üì± –ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å ‚Ä¢ –ú–∏–∫–∏</span>
                                <span>17.11.05</span>
                            </div>
                            <div class="story-content">
                                –ù–∞—à–ª–∞ –∏—Ö –ª–æ–≥–æ–≤–æ. –°—Ç–∞—Ä–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, –∑–∞–∫—Ä—ã—Ç–∞—è —Å 1980-—Ö. 
                                –°—Ç–µ–Ω—ã –ø–æ–∫—Ä—ã—Ç—ã —Ç–µ–Ω—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–≤–∏–∂—É—Ç—Å—è —Å–∞–º–∏ –ø–æ —Å–µ–±–µ.
                                <br><br>
                                –í —Ü–µ–Ω—Ç—Ä–µ - –¥–µ–≤—É—à–∫–∞. –û–Ω–∞ —Ç–∞–Ω—Ü—É–µ—Ç, –∞ —Å–æ—Ç–Ω–∏ —Ç–µ–Ω–µ–π –ø–æ–≤—Ç–æ—Ä—è—é—Ç 
                                –µ—ë –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –≤—Å–µ–º—É –¢–æ–∫–∏–æ. <span style="color: var(--accent-red);">–û–ù–ê –ö–û–ù–¢–†–û–õ–ò–†–£–ï–¢ –ò–• –í–°–ï–•.</span>
                                <br><br>
                                –ö–∞–∂–µ—Ç—Å—è, –æ–Ω–∞ –∑–∞–º–µ—Ç–∏–ª–∞ –º–µ–Ω—è. –ù–∞—á–∏–Ω–∞–µ—Ç –ø–æ–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å—Å—è...
                            </div>
                        </div>

                        <div class="story-entry shadow">
                            <div class="story-content" style="text-align: center; font-style: italic;">
                                <span class="typing-effect" style="color: var(--accent-purple);">
                                    "–•–æ—á–µ—à—å —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å —Å–æ –º–Ω–æ–π?"
                                </span>
                                <br><br>
                                <span style="font-size: 11px; color: var(--text-secondary);">
                                    [–ó–í–£–ö –û–ë–†–´–í–ê–ï–¢–°–Ø]
                                </span>
                            </div>
                        </div>

                        <div class="mini-game">
                            <div style="color: var(--accent-red); margin-bottom: 15px; text-align: center;">
                                üíÉ –§–ò–ù–ê–õ–¨–ù–´–ô –í–´–ë–û–†: –ß—Ç–æ –¥–µ–ª–∞—Ç—å —Å –¢–µ–Ω–µ–≤–æ–π –¢–∞–Ω—Ü–æ–≤—â–∏—Ü–µ–π?
                            </div>
                            <div style="background: rgba(175, 82, 222, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                                <div style="font-size: 12px; margin-bottom: 10px;">
                                    –û–Ω–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–µ–±–µ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ —Ç–∞–Ω—Ü—É —Ç–µ–Ω–µ–π.<br>
                                    –¢–≤–æ–π –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å—É–¥—å–±—É –≤—Å–µ—Ö –æ–¥–µ—Ä–∂–∏–º—ã—Ö –ª—é–¥–µ–π –≤ –¢–æ–∫–∏–æ.
                                </div>
                            </div>
                        </div>

                        <div class="progress-indicator">
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot active"></div>
                            <div class="progress-dot"></div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: 'üíÉ –ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ',
                        action: () => this.showEnding('join'),
                        description: '–°—Ç–∞—Ç—å —á–∞—Å—Ç—å—é —Ç–∞–Ω—Ü–∞ —Ç–µ–Ω–µ–π –Ω–∞–≤—Å–µ–≥–¥–∞',
                        dangerous: true
                    },
                    {
                        text: '‚ö° –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—ë',
                        action: () => this.showEnding('fight'),
                        description: '–†–∏—Å–∫, –Ω–æ —à–∞–Ω—Å —Å–ø–∞—Å—Ç–∏ –≤—Å–µ—Ö',
                        dangerous: true
                    },
                    {
                        text: 'üé• –ó–∞–ø–∏—Å–∞—Ç—å –≤—Å—ë –Ω–∞ –∫–∞–º–µ—Ä—É',
                        action: () => this.showEnding('record'),
                        description: '–°–æ–∑–¥–∞—Ç—å –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –¥–ª—è –º–∏—Ä–∞'
                    },
                    {
                        text: 'üèÉ‚Äç‚ôÄÔ∏è –£–±–µ–∂–∞—Ç—å –∏ –∑–∞–±—ã—Ç—å',
                        action: () => this.showEnding('escape'),
                        description: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–±—è, –Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏—Ö'
                    }
                ]);
            }

            showEnding(choice) {
                this.gameState.chapter = 5;
                this.updateInvestigationLevel(100);
                
                let endingContent = '';
                let endingClass = 'story-entry';
                
                if (choice === 'join') {
                    endingClass += ' shadow';
                    endingContent = `
                        <div class="story-content">
                            –¢—ã –ø—Ä–∏–Ω–∏–º–∞–µ—à—å –µ—ë —Ä—É–∫—É. –¢–≤–æ—ë —Ç–µ–ª–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª—ë–≥–∫–∏–º, –∫–∞–∫ —Ç–µ–Ω—å.
                            <br><br>
                            –¢–µ–ø–µ—Ä—å —Ç—ã —á–∞—Å—Ç—å –≤–µ—á–Ω–æ–≥–æ —Ç–∞–Ω—Ü–∞. –¢–≤–æ—è —Ç–µ–Ω—å –±–µ–≥–∞–µ—Ç –ø–æ —É–ª–∏—Ü–∞–º –¢–æ–∫–∏–æ, 
                            —É–≤–ª–µ–∫–∞—è –∑–∞ —Å–æ–±–æ–π —Å–ª—É—á–∞–π–Ω—ã—Ö –ø—Ä–æ—Ö–æ–∂–∏—Ö –≤ –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é –ø–æ–≥–æ–Ω—é.
                            <br><br>
                            <span style="color: var(--accent-purple); font-style: italic;">
                                "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–µ–º—å—é —Ç–µ–Ω–µ–π..."
                            </span>
                        </div>
                    `;
                } else if (choice === 'fight') {
                    endingClass += ' corrupted';
                    endingContent = `
                        <div class="story-content">
                            –¢—ã –ø—ã—Ç–∞–µ—à—å—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∞–Ω–µ—Ü. –¢–µ–Ω–µ–≤–∞—è –¢–∞–Ω—Ü–æ–≤—â–∏—Ü–∞ —Å–º–µ—ë—Ç—Å—è.
                            <br><br>
                            –ù–æ —Ç–≤–æ—è —Ä–µ—à–∏–º–æ—Å—Ç—å —Å–∏–ª—å–Ω–µ–µ –µ—ë —á–∞—Ä. –°–≤—è–∑—å —Ä–≤—ë—Ç—Å—è. 
                            –ü–æ –≤—Å–µ–º—É –¢–æ–∫–∏–æ –ª—é–¥–∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è, –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–µ—Å–ª–µ–¥—É—è —Å–≤–æ–∏ —Ç–µ–Ω–∏.
                            <br><br>
                            <span style="color: var(--accent-red);">
                                –¢–∞–Ω—Ü–æ–≤—â–∏—Ü–∞ –∏—Å—á–µ–∑–∞–µ—Ç, –Ω–æ –æ–±–µ—â–∞–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è...
                            </span>
                        </div>
                    `;
                } else if (choice === 'record') {
                    endingContent = `
                        <div class="story-content">
                            –¢—ã –∑–∞–ø–∏—Å—ã–≤–∞–µ—à—å –≤—Å—ë –Ω–∞ –∫–∞–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞. –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞!
                            <br><br>
                            –í–∏–¥–µ–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–∏—Ä—É—Å–Ω—ã–º. –ú–∏—Ä —É–∑–Ω–∞—ë—Ç –æ –¢–µ–Ω–µ–≤—ã—Ö –¢–∞–Ω—Ü–æ–≤—â–∏—Ü–∞—Ö. 
                            –£—á–µ–Ω—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è. –õ—é–¥–µ–π –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—Ç –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
                            <br><br>
                            <span style="color: var(--text-primary);">
                                –¢—ã —Å—Ç–∞–ª–∞ –≥–µ—Ä–æ–µ–º. –ù–æ —Ç–µ–Ω–∏ –≤—Å—ë –µ—â—ë —Ç–∞–º, –∂–¥—É—Ç –Ω–µ–æ—Å—Ç–æ—Ä–æ–∂–Ω—ã—Ö...
                            </span>
                        </div>
                    `;
                } else {
                    endingContent = `
                        <div class="story-content">
                            –¢—ã —É–±–µ–≥–∞–µ—à—å, –Ω–µ –æ–≥–ª—è–¥—ã–≤–∞—è—Å—å. 
                            <br><br>
                            –¢–∞–Ω–µ—Ü –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è. –õ—é–¥–∏ –ø–æ –≤—Å–µ–º—É –¢–æ–∫–∏–æ –≤—Å—ë –µ—â—ë –±–µ–≥—É—Ç –∑–∞ —Å–≤–æ–∏–º–∏ —Ç–µ–Ω—è–º–∏. 
                            –ù–æ —Ç—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏... –ø–æ–∫–∞ —Ç–≤–æ—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–µ–Ω—å –Ω–µ –Ω–∞—á–Ω—ë—Ç –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.
                            <br><br>
                            <span style="color: var(--text-secondary); font-style: italic;">
                                –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∞–π–Ω—ã –ª—É—á—à–µ –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å...
                            </span>
                        </div>
                    `;
                }

                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-red);">
                                <span class="japanese-symbol">ÁµÇ</span>–§–ò–ù–ê–õ: ${this.getEndingTitle(choice)}
                            </div>
                        </div>

                        <div class="${endingClass}">
                            ${endingContent}
                        </div>

                        <div class="story-entry" style="text-align: center;">
                            <div style="color: var(--accent-purple); margin-bottom: 15px;">
                                üé≠ –≠–ü–ò–õ–û–ì
                            </div>
                            <div class="story-content">
                                –ò—Å—Ç–æ—Ä–∏—è –ú–∏–∫–∏ –ø–æ–∫–∞–∑–∞–ª–∞ –Ω–∞–º —Ç—ë–º–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É —è–ø–æ–Ω—Å–∫–∏—Ö —É–ª–∏—Ü. 
                                –ù–æ –µ—Å—Ç—å –∏ —Å–≤–µ—Ç–ª–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ - –∏—Å–∫—É—Å—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –ª—é–¥–µ–π.
                                <br><br>
                                –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ä–∞ –∏–∑—É—á–∏—Ç—å —á—Ç–æ-—Ç–æ —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–æ–µ? 
                                –ù–∞–ø—Ä–∏–º–µ—Ä, –∏—Å–∫—É—Å—Å—Ç–≤–æ —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∏...
                            </div>
                        </div>

                        <div class="progress-indicator">
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                            <div class="progress-dot completed"></div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: 'üîÑ –ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π –ø—É—Ç—å',
                        action: () => location.reload(),
                        description: '–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ —Å –¥—Ä—É–≥–∏–º–∏ –≤—ã–±–æ—Ä–∞–º–∏'
                    },
                    {
                        text: 'üéì –ò–∑—É—á–∏—Ç—å —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ',
                        action: () => this.showCoursesOverview(),
                        description: '–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ'
                    },
                    {
                        text: 'üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∏—Å—Ç–æ—Ä–∏–µ–π',
                        action: () => this.shareStory(),
                        description: '–†–∞—Å—Å–∫–∞–∑–∞—Ç—å –¥—Ä—É–∑—å—è–º –æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–∏'
                    }
                ]);
            }

            showCoursesOverview() {
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--text-primary);">
                                <span class="japanese-symbol">Â≠¶</span>–ê–ö–ê–î–ï–ú–ò–Ø –¢–ê–¢–£-–ú–ê–°–¢–ï–†–°–¢–í–ê
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                –û—Ç —Ç–µ–Ω–µ–π –∫ —Å–≤–µ—Ç—É ‚Ä¢ –°–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ
                            </div>
                        </div>

                        <div class="story-entry">
                            <div class="story-content">
                                –ü–æ—Å–ª–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ –º–∏—Ä —Ç–µ–Ω–µ–π –≤–∞–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–æ–∑–∏–¥–∞—Ç–µ–ª—å–Ω–æ–º—É –∏—Å–∫—É—Å—Å—Ç–≤—É. 
                                –¢–∞—Ç—É–∏—Ä–æ–≤–∫–∏ - —ç—Ç–æ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—Ä–∞—Å–æ—Ç—É, –∞ –Ω–µ —Ä–∞–∑—Ä—É—à–∞—Ç—å.
                            </div>
                        </div>

                        <div style="background: rgba(255, 107, 53, 0.1); border: 1px solid var(--text-primary); border-radius: 10px; padding: 15px; margin: 15px 0;">
                            <div style="font-size: 13px; font-weight: bold; margin-bottom: 15px; color: var(--text-primary);">
                                –î–û–°–¢–£–ü–ù–´–ï –ö–£–†–°–´:
                            </div>
                            
                            <div style="margin: 10px 0; padding: 12px; background: rgba(255, 45, 85, 0.1); border-radius: 6px;">
                                <strong>–ü–æ–ª–Ω—ã–π –∫—É—Ä—Å —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä–∞</strong> - 22,500‚ÇΩ <span style="text-decoration: line-through; opacity: 0.6;">45,000‚ÇΩ</span>
                                <br><small>–¢–µ–æ—Ä–∏—è + –≤–∏–¥–µ–æ + –Ω–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ ‚Ä¢ 1-2 –º–µ—Å—è—Ü–∞</small>
                                <button class="choice-button" style="margin-top: 8px; padding: 8px;" onclick="game.showCourse('full')">
                                    üéì –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </button>
                            </div>

                            <div style="margin: 10px 0; padding: 12px; background: rgba(175, 82, 222, 0.1); border-radius: 6px;">
                                <strong>SMM –¥–ª—è —Ç–∞—Ç—É-–º–∞—Å—Ç–µ—Ä–æ–≤</strong> - 12,500‚ÇΩ <span style="text-decoration: line-through; opacity: 0.6;">25,000‚ÇΩ</span>
                                <br><small>Instagram, TikTok, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ ‚Ä¢ 3 –Ω–µ–¥–µ–ª–∏</small>
                                <button class="choice-button" style="margin-top: 8px; padding: 8px;" onclick="game.showCourse('smm')">
                                    üì± –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </button>
                            </div>

                            <div style="margin: 10px 0; padding: 12px; background: rgba(0, 122, 255, 0.1); border-radius: 6px;">
                                <strong>Procreate –¥–ª—è —ç—Å–∫–∏–∑–æ–≤</strong> - 7,500‚ÇΩ <span style="text-decoration: line-through; opacity: 0.6;">15,000‚ÇΩ</span>
                                <br><small>–¶–∏—Ñ—Ä–æ–≤–æ–µ —Ä–∏—Å–æ–≤–∞–Ω–∏–µ —ç—Å–∫–∏–∑–æ–≤</small>
                                <button class="choice-button" style="margin-top: 8px; padding: 8px;" onclick="game.showCourse('procreate')">
                                    üé® –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                                </button>
                            </div>
                        </div>

                        <div class="story-entry shadow">
                            <div style="text-align: center;">
                                <div style="color: var(--accent-purple); margin-bottom: 10px;">üéÅ –ü–†–û–ú–û–ö–û–î</div>
                                <div style="font-size: 18px; font-weight: bold; letter-spacing: 2px; color: var(--text-primary);">
                                    SHADOWS50
                                </div>
                                <div style="font-size: 11px; margin-top: 5px;">
                                    –°–∫–∏–¥–∫–∞ 50% + –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: 'üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥',
                        action: () => {
                            if (navigator.clipboard) {
                                navigator.clipboard.writeText('SHADOWS50');
                            }
                            this.showNotification('–ü—Ä–æ–º–æ–∫–æ–¥ SHADOWS50 —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω!');
                        },
                        description: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞'
                    },
                    {
                        text: 'üí¨ –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–æ–º',
                        action: () => this.contactSupport(),
                        description: '–ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é'
                    }
                ]);
            }

            // –°–õ–£–ñ–ï–ë–ù–´–ï –ú–ï–¢–û–î–´

            initShadowGame(trackerId, correctSpots, callback) {
                let foundShadows = 0;
                const total = correctSpots.length;
                
                correctSpots.forEach(index => {
                    setTimeout(() => {
                        const spot = document.querySelector(`#${trackerId} [data-index="${index}"]`);
                        if (spot) spot.classList.add('active');
                    }, Math.random() * 2000);
                });

                window.checkShadow = (index, trackerId) => {
                    const spot = document.querySelector(`#${trackerId} [data-index="${index}"]`);
                    if (correctSpots.includes(index) && spot.classList.contains('active')) {
                        spot.style.borderColor = 'var(--text-primary)';
                        spot.style.boxShadow = '0 0 20px var(--glow-color)';
                        foundShadows++;
                        
                        if (foundShadows === total) {
                            setTimeout(callback, 1000);
                        }
                    } else {
                        spot.style.borderColor = 'var(--accent-red)';
                        setTimeout(() => {
                            spot.style.borderColor = '#444';
                        }, 1000);
                    }
                };
            }

            startShadowChase() {
                const shadow = document.getElementById('runningShadow');
                const btn = document.getElementById('catchShadowBtn');
                const result = document.getElementById('shadowResult');
                
                let shadowPosition = 0;
                let caught = false;
                
                const moveInterval = setInterval(() => {
                    if (caught) return;
                    
                    shadowPosition += 5;
                    shadow.style.left = shadowPosition + 'px';
                    
                    if (shadowPosition > 300) {
                        clearInterval(moveInterval);
                        if (!caught) {
                            result.textContent = '‚ùå –¢–µ–Ω—å —É–±–µ–∂–∞–ª–∞...';
                            result.style.color = 'var(--accent-red)';
                        }
                    }
                }, 100);

                window.catchShadow = () => {
                    if (shadowPosition > 250 && shadowPosition < 310) {
                        caught = true;
                        clearInterval(moveInterval);
                        result.textContent = '‚úÖ –¢–µ–Ω—å –ø–æ–π–º–∞–Ω–∞! –ü–æ–ª—É—á–µ–Ω—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.';
                        result.style.color = 'var(--text-primary)';
                        this.updateInvestigationLevel(45);
                    } else {
                        result.textContent = '‚ùå –ü—Ä–æ–º–∞—Ö! –¢–µ–Ω—å —É—Å–∫–æ–ª—å–∑–Ω—É–ª–∞.';
                        result.style.color = 'var(--accent-red)';
                    }
                    btn.disabled = true;
                };
            }

            addShadowRunner() {
                const runner = document.createElement('div');
                runner.className = 'shadow-runner';
                runner.style.top = Math.random() * 200 + 'px';
                this.gameContent.appendChild(runner);
                
                setTimeout(() => {
                    if (runner.parentNode) runner.remove();
                }, 4000);
            }

            updateInvestigationLevel(level) {
                this.investigationLevel = level;
                const fill = document.getElementById('investigationFill');
                if (fill) {
                    fill.style.width = level + '%';
                }
            }

            setChoices(choices) {
                this.choicesContainer.innerHTML = `
                    <div class="interaction-prompt">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:</div>
                    ${choices.map(choice => `
                        <button class="choice-button ${choice.dangerous ? 'dangerous' : ''}" onclick="choice.action()">
                            ${choice.text}
                            ${choice.description ? `<div style="font-size: 10px; opacity: 0.7; margin-top: 4px;">${choice.description}</div>` : ''}
                        </button>
                    `).join('')}
                `;

                // –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                const buttons = this.choicesContainer.querySelectorAll('.choice-button');
                buttons.forEach((button, index) => {
                    button.onclick = choices[index].action;
                });
            }

            showNotification(text) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 50px; right: 20px; 
                    background: var(--text-primary); color: black; 
                    padding: 10px 15px; border-radius: 8px; 
                    z-index: 1000; font-size: 12px;
                    box-shadow: 0 0 20px var(--glow-color);
                `;
                notification.textContent = text;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }

            getEndingTitle(choice) {
                const titles = {
                    'join': '–¢–ê–ù–ï–¶ –í–ï–ß–ù–û–°–¢–ò',
                    'fight': '–ì–ï–†–û–ò–ß–ï–°–ö–û–ï –°–û–ü–†–û–¢–ò–í–õ–ï–ù–ò–ï', 
                    'record': '–°–í–ò–î–ï–¢–ï–õ–¨ –ò–°–¢–ò–ù–´',
                    'escape': '–¢–Ø–ñ–ö–û–ï –ë–†–ï–ú–Ø'
                };
                return titles[choice] || '–ù–ï–ò–ó–í–ï–°–¢–ù–ê–Ø –°–£–î–¨–ë–ê';
            }

            shareStory() {
                if (tg) {
                    tg.switchInlineQuery('–ü—Ä–æ—à–ª–∞ –º–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∫–≤–µ—Å—Ç –ø—Ä–æ –¢–µ–Ω–µ–≤—ã—Ö –¢–∞–Ω—Ü–æ–≤—â–∏—Ü –¢–æ–∫–∏–æ! üèÉ‚Äç‚ôÄÔ∏èüëª');
                }
            }

            contactSupport() {
                if (tg) {
                    tg.openTelegramLink('https://t.me/your_tattoo_support');
                }
            }

            showDeviceInfo() {
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-blue);">
                                <span class="japanese-symbol">Ê©ü</span>–ò–ù–§–û–†–ú–ê–¶–ò–Ø –û–ë –£–°–¢–†–û–ô–°–¢–í–ï
                            </div>
                        </div>

                        <div class="story-entry">
                            <div class="story-content">
                                <strong>–ú–æ–¥–µ–ª—å:</strong> DoCoMo P901i (2005)<br>
                                <strong>–í–ª–∞–¥–µ–ª–µ—Ü:</strong> Ë∞∑Âè£ÁæéÁ¥Ä (–ú–∏–∫–∏ –¢–∞–Ω–∏–≥—É—á–∏)<br>
                                <strong>–°—Ç–∞—Ç—É—Å:</strong> –ü—Ä–æ–ø–∞–ª–∞ –±–µ–∑ –≤–µ—Å—Ç–∏<br>
                                <strong>–ü–∞–º—è—Ç—å:</strong> 100MB (—á–∞—Å—Ç–∏—á–Ω–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞)<br>
                                <strong>GPS:</strong> –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã<br>
                                <strong>–ö–∞–º–µ—Ä–∞:</strong> 2MP (—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–µ–≤–∏–¥–∏–º—ã–µ –æ–±—ä–µ–∫—Ç—ã)
                            </div>
                        </div>

                        <div class="story-entry corrupted">
                            <div class="story-content">
                                ‚ö†Ô∏è <strong>–ê–ù–û–ú–ê–õ–ò–ò:</strong><br>
                                ‚Ä¢ –¢–µ–ª–µ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –±–∞—Ç–∞—Ä–µ–∏<br>
                                ‚Ä¢ –ó–∞–ø–∏—Å–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ<br>
                                ‚Ä¢ –ö–∞–º–µ—Ä–∞ —Å–Ω–∏–º–∞–µ—Ç —Ç–µ–Ω–∏ –±–µ–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞<br>
                                ‚Ä¢ GPS –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–µ—Å—Ç–∞
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: 'üîç –ù–∞—á–∞—Ç—å —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ',
                        action: () => this.showIntroScreen(),
                        description: '–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≤—ã–±–æ—Ä—É —Ä–µ–∂–∏–º–∞'
                    }
                ]);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new HashirigamiGame();
        });

        // –ê—Ç–º–æ—Å—Ñ–µ—Ä–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
        setInterval(() => {
            if (Math.random() < 0.05) {
                document.body.style.filter = `hue-rotate(${Math.random() * 60}deg)`;
                setTimeout(() => { document.body.style.filter = 'none'; }, 200);
            }
        }, 5000);
    </script>
</body>
</html>
