<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>隙間女 | МЁРТВЫЕ ПИКСЕЛИ</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap');
        
        :root {
            --bg-dark: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --text-primary: #00ffaa;
            --text-secondary: #666;
            --accent-pink: #ff0080;
            --accent-blue: #0099ff;
            --accent-purple: #8a2be2;
            --border-color: #333;
            --choice-bg: #001a0f;
            --choice-hover: #002a1f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', 'Noto Sans JP', monospace;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Glitch эффекты как в Ghost in the Shell */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 170, 0.03) 2px,
                    rgba(0, 255, 170, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
            animation: scanlines 2s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        .phone-container {
            width: 380px;
            height: 720px;
            margin: 20px auto;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 4px solid var(--border-color);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 170, 0.3);
            position: relative;
            z-index: 2;
        }

        .screen {
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .phone-header {
            background: var(--bg-secondary);
            padding: 8px 12px;
            font-size: 0.7rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .japanese-text {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 300;
        }

        .glitch-text {
            animation: textGlitch 2s infinite;
        }

        @keyframes textGlitch {
            0%, 90% { transform: translateX(0); }
            92% { transform: translateX(-2px); }
            94% { transform: translateX(2px); }
            96% { transform: translateX(-1px); }
            98% { transform: translateX(1px); }
            100% { transform: translateX(0); }
        }

        .battery {
            color: var(--accent-pink);
            animation: batteryBlink 2s infinite;
        }

        @keyframes batteryBlink {
            0%, 70% { opacity: 1; }
            85%, 100% { opacity: 0.3; }
        }

        .content-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .screen-title {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* BOOT SCREEN */
        .boot-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
        }

        .device-logo {
            font-size: 36px;
            color: var(--text-primary);
            font-weight: bold;
            margin-bottom: 20px;
            animation: logoGlow 3s infinite alternate;
        }

        @keyframes logoGlow {
            from { text-shadow: 0 0 10px var(--text-primary); }
            to { text-shadow: 0 0 30px var(--text-primary), 0 0 40px var(--text-primary); }
        }

        .progress-bar {
            width: 220px;
            height: 20px;
            background: #333;
            border: 2px solid #666;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-blue));
            width: 0%;
            transition: width 0.3s ease;
        }

        .boot-message {
            color: #ccc;
            font-size: 14px;
            margin-top: 10px;
        }

        /* MEMORY ENTRIES */
        .memory-entry {
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            animation: messageSlide 0.3s ease-out;
            position: relative;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .memory-entry.normal {
            background: rgba(0, 255, 170, 0.1);
            border: 1px solid rgba(0, 255, 170, 0.3);
        }

        .memory-entry.corrupted {
            background: linear-gradient(45deg, rgba(255, 0, 128, 0.2), rgba(0, 0, 0, 0.8));
            border: 1px solid var(--accent-pink);
            animation: memoryGlitch 0.5s ease-out;
        }

        .memory-entry.system {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid var(--accent-purple);
            text-align: center;
            font-size: 12px;
        }

        @keyframes memoryGlitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .memory-header {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        .memory-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .memory-timestamp {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: right;
        }

        .japanese-symbol {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 18px;
            color: var(--accent-pink);
            display: inline-block;
            margin-right: 8px;
        }

        /* NAVIGATION */
        .nav-button {
            background: rgba(0, 255, 170, 0.2);
            border: 1px solid var(--text-primary);
            padding: 8px 12px;
            border-radius: 4px;
            color: var(--text-primary);
            cursor: pointer;
            font-size: 12px;
            margin: 4px;
            transition: all 0.3s ease;
        }

        .nav-button:hover {
            background: rgba(0, 255, 170, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.3);
        }

        .choice-button {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            background: var(--choice-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-button:hover {
            background: var(--choice-hover);
            border-color: var(--text-primary);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.3);
        }

        .choice-button.dangerous {
            border-color: var(--accent-pink);
            color: var(--accent-pink);
        }

        .choice-button.dangerous:hover {
            background: rgba(255, 0, 128, 0.1);
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .choices {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .loading {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .hidden { display: none; }
        .text-center { text-align: center; }
        .text-pink { color: var(--accent-pink); }
        .text-blue { color: var(--accent-blue); }
        .text-purple { color: var(--accent-purple); }

        .status-bar {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 8px;
            background: rgba(0, 0, 0, 0.8);
            padding: 3px 6px;
            border-radius: 3px;
            z-index: 100;
        }

        /* Course integration styles */
        .course-button {
            background: rgba(255, 0, 128, 0.2);
            border: 1px solid var(--accent-pink);
            padding: 6px 12px;
            border-radius: 4px;
            color: var(--accent-pink);
            font-size: 10px;
            margin-top: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .course-button:hover {
            background: rgba(255, 0, 128, 0.4);
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }
    </style>
</head>
<body>
        <div class="status-bar japanese-text">隙間女 v1.0</div>

    <div class="phone-container">
        <div class="screen">
            <div class="phone-header">
                <div>
                    <span style="display: flex; gap: 2px;">
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 1;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 1;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 0.3;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 0.3;"></div>
                    </span>
                    <span class="japanese-text">DoCoMo FOMA P901i</span>
                </div>
                <div class="battery">12% ⚠️</div>
            </div>

            <div id="gameContent" class="content-area"></div>

            <div id="choicesContainer" class="choices">
                <div class="loading japanese-text">システム初期化中...</div>
            </div>
        </div>
    </div>

    <script>
        // Telegram Web App API
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
        }

        class SukimaOnnaGame {
            constructor() {
                this.gameContent = document.getElementById('gameContent');
                this.choicesContainer = document.getElementById('choicesContainer');
                this.currentMemory = 0;
                this.gameState = {
                    deviceBooted: false,
                    memoriesUnlocked: 0,
                    investigationStarted: false,
                    truthRevealed: false,
                    finalChoice: null,
                    coursesViewed: false
                };
                this.playerData = {
                    name: null,
                    discoveries: [],
                    suspicions: []
                };

                // Получаем данные пользователя Telegram
                if (tg?.initDataUnsafe?.user) {
                    this.playerData.telegramUser = tg.initDataUnsafe.user;
                }

                this.init();
            }

            init() {
                this.showBootScreen();
            }

            showBootScreen() {
                this.gameContent.innerHTML = `
                    <div class="boot-screen">
                        <div class="device-logo japanese-text glitch-text">隙間女</div>
                        <div style="text-align: center; margin-bottom: 30px;">
                            <div style="font-size: 18px; color: var(--text-primary); margin-bottom: 8px;">МЁРТВЫЕ ПИКСЕЛИ</div>
                            <div style="font-size: 14px; color: var(--accent-pink); margin-bottom: 4px;">📱 Телефон нашли в щели между зданиями</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Записи Аиры Мацуи • Токио 2005</div>
                        </div>
                        <div class="progress-bar">
                            <div id="progressFill" class="progress-fill"></div>
                        </div>
                        <div id="bootMessage" class="boot-message japanese-text">メモリ復元中...</div>
                    </div>
                `;

                const messages = [
                    'メモリ復元中... (Восстановление памяти...)',
                    'データ解析中... (Анализ данных...)',
                    '暗号解読中... (Расшифровка...)',
                    '最後の記録発見... (Найдены последние записи...)',
                    'システム準備完了 (Система готова)'
                ];

                let progress = 0;
                const progressBar = document.getElementById('progressFill');
                const messageEl = document.getElementById('bootMessage');

                const bootInterval = setInterval(() => {
                    progress += 20;
                    progressBar.style.width = progress + '%';
                    
                    if (progress <= 100) {
                        messageEl.innerHTML = messages[Math.floor(progress / 20) - 1] || messages[messages.length - 1];
                    }
                    
                    if (progress >= 100) {
                        clearInterval(bootInterval);
                        setTimeout(() => {
                            this.gameState.deviceBooted = true;
                            this.showMainInterface();
                        }, 1000);
                    }
                }, 800);
            }

            showMainInterface() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 14px; color: var(--accent-pink); margin-bottom: 8px;">
                                <span class="japanese-symbol">隙</span>ЩЕЛЬ В СТЕНЕ
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                Записи Аиры Мацуи (松井愛良) • Токио, 2005
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                                Тату-мастер • Найдена мертвой в узкой щели
                            </div>
                        </div>

                        <div style="background: rgba(255, 0, 128, 0.1); border: 1px solid var(--accent-pink); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                            <div style="font-size: 11px; color: var(--accent-pink); margin-bottom: 4px;">⚠️ ВНИМАНИЕ</div>
                            <div style="font-size: 12px;">Телефон найден в щели между зданиями в районе Сибуя. Владелица найдена мертвой в том же месте. Причина смерти неизвестна - тело было сдавлено, но щель слишком узкая для человека.</div>
                        </div>

                        <div id="memoryList"></div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔍 Начать просмотр записей', 'start_investigation', false, () => {
                    this.startInvestigation();
                });
                this.addChoice('📱 Информация об устройстве', 'device_info', false, () => {
                    this.showDeviceInfo();
                });
            }

            startInvestigation() {
                this.gameState.investigationStarted = true;
                this.showMemory(1);
            }

            showMemory(memoryNumber) {
                this.currentMemory = memoryNumber;
                this.gameState.memoriesUnlocked = Math.max(this.gameState.memoriesUnlocked, memoryNumber);

                const memories = this.getMemories();
                const memory = memories[memoryNumber - 1];

                if (!memory) {
                    this.showEnding();
                    return;
                }

                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <div class="nav-button" onclick="game.showMainInterface()">← Назад</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                記録 ${memoryNumber} / ${memories.length}
                            </div>
                            ${memoryNumber < memories.length ? `<div class="nav-button" onclick="game.showMemory(${memoryNumber + 1})">Далее →</div>` : '<div></div>'}
                        </div>

                        <div class="memory-entry ${memory.type}">
                            <div class="memory-header">
                                <span><span class="japanese-symbol">${memory.symbol}</span>${memory.title}</span>
                                <span>${memory.timestamp}</span>
                            </div>
                            <div class="memory-text">${memory.content}</div>
                            ${memory.timestamp ? `<div class="memory-timestamp">${memory.metadata || ''}</div>` : ''}
                        </div>

                        ${memory.courses ? `
                            <div style="margin-top: 15px; padding: 12px; background: rgba(0, 255, 170, 0.1); border: 1px solid var(--text-primary); border-radius: 8px;">
                                <div style="font-size: 11px; color: var(--text-primary); margin-bottom: 8px;">📚 ОБУЧАЮЩИЕ МАТЕРИАЛЫ</div>
                                <div style="font-size: 12px; margin-bottom: 8px;">${memory.coursesText}</div>
                                ${memory.courses.map(course => `
                                    <button class="course-button" onclick="game.showCourse('${course.id}')">
                                        🎓 ${course.title} - ${course.price}
                                    </button>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;

                this.updateChoicesForMemory(memory, memoryNumber);
            }

            getMemories() {
                return [
                    {
                        symbol: '駅',
                        title: 'Женщина на платформе',
                        timestamp: '15.11.05 - 23:42',
                        type: 'normal',
                        content: `Вчера на станции Синдзюку видела странную женщину. Стояла на самом краю платформы, между вагонами поезда. В ЩЕЛИ. Как она туда поместилась?

Когда поезд тронулся, она не исчезла. Просто... сплющилась и поехала вместе с поездом. Как тень между вагонами.

Записываю, чтобы запомнить. Может, это вдохновение для нового тату-дизайна.`,
                        metadata: 'Голосовая запись → текст',
                        courses: [
                            { id: 'full_course', title: 'Полный курс тату-мастера', price: '22,500₽' },
                            { id: 'basic_course', title: 'Базовый курс с видео', price: '12,500₽' }
                        ],
                        coursesText: 'Странные видения часто становятся основой для уникальных тату-дизайнов. Изучи искусство воплощения образов в коже.'
                    },
                    {
                        symbol: '隙',
                        title: 'Клиентка из щели',
                        timestamp: '18.11.05 - 14:30',
                        type: 'normal',
                        content: `Сегодня пришла та самая женщина с платформы! Она хотела тату - силуэт человека, сдавленного между стенами. Очень специфический запрос.

Когда я делала набросок, она сказала: "Я знаю это место. Щель между зданиями в Сибуя. Там можно спрятаться от всего мира."

Самое странное - когда она поворачивалась боком, то почти исчезала. Как будто она действительно плоская.`,
                        metadata: 'Рабочие заметки',
                        courses: [
                            { id: 'text_course', title: 'Текстовый курс', price: '5,500₽' },
                            { id: 'procreate_course', title: 'Рисование в Procreate', price: '7,500₽' }
                        ],
                        coursesText: 'Уникальные клиенты требуют особого подхода. Изучи психологию работы с необычными заказчиками.'
                    },
                    {
                        symbol: '鏡',
                        title: 'Кисаи-мотоко в зеркале',
                        timestamp: '20.11.05 - 02:15',
                        type: 'corrupted',
                        content: `Не могу спать. В студийном зеркале... она есть. Кисаи-мотоко. Девочка из городской легенды.

Но она не ребёнок. Это взрослая женщина, сплющенная как лист бумаги. Она пытается выбраться из зеркала, но застревает в раме.

Камера телефона не фиксирует её. Но когда смотрю в зеркало в темноте - она там. Машет плоской рукой.`,
                        metadata: 'ФАЙЛ ПОВРЕЖДЁН - ЧАСТИЧНОЕ ВОССТАНОВЛЕНИЕ'
                    },
                    {
                        symbol: '街',
                        title: 'Щели в городе',
                        timestamp: '25.11.05 - 14:33',
                        type: 'corrupted',
                        content: `Начала замечать щели везде. Между зданиями в Сибуя, между вагонами поезда, между плитками в метро.

И в каждой щели - силуэты. Плоские люди, которые там живут. Они машут мне. Зовут присоединиться.

Вчера сама попробовала протиснуться в узкий проход между двумя домами. Получилось! Я стала тоньше. Кожа натянулась, но не порвалась.`,
                        metadata: 'Автосохранение активировано',
                        courses: [
                            { id: 'smm_course', title: 'Ведение соцсетей для тату', price: '12,500₽' }
                        ],
                        coursesText: 'Документируй необычные места Токио в соцсетях. Урбанистическая эстетика популярна среди молодежи.'
                    },
                    {
                        symbol: '痛',
                        title: 'Становлюсь плоской',
                        timestamp: '28.11.05 - 09:45',
                        type: 'corrupted',
                        content: `Что-то происходит с моим телом. Становлюсь всё тоньше. Рёбра почти не прощупываются. Могу протиснуться в щели, в которые раньше не помещалась рука.

Клиенты начали жаловаться - говорят, что когда я поворачиваюсь боком, меня почти не видно.

Сегодня впервые смогла пройти между двумя припаркованными машинами. Боком. Как лист бумаги.`,
                        metadata: 'Медицинские заметки'
                    },
                    {
                        symbol: '記',
                        title: 'Чужие воспоминания',
                        timestamp: '01.12.05 - 16:20',
                        type: 'system',
                        content: `ВНИМАНИЕ: Обнаружены воспоминания других людей в щелях.

ФАЙЛ: gap_memories.dat
СОДЕРЖАНИЕ: Воспоминания людей, которые "провалились" в щели Токио с 1960-х годов. Офисные работники, студенты, домохозяйки.

Все они искали место, где можно спрятаться от давления общества. И нашли.

СТАТУС: Коллективная память активна. Влияет на поведение пользователя.`,
                        metadata: 'СИСТЕМНОЕ СООБЩЕНИЕ'
                    },
                    {
                        symbol: '魂',
                        title: 'Правда о Щели',
                        timestamp: '05.12.05 - 22:17',
                        type: 'corrupted',
                        content: `Её зовут Ми요ко Танака. Жила в 16 веке. Мастер татуировки, который открыл способ переноса души через искусство.

Каждые 100 лет она выбирает нового носителя. Молодого мастера с талантом. Переносит в него свои знания и... себя.

Я не первая. Было много других. Их имена написаны в зеркале, но только я их вижу.`,
                        metadata: 'Личный дневник - последняя запись'
                    },
                    {
                        symbol: '選',
                        title: 'Последний выбор',
                        timestamp: '22.03.24 - 03:00',
                        type: 'system',
                        content: `КРИТИЧЕСКОЕ СОСТОЯНИЕ: Процесс слияния сознаний запущен.

Мийоко предлагает сделку: разделить тело. Она даст мне все знания тысячелетней традиции татуировки, секретные техники, доступ к древним символам силы.

Взамен - половину жизни. И студию. Навсегда.

Последний шанс отказаться. Или принять наследие.`,
                        metadata: 'ТРЕБУЕТСЯ РЕШЕНИЕ ПОЛЬЗОВАТЕЛЯ',
                        courses: [
                            { id: 'consultation', title: 'Консультация тату-мастера', price: '3,000₽' }
                        ],
                        coursesText: 'Перед принятием важных решений лучше посоветоваться с опытным мастером. Получи консультацию о выборе пути в тату-искусстве.'
                    }
                ];
            }

            updateChoicesForMemory(memory, memoryNumber) {
                this.choicesContainer.innerHTML = '';

                if (memoryNumber < this.getMemories().length) {
                    this.addChoice('📖 Следующая запись', 'next_memory', false, () => {
                        this.showMemory(memoryNumber + 1);
                    });
                }

                if (memoryNumber >= 3) {
                    this.addChoice('🔍 Исследовать студию', 'investigate_studio', false, () => {
                        this.showStudioInvestigation();
                    });
                }

                if (memoryNumber >= 6) {
                    this.addChoice('👥 Найти других жертв', 'find_victims', false, () => {
                        this.showVictimsStories();
                    });
                }

                if (memoryNumber === 8) {
                    this.addChoice('🤝 Принять предложение Мийоко', 'accept_deal', true, () => {
                        this.showEnding('accept');
                    });
                    this.addChoice('❌ Отказаться от сделки', 'reject_deal', false, () => {
                        this.showEnding('reject');
                    });
                    this.addChoice('⚔️ Попытаться изгнать дух', 'exorcise', true, () => {
                        this.showEnding('fight');
                    });
                }

                if (!this.gameState.coursesViewed && memoryNumber >= 2) {
                    this.addChoice('🎓 Изучить материалы о тату-мастерстве', 'view_courses', false, () => {
                        this.showCoursesOverview();
                    });
                }
            }

            showStudioInvestigation() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="nav-button" onclick="game.showMemory(${this.currentMemory})" style="margin-bottom: 15px;">← К записям</div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 16px; color: var(--accent-pink);">
                                <span class="japanese-symbol">影</span>ИССЛЕДОВАНИЕ СТУДИИ
                            </div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-text">
                                Ты приходишь в студию поздним вечером. Двери заперты, но замок... старинный. Явно не из этого времени.
                            </div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-text">
                                Внутри студия выглядит так, как будто работа остановилась мгновение назад. На столе - недоделанный эскиз дракона. Машинка для тату включена, иглы чистые.
                            </div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">
                                В зеркале ты видишь студию, но другую. Древнюю. Свет от свечей, бамбуковые инструменты, девушка в кимоно склоняется над клиенткой.
                            </div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-text">
                                Отражение поворачивается к тебе. Улыбается. 
                                <br><br>
                                <span class="japanese-text">"やっと来ましたね" (Наконец-то вы пришли)</span>
                                <br><br>
                                Мийоко ждала.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🪞 Подойти к зеркалу', 'approach_mirror', true, () => {
                    this.showMirrorScene();
                });
                this.addChoice('📝 Изучить эскизы', 'study_sketches', false, () => {
                    this.showSketchesScene();
                });
                this.addChoice('🚪 Уйти из студии', 'leave_studio', false, () => {
                    this.showMemory(this.currentMemory);
                });
            }

            showVictimsStories() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="nav-button" onclick="game.showMemory(${this.currentMemory})" style="margin-bottom: 15px;">← К записям</div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 16px; color: var(--accent-purple);">
                                <span class="japanese-symbol">記</span>АРХИВ ЖЕРТВ
                            </div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-header">
                                <span>Акари Сузуки (鈴木明) • 1923 год</span>
                                <span>Возраст: 19</span>
                            </div>
                            <div class="memory-text">
                                Молодая гейша, мечтавшая стать мастером тату. Последняя запись: "Старая мастер научила меня секрету вечной красоты. Завтра я стану бессмертной."
                            </div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-header">
                                <span>Хидэко Ямада (山田秀子) • 1967 год</span>
                                <span>Возраст: 24</span>
                            </div>
                            <div class="memory-text">
                                Художница, увлекавшаяся традиционным искусством. Нашла древние свитки с техниками. Исчезла после того, как сделала себе татуировку дракона.
                            </div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-header">
                                <span>Рейко Като (加藤玲子) • 1989 год</span>
                                <span>Возраст: 21</span>
                            </div>
                            <div class="memory-text">
                                Панк-рокерша, делала тату в подпольных салонах. Последнее видео: "Я встретила настоящего мастера. Она покажет мне техники, которым 400 лет. Я буду первой!"
                                <br><br>
                                <em>Тело так и не нашли.</em>
                            </div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">
                                ПАТТЕРН ОБНАРУЖЕН: Каждые 20-30 лет Мийоко выбирает новую жертву. Всегда молодые женщины, связанные с искусством.
                                <br><br>
                                Юкино - не первая. И не последняя.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔍 Найти способ остановить Мийоко', 'find_solution', false, () => {
                    this.showSolutionResearch();
                });
                this.addChoice('📞 Предупредить других мастеров', 'warn_others', false, () => {
                    this.showWarningScene();
                });
            }

            showCoursesOverview() {
                this.gameState.coursesViewed = true;
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="nav-button" onclick="game.showMemory(${this.currentMemory})" style="margin-bottom: 15px;">← К записям</div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 16px; color: var(--text-primary);">
                                <span class="japanese-symbol">学</span>АКАДЕМИЯ ТАТУ-МАСТЕРСТВА
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Секретные знания из записей Юкино</div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-text">
                                После изучения записей становится ясно - Юкино была настоящим мастером. В её заметках найдены ссылки на обучающие материалы, которые она изучала.
                            </div>
                        </div>

                        <div style="margin: 15px 0; background: rgba(0, 255, 170, 0.1); border: 1px solid var(--text-primary); border-radius: 8px; padding: 15px;">
                            <div style="font-size: 13px; font-weight: bold; margin-bottom: 10px; color: var(--text-primary);">ДОСТУПНЫЕ КУРСЫ:</div>
                            
                            <div style="margin: 8px 0; padding: 8px; background: rgba(255, 0, 128, 0.1); border-radius: 4px;">
                                <strong>Полный курс тату-мастера</strong> - 22,500₽ (было 45,000₽)
                                <br><small>Теория + видео + наставничество • 1-2 месяца</small>
                                <button class="course-button" onclick="game.showCourse('full_course')">🎓 Подробнее</button>
                            </div>

                            <div style="margin: 8px 0; padding: 8px; background: rgba(0, 153, 255, 0.1); border-radius: 4px;">
                                <strong>Базовый курс с видео</strong> - 12,500₽ (было 25,000₽)
                                <br><small>Теория + видео + финальный созвон</small>
                                <button class="course-button" onclick="game.showCourse('basic_course')">🎓 Подробнее</button>
                            </div>

                            <div style="margin: 8px 0; padding: 8px; background: rgba(138, 43, 226, 0.1); border-radius: 4px;">
                                <strong>Ведение соцсетей для тату</strong> - 12,500₽ (было 25,000₽)
                                <br><small>Reels, TikTok, продвижение • 3 недели</small>
                                <button class="course-button" onclick="game.showCourse('smm_course')">🎓 Подробнее</button>
                            </div>

                            <div style="margin: 8px 0; padding: 8px; background: rgba(0, 255, 170, 0.1); border-radius: 4px;">
                                <strong>Рисование в Procreate</strong> - 7,500₽ (было 15,000₽)
                                <br><small>Цифровые эскизы для тату</small>
                                <button class="course-button" onclick="game.showCourse('procreate_course')">🎓 Подробнее</button>
                            </div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">
                                🎁 Промокод SHADOWS50 - скидка 50% на все курсы
                                <br>+ Бесплатная консультация с мастером
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📋 Скопировать промокод', 'copy_promo', false, () => {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText('SHADOWS50');
                    }
                    this.showNotification('Промокод SHADOWS50 скопирован!');
                });
            }

            showCourse(courseId) {
                const courses = {
                    'full_course': {
                        title: 'ПОЛНЫЙ КУРС ТАТУ-МАСТЕРА',
                        description: 'Стань профессиональным тату-мастером с нуля, как Юкино. Полная программа с наставничеством и поддержкой.',
                        skills: ['Теория татуировки', 'Работа с оборудованием', 'Эскизы и дизайн', 'Гигиена и безопасность', 'Развитие соцсетей', 'Продвижение студии'],
                        duration: '1-2 месяца',
                        project: 'Портфолио тату-мастера',
                        price: '45,000₽',
                        salePrice: '22,500₽'
                    },
                    'basic_course': {
                        title: 'БАЗОВЫЙ КУРС С ВИДЕО',
                        description: 'Оптимальный выбор для изучения тату-искусства. Теория + практические видео-уроки.',
                        skills: ['Теория татуировки', 'Видео-уроки по практике', 'Разработка эскизов', 'Работа с пигментом', 'Основы продвижения'],
                        duration: '1-2 месяца',
                        project: 'Первые татуировки',
                        price: '25,000₽',
                        salePrice: '12,500₽'
                    },
                    'smm_course': {
                        title: 'ВЕДЕНИЕ СОЦСЕТЕЙ ДЛЯ ТАТУ',
                        description: 'Раскрути свой тату-профиль, как это делала Юкино! Изучи продвижение в Instagram, TikTok.',
                        skills: ['Бренд тату-мастера', 'Оформление профиля', 'Контент-планы', 'Reels и TikTok', 'Stories и взаимодействие', 'Продажи через соцсети'],
                        duration: '3 недели',
                        project: 'Раскрученный профиль',
                        price: '25,000₽',
                        salePrice: '12,500₽'
                    },
                    'procreate_course': {
                        title: 'РИСОВАНИЕ В PROCREATE',
                        description: 'Создавай эскизы для тату в цифровом формате, как в записях Юкино. Освой Procreate.',
                        skills: ['Основы Procreate', 'Цифровое рисование', 'Создание эскизов', 'Работа с цветом', 'Графика для тату'],
                        duration: 'Гибкий график',
                        project: 'Портфолио эскизов',
                        price: '15,000₽',
                        salePrice: '7,500₽'
                    }
                };

                const course = courses[courseId];
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="nav-button" onclick="game.showCoursesOverview()" style="margin-bottom: 15px;">← К курсам</div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-pink);">${course.title}</div>
                        </div>
                        
                        <div class="memory-entry normal">
                            <div class="memory-text">${course.description}</div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">
                                <strong>Изучишь:</strong><br>
                                ${course.skills.map(skill => `• ${skill}`).join('<br>')}
                            </div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-text">
                                <strong>Длительность:</strong> ${course.duration}<br>
                                <strong>Итоговый проект:</strong> ${course.project}
                            </div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-text">
                                <span style="text-decoration: line-through; opacity: 0.6;">${course.price}</span><br>
                                <strong style="font-size: 18px; color: var(--text-primary);">${course.salePrice}</strong><br>
                                <span style="font-size: 10px;">🔥 Скидка 50% до конца месяца</span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('💳 Купить курс', 'buy_course', false, () => {
                    this.showPayment(course);
                });
                this.addChoice('📱 Узнать подробнее', 'more_info', false, () => {
                    if (tg) {
                        tg.openLink('https://t.me/your_support_bot');
                    }
                });
            }

            showPayment(course) {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px; text-align: center;">
                        <div style="font-size: 16px; color: var(--text-primary); margin-bottom: 20px;">ОФОРМЛЕНИЕ ПОКУПКИ</div>
                        
                        <div class="memory-entry system">
                            <div class="memory-text">Курс: ${course.title}</div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-text">К оплате: <strong>${course.salePrice}</strong></div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-text">⚠️ Безопасная оплата через Telegram Payments</div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('💳 Оплатить', 'process_payment', false, () => {
                    if (tg) {
                        tg.MainButton.text = "ОПЛАТИТЬ " + course.salePrice;
                        tg.MainButton.show();
                        tg.MainButton.onClick(() => {
                            this.processTelegramPayment(course);
                        });
                    }
                    this.showPaymentSuccess(course);
                });
            }

            showPaymentSuccess(course) {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px; text-align: center;">
                        <div style="font-size: 16px; color: var(--text-primary); margin-bottom: 20px;">ПОКУПКА ЗАВЕРШЕНА</div>
                        
                        <div class="memory-entry system">
                            <div class="memory-text">✅ Оплата прошла успешно!</div>
                        </div>

                        <div class="memory-entry normal">
                            <div class="memory-text">Курс "${course.title}" добавлен в вашу библиотеку.</div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">📧 Ссылка на обучение отправлена на email<br>💬 Доступ к закрытому чату студентов<br>📚 Все материалы доступны сразу</div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🎓 Начать обучение', 'start_learning', false, () => {
                    if (tg) {
                        tg.openLink('https://your-learning-platform.com/start');
                    }
                    this.showCoursesOverview();
                });
            }

            showEnding(choice = null) {
                this.gameState.finalChoice = choice;
                this.gameState.truthRevealed = true;

                let endingContent = '';
                
                if (choice === 'accept') {
                    endingContent = `
                        <div class="memory-entry system">
                            <div class="memory-text">КОНЦОВКА: СЛИЯНИЕ ДУШ</div>
                        </div>
                        <div class="memory-entry corrupted">
                            <div class="memory-text">Ты принимаешь предложение Мийоко. Древние знания вливаются в твой разум. Секреты, которым сотни лет.</div>
                        </div>
                        <div class="memory-entry normal">
                            <div class="memory-text">Теперь ты владеешь техниками, которые не знает никто из современных мастеров. Твоя студия станет легендарной.</div>
                        </div>
                        <div class="memory-entry system">
                            <div class="memory-text">Но цена... половина жизни. И через 50 лет ты тоже будешь искать ученицу.</div>
                        </div>
                    `;
                } else if (choice === 'reject') {
                    endingContent = `
                        <div class="memory-entry system">
                            <div class="memory-text">КОНЦОВКА: СОПРОТИВЛЕНИЕ</div>
                        </div>
                        <div class="memory-entry normal">
                            <div class="memory-text">Ты отказываешься от сделки. Мийоко исчезает, но не навсегда. Она найдёт другую жертву.</div>
                        </div>
                        <div class="memory-entry corrupted">
                            <div class="memory-text">Студия пуста. Юкино не вернётся. Но её записи остались... как предупреждение.</div>
                        </div>
                        <div class="memory-entry system">
                            <div class="memory-text">Ты решаешь изучить тату-мастерство самостоятельно. Безопасным путём.</div>
                        </div>
                    `;
                } else if (choice === 'fight') {
                    endingContent = `
                        <div class="memory-entry system">
                            <div class="memory-text">КОНЦОВКА: ЭКЗОРЦИЗМ</div>
                        </div>
                        <div class="memory-entry corrupted">
                            <div class="memory-text">Ты пытаешься изгнать дух Мийоко. Ритуал опасен, но ты готова рискнуть.</div>
                        </div>
                        <div class="memory-entry normal">
                            <div class="memory-text">После борьбы Мийоко побеждена... но знания потеряны навсегда. Древние техники умерли с ней.</div>
                        </div>
                        <div class="memory-entry system">
                            <div class="memory-text">Юкино свободна, но многое забыла. Вы вместе начинаете изучать современное тату-искусство.</div>
                        </div>
                    `;
                } else {
                    endingContent = `
                        <div class="memory-entry system">
                            <div class="memory-text">ЗАГАДКА РАСКРЫТА</div>
                        </div>
                        <div class="memory-entry normal">
                            <div class="memory-text">Телефон внезапно отключается. Записи исчезают. Остаётся только один вопрос...</div>
                        </div>
                        <div class="memory-entry corrupted">
                            <div class="memory-text">Что случилось с Юкино? И готова ли ты войти в её студию?</div>
                        </div>
                    `;
                }

                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 18px; color: var(--accent-pink);">
                                <span class="japanese-symbol">終</span>ФИНАЛ
                            </div>
                        </div>

                        ${endingContent}

                        <div style="margin-top: 20px; padding: 12px; background: rgba(0, 255, 170, 0.1); border: 1px solid var(--text-primary); border-radius: 8px;">
                            <div style="font-size: 11px; color: var(--text-primary); margin-bottom: 8px;">💡 ЭПИЛОГ</div>
                            <div style="font-size: 12px;">История Юкино показала тебе мир тату-мастерства. Хочешь изучить это искусство в реальности? Начни с наших курсов!</div>
                            <button class="course-button" onclick="game.showCoursesOverview()">
                                🎓 Стать тату-мастером
                            </button>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Начать заново', 'restart', false, () => {
                    location.reload();
                });
                this.addChoice('📱 Поделиться историей', 'share', false, () => {
                    if (tg) {
                        tg.switchInlineQuery('Прошла мистический квест про тату-мастера! Попробуйте и вы 🐉');
                    }
                });
            }

            addChoice(text, id, dangerous = false, callback) {
                const button = document.createElement('button');
                button.className = `choice-button ${dangerous ? 'dangerous' : ''}`;
                button.textContent = text;
                button.onclick = callback;
                this.choicesContainer.appendChild(button);
            }

            showNotification(text) {
                const notification = document.createElement('div');
                notification.style.cssText = `position: fixed; top: 50px; right: 20px; background: var(--accent-pink); color: white; padding: 10px; border-radius: 5px; z-index: 1000;`;
                notification.textContent = text;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }

            showDeviceInfo() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="nav-button" onclick="game.showMainInterface()" style="margin-bottom: 15px;">← Назад</div>
                        
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 16px; color: var(--accent-blue);">
                                <span class="japanese-symbol">機</span>ИНФОРМАЦИЯ ОБ УСТРОЙСТВЕ
                            </div>
                        </div>

                        <div class="memory-entry system">
                            <div class="memory-text">
                                Модель: Nokia 3310 改 (Modified)<br>
                                Владелец: 高橋雪乃 (Юкино Такахаси)<br>
                                Статус: Пропавшая без вести<br>
                                Память: 64MB (повреждена)<br>
                                Особенности: Самостоятельная активация
                            </div>
                        </div>

                        <div class="memory-entry corrupted">
                            <div class="memory-text">
                                ⚠️ АНОМАЛИИ:<br>
                                • Устройство включается без батареи<br>
                                • Записи восстанавливаются сами<br>
                                • Камера снимает то, чего нет<br>
                                • GPS показывает места из прошлого
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔍 К записям', 'back_to_memories', false, () => {
                    this.showMainInterface();
                });
            }

            processTelegramPayment(course) {
                if (tg && tg.initDataUnsafe?.user) {
                    const paymentData = {
                        course: course.title,
                        price: course.salePrice,
                        userId: tg.initDataUnsafe.user.id,
                        userName: tg.initDataUnsafe.user.first_name,
                        timestamp: Date.now()
                    };
                    
                    tg.sendData(JSON.stringify({
                        type: 'purchase',
                        data: paymentData
                    }));
                }
            }
        }

        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new MizuNoKageGame();
            
            if (tg) {
                tg.MainButton.text = "НАЧАТЬ РАССЛЕДОВАНИЕ";
                tg.MainButton.show();
                tg.MainButton.onClick(() => {
                    if (!game.gameState.deviceBooted) {
                        game.showBootScreen();
                    }
                });
                
                tg.setHeaderColor('#0a0a0f');
                tg.setBackgroundColor('#0a0a0f');
            }
        });

        // Глитч эффекты
        setInterval(() => {
            if (Math.random() < 0.03) {
                document.body.style.filter = `hue-rotate(${Math.random() * 360}deg) saturate(${1 + Math.random()})`; 
                setTimeout(() => { document.body.style.filter = 'none'; }, 150);
            }
        }, 2000);

        // Мигание текста
        setInterval(() => {
            const glitchElements = document.querySelectorAll('.glitch-text');
            glitchElements.forEach(el => {
                if (Math.random() < 0.1) {
                    el.style.opacity = Math.random() > 0.5 ? '1' : '0.7';
                    setTimeout(() => { el.style.opacity = '1'; }, 100);
                }
            });
        }, 1000);
    </script>
</body>
</html>
