<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>白石隆浩 | TWITTER УБИЙЦА</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap');
        
        :root {
            --bg-dark: #0a0a0f;
            --bg-secondary: #1a1a2e;
            --text-primary: #00ffaa;
            --text-secondary: #666;
            --accent-pink: #ff0080;
            --accent-blue: #0099ff;
            --accent-purple: #8a2be2;
            --border-color: #333;
            --choice-bg: #001a0f;
            --choice-hover: #002a1f;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg-dark);
            color: var(--text-primary);
            font-family: 'Share Tech Mono', 'Noto Sans JP', monospace;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Glitch эффекты как в 2005-2006 */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0, 255, 170, 0.03) 2px,
                    rgba(0, 255, 170, 0.03) 4px
                );
            pointer-events: none;
            z-index: 1;
            animation: scanlines 2s linear infinite;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }

        .phone-container {
            width: 380px;
            height: 720px;
            margin: 20px auto;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 4px solid var(--border-color);
            border-radius: 25px;
            padding: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 170, 0.3);
            position: relative;
            z-index: 2;
        }

        .screen {
            width: 100%;
            height: 100%;
            background: var(--bg-dark);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .phone-header {
            background: var(--bg-secondary);
            padding: 8px 12px;
            font-size: 0.7rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .japanese-text {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 300;
        }

        .glitch-text {
            animation: textGlitch 2s infinite;
        }

        @keyframes textGlitch {
            0%, 90% { transform: translateX(0); }
            92% { transform: translateX(-2px); }
            94% { transform: translateX(2px); }
            96% { transform: translateX(-1px); }
            98% { transform: translateX(1px); }
            100% { transform: translateX(0); }
        }

        .battery {
            color: var(--accent-pink);
            animation: batteryBlink 2s infinite;
        }

        @keyframes batteryBlink {
            0%, 70% { opacity: 1; }
            85%, 100% { opacity: 0.3; }
        }

        .content-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
        }

        .screen-title {
            color: var(--text-primary);
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 10px var(--text-primary);
        }

        /* STORY SEGMENTS */
        .story-entry {
            margin: 8px 0;
            padding: 12px;
            border-radius: 8px;
            animation: messageSlide 0.3s ease-out;
            position: relative;
        }

        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .story-entry.normal {
            background: rgba(0, 255, 170, 0.1);
            border: 1px solid rgba(0, 255, 170, 0.3);
        }

        .story-entry.twitter {
            background: linear-gradient(45deg, rgba(0, 153, 255, 0.2), rgba(0, 0, 0, 0.8));
            border: 1px solid var(--accent-blue);
            animation: twitterGlitch 0.5s ease-out;
        }

        .story-entry.death {
            background: linear-gradient(45deg, rgba(255,0,0,0.3), rgba(139,0,0,0.1));
            border: 2px solid #ff0000;
            animation: deathPulse 2s infinite;
        }

        .story-entry.hacker {
            background: linear-gradient(45deg, rgba(0,255,0,0.2), rgba(0,139,0,0.1));
            border: 1px solid #00ff00;
            font-family: 'Courier New', monospace;
        }

        @keyframes deathPulse {
            0%, 100% { 
                background: linear-gradient(45deg, rgba(255,0,0,0.3), rgba(139,0,0,0.1));
                box-shadow: 0 0 10px rgba(255,0,0,0.5);
            }
            50% { 
                background: linear-gradient(45deg, rgba(255,0,0,0.6), rgba(139,0,0,0.3));
                box-shadow: 0 0 30px rgba(255,0,0,0.8);
            }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        @keyframes screenFlash {
            0% { background: rgba(255, 0, 0, 0); }
            50% { background: rgba(255, 0, 0, 0.5); }
            100% { background: rgba(255, 0, 0, 0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-1deg); }
            75% { transform: translateX(5px) rotate(1deg); }
        }

        @keyframes bloodDrip {
            0% { 
                transform: translateY(-100px);
                opacity: 0;
            }
            50% { 
                opacity: 1;
            }
            100% { 
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        .horror-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: 1000;
        }

        .blood-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 50%, rgba(139, 0, 0, 0.3) 100%);
            pointer-events: none;
            z-index: 999;
            opacity: 0;
            transition: opacity 2s;
        }

        .heartbeat {
            animation: heartbeatPulse 1.5s infinite;
        }

        @keyframes heartbeatPulse {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.05); }
            50% { transform: scale(1); }
            75% { transform: scale(1.02); }
        }

        .panic-text {
            animation: shake 0.5s infinite, colorPanic 2s infinite;
        }

        @keyframes colorPanic {
            0%, 100% { color: #ff0000; }
            50% { color: #ffffff; }
        }

        .typing-effect {
            overflow: hidden;
            border-right: 2px solid #00ff00;
            white-space: nowrap;
            animation: typing 3s steps(50) 1s forwards, blinkCursor 1s infinite;
        }

        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes blinkCursor {
            0%, 50% { border-color: #00ff00; }
            51%, 100% { border-color: transparent; }
        }

        .story-entry.danger {
            background: linear-gradient(45deg, rgba(255, 0, 128, 0.2), rgba(0, 0, 0, 0.8));
            border: 1px solid var(--accent-pink);
            animation: dangerGlitch 0.5s ease-out;
        }

        .story-entry.system {
            background: rgba(138, 43, 226, 0.2);
            border: 1px solid var(--accent-purple);
            text-align: center;
            font-size: 12px;
        }

        @keyframes twitterGlitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        @keyframes dangerGlitch {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }

        .story-header {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }

        .story-text {
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .story-timestamp {
            font-size: 10px;
            color: var(--text-secondary);
            text-align: right;
        }

        .japanese-symbol {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 18px;
            color: var(--accent-pink);
            display: inline-block;
            margin-right: 8px;
        }

        /* CHOICES */
        .choice-button {
            width: 100%;
            padding: 12px;
            margin: 6px 0;
            background: var(--choice-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .choice-button:hover {
            background: var(--choice-hover);
            border-color: var(--text-primary);
            box-shadow: 0 0 10px rgba(0, 255, 170, 0.3);
        }

        .choice-button.dangerous {
            border-color: var(--accent-pink);
            color: var(--accent-pink);
            animation: dangerPulse 2s infinite;
        }

        .choice-button.dangerous:hover {
            background: rgba(255, 0, 128, 0.1);
            box-shadow: 0 0 10px rgba(255, 0, 128, 0.3);
        }

        .choice-button.warning {
            background: linear-gradient(45deg, rgba(255, 136, 0, 0.1), rgba(255, 170, 0, 0.05));
            border: 1px solid #ff8800;
            color: #ff8800;
            animation: warningGlow 1.5s infinite;
        }

        .choice-button.primary {
            background: linear-gradient(45deg, rgba(0, 102, 255, 0.1), rgba(0, 136, 255, 0.05));
            border: 1px solid #0066ff;
            color: #0066ff;
            animation: primaryPulse 2s infinite;
        }

        .choice-button.secondary {
            background: linear-gradient(45deg, rgba(102, 102, 102, 0.1), rgba(136, 136, 136, 0.05));
            border: 1px solid #666666;
            color: #cccccc;
        }

        @keyframes dangerPulse {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 0, 128, 0.5);
            }
            50% { 
                box-shadow: 0 0 15px rgba(255, 0, 128, 0.8);
            }
        }

        @keyframes warningGlow {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(255, 136, 0, 0.5);
            }
            50% { 
                box-shadow: 0 0 15px rgba(255, 136, 0, 0.8);
            }
        }

        @keyframes primaryPulse {
            0%, 100% { 
                box-shadow: 0 0 5px rgba(0, 102, 255, 0.5);
            }
            50% { 
                box-shadow: 0 0 10px rgba(0, 102, 255, 0.8);
            }
        }

        .choice-button.time-sensitive {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            animation: timePulse 1s infinite;
        }

        @keyframes timePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .choices {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }

        .loading {
            text-align: center;
            color: var(--text-secondary);
            font-size: 12px;
            padding: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .timer {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 128, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            z-index: 100;
        }

        .hidden { display: none; }
        .text-center { text-align: center; }
        .text-pink { color: var(--accent-pink); }
        .text-blue { color: var(--accent-blue); }
        .text-purple { color: var(--accent-purple); }
    </style>
</head>
<body>
    <div class="phone-container">
        <div class="screen">
            <div class="phone-header">
                <div>
                    <span style="display: flex; gap: 2px;">
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 1;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 1;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 0.3;"></div>
                        <div style="width: 3px; height: 8px; background: var(--text-primary); opacity: 0.3;"></div>
                    </span>
                    <span class="japanese-text">DoCoMo P901i</span>
                </div>
                <div class="battery">08% ⚠️</div>
            </div>

            <div id="timer" class="timer hidden">Время: 0:00</div>
            <div id="gameContent" class="content-area"></div>
            <div id="choicesContainer" class="choices">
                <div class="loading japanese-text">システム起動中...</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#0a0a0f');
            tg.setBackgroundColor('#0a0a0f');
        }

        class ShiraishiGame {
            constructor() {
                this.gameContent = document.getElementById('gameContent');
                this.choicesContainer = document.getElementById('choicesContainer');
                this.timer = document.getElementById('timer');
                this.currentChapter = 0;
                this.timeElapsed = 0;
                this.gameTimer = null;
                
                this.gameState = {
                    isSearching: false,
                    foundClues: [],
                    contactedPolice: false,
                    warnedOthers: false,
                    savedLives: 0,
                    playerChoices: [],
                    timeLimit: 300, // 5 минут до прибытия Айко к убийце
                    currentVictim: null,
                    killerAlerted: false,
                    playerLocation: 'home',
                    stealthMode: false,
                    deathCounter: 0,
                    investigationPoints: 0,
                    horrorMode: false,
                    soundEnabled: true,
                    difficulty: 'extreme',
                    playerHealth: 100,
                    stamina: 100,
                    stress: 0,
                    comboStreak: 0,
                    perfectActions: 0,
                    mistakes: 0,
                    skillLevel: 1,
                    achievements: [],
                    multiTasking: false,
                    timePreasure: 1.5, // Множитель скорости времени
                    failureCount: 0
                };

                // Добавляем звуковые эффекты и интерактивность
                this.initializeEffects();

                this.story = {
                    playerName: tg?.initDataUnsafe?.user?.first_name || 'Такеши',
                    girlfriendName: 'Тамура Айко',
                    killerName: 'Сираиси Такахиро'
                };

                this.init();
            }

            init() {
                this.showIntro();
            }

            initializeEffects() {
                // Создаем overlay для эффектов
                this.createHorrorOverlay();
                
                // Добавляем обработчики для интерактивности
                this.addInteractiveEvents();
                
                // Инициализируем звуковые эффекты
                this.initSounds();
            }

            createHorrorOverlay() {
                // Кровавый overlay
                const bloodOverlay = document.createElement('div');
                bloodOverlay.className = 'blood-overlay';
                bloodOverlay.id = 'blood-overlay';
                document.body.appendChild(bloodOverlay);
                
                // Horror effects container
                const horrorContainer = document.createElement('div');
                horrorContainer.className = 'horror-effect';
                horrorContainer.id = 'horror-effects';
                document.body.appendChild(horrorContainer);
            }

            addInteractiveEvents() {
                // Вибрация для мобильных устройств
                this.vibrate = (pattern) => {
                    if (navigator.vibrate) {
                        navigator.vibrate(pattern);
                    }
                };

                // Flash эффект
                this.flashScreen = (color = 'red', duration = 500) => {
                    const flash = document.createElement('div');
                    flash.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: ${color};
                        opacity: 0.7;
                        z-index: 9999;
                        pointer-events: none;
                        animation: screenFlash ${duration}ms ease-out;
                    `;
                    document.body.appendChild(flash);
                    setTimeout(() => flash.remove(), duration);
                };

                // Shake эффект
                this.shakeScreen = (duration = 1000) => {
                    document.body.style.animation = `shake 0.5s infinite`;
                    setTimeout(() => {
                        document.body.style.animation = '';
                    }, duration);
                };
            }

            initSounds() {
                // Создаем звуковые эффекты через Web Audio API
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    this.sounds = {
                        heartbeat: this.createHeartbeatSound(),
                        alarm: this.createAlarmSound(),
                        typing: this.createTypingSound(),
                        scream: this.createScreamSound()
                    };
                } catch (e) {
                    console.log('Audio not supported');
                    this.soundEnabled = false;
                }
            }

            createHeartbeatSound() {
                return () => {
                    if (!this.soundEnabled) return;
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(80, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(60, this.audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.3, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.1);
                };
            }

            createAlarmSound() {
                return () => {
                    if (!this.soundEnabled) return;
                    for (let i = 0; i < 3; i++) {
                        setTimeout(() => {
                            const oscillator = this.audioContext.createOscillator();
                            const gainNode = this.audioContext.createGain();
                            
                            oscillator.connect(gainNode);
                            gainNode.connect(this.audioContext.destination);
                            
                            oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                            oscillator.frequency.setValueAtTime(600, this.audioContext.currentTime + 0.1);
                            
                            gainNode.gain.setValueAtTime(0.2, this.audioContext.currentTime);
                            gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);
                            
                            oscillator.start(this.audioContext.currentTime);
                            oscillator.stop(this.audioContext.currentTime + 0.2);
                        }, i * 300);
                    }
                };
            }

            createTypingSound() {
                return () => {
                    if (!this.soundEnabled) return;
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(2000, this.audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.05);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 0.05);
                };
            }

            createScreamSound() {
                return () => {
                    if (!this.soundEnabled) return;
                    const oscillator = this.audioContext.createOscillator();
                    const gainNode = this.audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(this.audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, this.audioContext.currentTime + 1);
                    
                    gainNode.gain.setValueAtTime(0.15, this.audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 1);
                    
                    oscillator.start(this.audioContext.currentTime);
                    oscillator.stop(this.audioContext.currentTime + 1);
                };
            }

            activateHorrorMode() {
                this.gameState.horrorMode = true;
                document.getElementById('blood-overlay').style.opacity = '1';
                
                // Эффект сердцебиения
                setInterval(() => {
                    if (this.gameState.horrorMode) {
                        this.sounds.heartbeat();
                        this.vibrate([100, 100, 100]);
                    }
                }, 2000);

                // Случайные флэши
                setInterval(() => {
                    if (this.gameState.horrorMode && Math.random() < 0.3) {
                        this.flashScreen('darkred', 200);
                    }
                }, 5000);
            }

            typewriterEffect(element, text, speed = 50) {
                element.innerHTML = '';
                let i = 0;
                const timer = setInterval(() => {
                    if (i < text.length) {
                        element.innerHTML += text.charAt(i);
                        this.sounds.typing();
                        i++;
                    } else {
                        clearInterval(timer);
                    }
                }, speed);
            }

            playFightSequence() {
                const fightElement = document.getElementById('fight-sequence');
                const sequence = [
                    "Ты бросаешься на Сираиси!",
                    "Он больше и сильнее, но ты дерёшься за жизнь сестры!",
                    "💥 УДАР! Твой кулак попадает в челюсть!",
                    "🤕 Он контратакует - уклоняешься!",
                    "⚡ Второй удар! Он пошатывается!",
                    "🩸 Кровь течёт из его носа!",
                    "💪 Финальный удар! Он падает!",
                    "🎯 ПОБЕДА! Сираиси без сознания!",
                    "😱 Айко в ужасе прижимается к стене!",
                    "🎉 АЙКО СПАСЕНА!"
                ];
                
                let index = 0;
                const timer = setInterval(() => {
                    if (index < sequence.length) {
                        const line = document.createElement('div');
                        line.style.cssText = 'margin: 5px 0; font-weight: bold;';
                        
                        if (index >= 7) { // Победные моменты
                            line.style.color = '#00ff00';
                            line.style.animation = 'blink 1s infinite';
                        } else if (sequence[index].includes('💥') || sequence[index].includes('⚡')) {
                            line.style.color = '#ff8800';
                            this.flashScreen('orange', 200);
                            this.vibrate([150]);
                        }
                        
                        this.typewriterEffect(line, sequence[index], 30);
                        fightElement.appendChild(line);
                        
                        // Звуковые эффекты для ударов
                        if (sequence[index].includes('💥') || sequence[index].includes('⚡')) {
                            setTimeout(() => this.sounds.alarm(), 500);
                        }
                        
                        index++;
                    } else {
                        clearInterval(timer);
                        setTimeout(() => {
                            this.choicesContainer.innerHTML = '';
                            this.addChoice('🎯 ГЕРОИЧЕСКАЯ ПОБЕДА!', () => { this.heroicVictory(); }, 'primary');
                        }, 2000);
                    }
                }, 1500);
            }

            // МИНИ-ИГРА: БЫСТРЫЕ КЛИКИ
            startQuickTimeEvent(action, successCallback, failCallback) {
                const qteContainer = document.createElement('div');
                qteContainer.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(255, 0, 0, 0.9);
                    padding: 30px;
                    border-radius: 10px;
                    text-align: center;
                    z-index: 10000;
                    animation: blink 0.5s infinite;
                `;
                
                let clicks = 0;
                const requiredClicks = 10;
                const timeLimit = 3000;
                
                qteContainer.innerHTML = `
                    <div style="color: white; font-size: 18px; margin-bottom: 20px;">
                        ${action}
                    </div>
                    <div style="color: yellow; font-size: 24px; margin-bottom: 20px;">
                        КЛИКАЙ БЫСТРО!
                    </div>
                    <button id="qte-button" style="
                        font-size: 20px;
                        padding: 15px 30px;
                        background: #ff0000;
                        color: white;
                        border: none;
                        border-radius: 5px;
                        cursor: pointer;
                    ">
                        КЛИК! (${clicks}/${requiredClicks})
                    </button>
                    <div id="qte-timer" style="color: yellow; margin-top: 10px;">
                        Времени: 3.0с
                    </div>
                `;
                
                document.body.appendChild(qteContainer);
                
                const button = document.getElementById('qte-button');
                const timerDisplay = document.getElementById('qte-timer');
                
                let timeLeft = timeLimit;
                const countdown = setInterval(() => {
                    timeLeft -= 100;
                    timerDisplay.textContent = `Времени: ${(timeLeft / 1000).toFixed(1)}с`;
                    
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        document.body.removeChild(qteContainer);
                        this.flashScreen('darkred', 1000);
                        this.sounds.scream();
                        failCallback();
                        return;
                    }
                }, 100);
                
                button.onclick = () => {
                    clicks++;
                    this.sounds.typing();
                    this.vibrate([50]);
                    button.textContent = `КЛИК! (${clicks}/${requiredClicks})`;
                    
                    if (clicks >= requiredClicks) {
                        clearInterval(countdown);
                        document.body.removeChild(qteContainer);
                        this.flashScreen('green', 500);
                        this.vibrate([100, 50, 100]);
                        successCallback();
                    }
                };
            }

            // ИНТЕРАКТИВНАЯ ПОГОНЯ
            startChaseSequence(callback) {
                const directions = ['⬅️', '➡️', '⬆️', '⬇️'];
                let currentDirection = 0;
                let correctInputs = 0;
                const requiredInputs = 8;
                
                const chaseContainer = document.createElement('div');
                chaseContainer.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 0.8);
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                chaseContainer.innerHTML = `
                    <div style="color: white; font-size: 24px; margin-bottom: 30px;">
                        🏃‍♂️ БЕГИ ОТ УБИЙЦЫ!
                    </div>
                    <div id="chase-direction" style="font-size: 80px; margin-bottom: 30px;">
                        ${directions[0]}
                    </div>
                    <div style="color: yellow; font-size: 18px;">
                        Нажми кнопку с правильным направлением!
                    </div>
                    <div style="margin-top: 20px;">
                        ${directions.map(dir => `
                            <button class="direction-btn" data-direction="${dir}" style="
                                font-size: 40px;
                                margin: 10px;
                                padding: 15px;
                                background: #333;
                                color: white;
                                border: 2px solid #666;
                                border-radius: 10px;
                                cursor: pointer;
                            ">
                                ${dir}
                            </button>
                        `).join('')}
                    </div>
                    <div style="color: white; margin-top: 20px;">
                        Прогресс: ${correctInputs}/${requiredInputs}
                    </div>
                `;
                
                document.body.appendChild(chaseContainer);
                
                const updateDirection = () => {
                    currentDirection = Math.floor(Math.random() * directions.length);
                    document.getElementById('chase-direction').textContent = directions[currentDirection];
                };
                
                chaseContainer.querySelectorAll('.direction-btn').forEach(btn => {
                    btn.onclick = () => {
                        if (btn.dataset.direction === directions[currentDirection]) {
                            correctInputs++;
                            this.sounds.typing();
                            this.vibrate([50]);
                            
                            if (correctInputs >= requiredInputs) {
                                document.body.removeChild(chaseContainer);
                                this.flashScreen('green', 500);
                                callback(true);
                            } else {
                                updateDirection();
                                chaseContainer.querySelector('div:last-child').textContent = 
                                    `Прогресс: ${correctInputs}/${requiredInputs}`;
                            }
                        } else {
                            document.body.removeChild(chaseContainer);
                            this.flashScreen('red', 1000);
                            this.sounds.scream();
                            callback(false);
                        }
                    };
                });
                
                // Автоматическая смена направления
                setInterval(updateDirection, 2000);
            }

            // ===== ЭКСТРЕМАЛЬНАЯ СИСТЕМА СЛОЖНОСТИ =====

            createComplexityUI() {
                const complexityPanel = document.createElement('div');
                complexityPanel.id = 'complexity-panel';
                complexityPanel.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    width: 200px;
                    background: rgba(0, 0, 0, 0.8);
                    color: white;
                    padding: 10px;
                    border-radius: 5px;
                    z-index: 9998;
                    font-size: 12px;
                `;
                
                complexityPanel.innerHTML = `
                    <div>💚 Здоровье: <span id="health-bar">100%</span></div>
                    <div>⚡ Выносливость: <span id="stamina-bar">100%</span></div>
                    <div>😰 Стресс: <span id="stress-bar">0%</span></div>
                    <div>🔥 Комбо: <span id="combo-counter">x0</span></div>
                    <div>🎯 Точность: <span id="accuracy-counter">0/0</span></div>
                    <div>⭐ Уровень: <span id="skill-level">1</span></div>
                `;
                
                document.body.appendChild(complexityPanel);
            }

            updateStressLevel() {
                // Стресс увеличивается со временем
                if (this.gameState.timeLimit < 120) {
                    this.gameState.stress += 0.5;
                }
                if (this.gameState.timeLimit < 60) {
                    this.gameState.stress += 1;
                }
                
                // Стресс влияет на скорость времени
                if (this.gameState.stress > 50) {
                    this.gameState.timePreasure = 2.0;
                } else if (this.gameState.stress > 80) {
                    this.gameState.timePreasure = 2.5;
                }
                
                this.updateComplexityUI();
            }

            updateComplexityUI() {
                const panel = document.getElementById('complexity-panel');
                if (!panel) return;
                
                document.getElementById('health-bar').textContent = `${this.gameState.playerHealth}%`;
                document.getElementById('stamina-bar').textContent = `${this.gameState.stamina}%`;
                document.getElementById('stress-bar').textContent = `${Math.round(this.gameState.stress)}%`;
                document.getElementById('combo-counter').textContent = `x${this.gameState.comboStreak}`;
                document.getElementById('accuracy-counter').textContent = `${this.gameState.perfectActions}/${this.gameState.perfectActions + this.gameState.mistakes}`;
                document.getElementById('skill-level').textContent = this.gameState.skillLevel;
                
                // Изменяем цвета в зависимости от состояния
                if (this.gameState.playerHealth < 30) {
                    document.getElementById('health-bar').style.color = '#ff0000';
                }
                if (this.gameState.stress > 70) {
                    document.getElementById('stress-bar').style.color = '#ff0000';
                    document.getElementById('stress-bar').style.animation = 'blink 0.5s infinite';
                }
            }

            startStressSystem() {
                // Система постоянного давления
                setInterval(() => {
                    if (this.gameState.stamina > 0) {
                        this.gameState.stamina -= 0.3;
                    }
                    
                    if (this.gameState.stamina < 20) {
                        this.gameState.timePreasure += 0.1;
                    }
                    
                    this.updateComplexityUI();
                }, 1000);
            }

            // ЭКСТРЕМАЛЬНАЯ МИНИ-ИГРА: МНОГОЗАДАЧНОСТЬ
            startMultiTaskChallenge(tasks, timeLimit, callback) {
                this.gameState.multiTasking = true;
                const container = document.createElement('div');
                container.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(0, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                `;
                
                container.innerHTML = `
                    <div style="color: red; font-size: 24px; margin-bottom: 20px; animation: blink 0.5s infinite;">
                        ⚠️ ЭКСТРЕМАЛЬНАЯ МНОГОЗАДАЧНОСТЬ ⚠️
                    </div>
                    <div style="color: white; text-align: center; margin-bottom: 30px;">
                        Выполни ВСЕ задачи одновременно за ${timeLimit/1000} секунд!
                    </div>
                    
                    <!-- Задача 1: Быстрые клики -->
                    <div style="margin: 10px; padding: 15px; background: #333; border-radius: 5px;">
                        <div style="color: yellow;">Задача 1: Взлом системы</div>
                        <button id="hack-button" style="padding: 10px 20px; background: #008000; color: white; border: none; border-radius: 3px;">
                            ВЗЛОМ (${0}/20)
                        </button>
                    </div>
                    
                    <!-- Задача 2: Последовательность -->
                    <div style="margin: 10px; padding: 15px; background: #333; border-radius: 5px;">
                        <div style="color: yellow;">Задача 2: Код доступа</div>
                        <div id="sequence-display" style="font-size: 18px; margin: 10px 0; color: #00ff00; font-weight: bold;">N8C63K</div>
                        <input id="sequence-input" placeholder="Введи код точно" style="padding: 5px; width: 150px; text-transform: uppercase;">
                    </div>
                    
                    <!-- Задача 3: Реакция -->
                    <div style="margin: 10px; padding: 15px; background: #333; border-radius: 5px;">
                        <div style="color: yellow;">Задача 3: Система безопасности</div>
                        <div id="reaction-game" style="width: 200px; height: 50px; background: #666; position: relative; border-radius: 5px;">
                            <div id="reaction-target" style="width: 20px; height: 20px; background: red; border-radius: 50%; position: absolute; top: 15px; left: 10px; transition: left 0.1s;"></div>
                        </div>
                        <button id="reaction-button" style="padding: 5px 15px; margin-top: 5px;">ПЕРЕХВАТ</button>
                    </div>
                    
                    <div id="multitask-timer" style="color: red; font-size: 20px; margin-top: 20px;">
                        ${timeLimit/1000}.0
                    </div>
                `;
                
                document.body.appendChild(container);
                this.runMultiTaskGame(timeLimit, callback);
            }

            runMultiTaskGame(timeLimit, callback) {
                let hackClicks = 0;
                let sequenceCompleted = false;
                let reactionCompleted = false;
                let timeLeft = timeLimit;
                
                // Задача 1: Быстрые клики
                document.getElementById('hack-button').onclick = () => {
                    hackClicks++;
                    document.getElementById('hack-button').textContent = `ВЗЛОМ (${hackClicks}/20)`;
                    this.sounds.typing();
                    
                    if (hackClicks >= 20) {
                        document.getElementById('hack-button').style.background = '#008000';
                        document.getElementById('hack-button').textContent = 'ВЗЛОМ ЗАВЕРШЁН ✓';
                        
                        // Проверяем, завершены ли все задачи
                        this.checkAllTasksCompleted(hackClicks, sequenceCompleted, reactionCompleted, countdown, moveTarget, callback);
                    }
                };
                
                // Задача 2: Последовательность
                const sequence = 'N8C63K'; // Фиксированный код для соответствия интерфейсу
                document.getElementById('sequence-display').textContent = sequence;
                document.getElementById('sequence-input').oninput = (e) => {
                    if (e.target.value.toUpperCase() === sequence) {
                        sequenceCompleted = true;
                        e.target.style.background = '#008000';
                        e.target.value = 'КОД ПРИНЯТ ✓';
                        e.target.disabled = true;
                        
                        // Проверяем, завершены ли все задачи
                        this.checkAllTasksCompleted(hackClicks, sequenceCompleted, reactionCompleted, countdown, moveTarget, callback);
                    }
                };
                
                // Задача 3: Движущаяся цель
                let targetPosition = 10;
                let targetDirection = 1;
                const moveTarget = setInterval(() => {
                    targetPosition += targetDirection * 5;
                    if (targetPosition >= 170 || targetPosition <= 10) {
                        targetDirection *= -1;
                    }
                    document.getElementById('reaction-target').style.left = targetPosition + 'px';
                }, 100);
                
                document.getElementById('reaction-button').onclick = () => {
                    if (targetPosition >= 85 && targetPosition <= 105) { // Центральная зона
                        reactionCompleted = true;
                        clearInterval(moveTarget);
                        document.getElementById('reaction-target').style.background = '#008000';
                        document.getElementById('reaction-button').textContent = 'ПЕРЕХВАЧЕНО ✓';
                        document.getElementById('reaction-button').disabled = true;
                        
                        // Проверяем, завершены ли все задачи
                        this.checkAllTasksCompleted(hackClicks, sequenceCompleted, reactionCompleted, countdown, moveTarget, callback);
                    } else {
                        this.gameState.mistakes++;
                        this.flashScreen('red', 200);
                    }
                };
                
                // Таймер
                const countdown = setInterval(() => {
                    timeLeft -= 100;
                    document.getElementById('multitask-timer').textContent = (timeLeft / 1000).toFixed(1);
                    
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        clearInterval(moveTarget);
                        document.body.removeChild(document.querySelector('div[style*="position: fixed"]'));
                        this.gameState.multiTasking = false;
                        
                        const success = hackClicks >= 20 && sequenceCompleted && reactionCompleted;
                        if (success) {
                            this.gameState.perfectActions++;
                            this.gameState.comboStreak++;
                            this.flashScreen('green', 500);
                            callback(true);
                        } else {
                            this.gameState.mistakes++;
                            this.gameState.comboStreak = 0;
                            this.gameState.stress += 20;
                            this.flashScreen('red', 1000);
                            callback(false);
                        }
                    }
                }, 100);
            }

            checkAllTasksCompleted(hackClicks, sequenceCompleted, reactionCompleted, countdown, moveTarget, callback) {
                // Проверяем, выполнены ли все 3 задачи
                if (hackClicks >= 20 && sequenceCompleted && reactionCompleted) {
                    // ВСЕ ЗАДАЧИ ВЫПОЛНЕНЫ! ДОСРОЧНАЯ ПОБЕДА!
                    clearInterval(countdown);
                    clearInterval(moveTarget);
                    
                    // Удаляем интерфейс многозадачности
                    const container = document.body.querySelector('div[style*="position: fixed"]');
                    if (container) {
                        document.body.removeChild(container);
                    }
                    
                    this.gameState.multiTasking = false;
                    this.gameState.perfectActions++;
                    this.gameState.comboStreak++;
                    
                    // Показываем сообщение о досрочной победе
                    this.gameContent.innerHTML = `
                        <div class="story-entry normal" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: black;">
                            <div class="story-header">
                                <span style="font-size: 24px;">🏆 ДОСРОЧНАЯ ПОБЕДА! 🏆</span>
                                <span>МНОГОЗАДАЧНОСТЬ ЗАВЕРШЕНА</span>
                            </div>
                            <div class="story-text">
                                <strong>НЕВЕРОЯТНО! Ты выполнил все задачи!</strong><br><br>
                                ✅ Взлом системы: ЗАВЕРШЁН<br>
                                ✅ Код доступа: N8C63K - ПРИНЯТ<br>
                                ✅ Система безопасности: ОБОЙДЕНА<br><br>
                                <span style="font-size: 18px; color: #8B0000;">
                                    Комбо-стрик: x${this.gameState.comboStreak}<br>
                                    Идеальных действий: ${this.gameState.perfectActions}
                                </span><br><br>
                                <strong>Ты мастер многозадачности! 🎯</strong>
                            </div>
                        </div>
                    `;
                    
                    this.flashScreen('gold', 1000);
                    this.sounds.typing();
                    this.vibrate([100, 50, 100, 50, 200]);
                    
                    // Ждём секунду, чтобы игрок оценил победу
                    setTimeout(() => {
                        callback(true);
                    }, 1500);
                    
                    return true; // Задачи выполнены
                }
                
                return false; // Задачи ещё не выполнены
            }

            // ЭКСТРЕМАЛЬНАЯ МИНИ-ИГРА: МАСТЕР РЕАКЦИИ
            startReactionMaster(difficulty, callback) {
                const sequences = [
                    ['↑', '↓', '←', '→'],
                    ['🔴', '🟡', '🔵', '🟢'],
                    ['A', 'B', 'X', 'Y'],
                    ['1', '2', '3', '4']
                ];
                
                const container = document.createElement('div');
                container.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: black;
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                `;
                
                container.innerHTML = `
                    <div style="color: red; font-size: 28px; margin-bottom: 30px; animation: blink 0.3s infinite;">
                        ⚡ МАСТЕР РЕАКЦИИ ⚡
                    </div>
                    <div style="color: white; margin-bottom: 20px;">
                        Повтори последовательность ТОЧНО и БЫСТРО!
                    </div>
                    <div id="sequence-display" style="font-size: 60px; margin: 30px 0; min-height: 80px;">
                        Приготовься...
                    </div>
                    <div id="input-buttons" style="display: none;">
                        <!-- Кнопки будут добавлены динамически -->
                    </div>
                    <div id="reaction-stats" style="color: yellow; margin-top: 20px;">
                        Раунд: 1/5 | Ошибки: 0/2
                    </div>
                `;
                
                document.body.appendChild(container);
                this.runReactionMaster(sequences, difficulty, callback);
            }

            runReactionMaster(sequences, difficulty, callback) {
                let round = 0;
                let errors = 0;
                let maxErrors = 2;
                let currentSequence = [];
                let playerInput = [];
                let sequenceLength = 3;
                
                const startRound = () => {
                    if (round >= 5) {
                        document.body.removeChild(container);
                        this.gameState.perfectActions++;
                        this.gameState.skillLevel++;
                        callback(true);
                        return;
                    }
                    
                    round++;
                    playerInput = [];
                    const sequenceType = sequences[Math.floor(Math.random() * sequences.length)];
                    currentSequence = [];
                    
                    for (let i = 0; i < sequenceLength + round; i++) {
                        currentSequence.push(sequenceType[Math.floor(Math.random() * sequenceType.length)]);
                    }
                    
                    document.getElementById('reaction-stats').textContent = 
                        `Раунд: ${round}/5 | Ошибки: ${errors}/${maxErrors}`;
                    
                    // Показать последовательность
                    let index = 0;
                    document.getElementById('sequence-display').textContent = '';
                    document.getElementById('input-buttons').style.display = 'none';
                    
                    const showSequence = setInterval(() => {
                        if (index < currentSequence.length) {
                            document.getElementById('sequence-display').textContent = currentSequence[index];
                            this.sounds.typing();
                            this.flashScreen('blue', 200);
                            index++;
                        } else {
                            clearInterval(showSequence);
                            document.getElementById('sequence-display').textContent = 'ПОВТОРИ!';
                            this.showInputButtons(sequenceType, currentSequence, callback, container, errors, maxErrors, round);
                        }
                    }, 800 / difficulty); // Быстрее на высокой сложности
                };
                
                const container = document.querySelector('div[style*="position: fixed"]:last-child');
                startRound();
            }

            showInputButtons(sequenceType, targetSequence, callback, container, errors, maxErrors, round) {
                const inputContainer = document.getElementById('input-buttons');
                inputContainer.style.display = 'block';
                inputContainer.innerHTML = '';
                
                let playerInput = [];
                
                // Создаем кнопки для каждого типа символов в последовательности
                sequenceType.forEach(symbol => {
                    const button = document.createElement('button');
                    button.textContent = symbol;
                    button.style.cssText = `
                        font-size: 40px;
                        margin: 10px;
                        padding: 15px 20px;
                        background: #444;
                        color: white;
                        border: 2px solid #666;
                        border-radius: 10px;
                        cursor: pointer;
                    `;
                    
                    button.onclick = () => {
                        playerInput.push(symbol);
                        this.sounds.typing();
                        this.vibrate([50]);
                        
                        // Проверяем текущий ввод
                        if (playerInput[playerInput.length - 1] !== targetSequence[playerInput.length - 1]) {
                            // Неправильный символ!
                            this.gameState.mistakes++;
                            errors++;
                            this.flashScreen('red', 300);
                            this.sounds.scream();
                            
                            if (errors >= maxErrors) {
                                document.body.removeChild(container);
                                callback(false);
                                return;
                            } else {
                                // Сброс и новый раунд
                                playerInput = [];
                                document.getElementById('reaction-stats').textContent = 
                                    `Раунд: ${round}/5 | Ошибки: ${errors}/${maxErrors}`;
                                setTimeout(() => {
                                    this.continueReactionMaster(callback, container, errors, maxErrors);
                                }, 1000);
                                return;
                            }
                        }
                        
                        // Правильный символ
                        if (playerInput.length === targetSequence.length) {
                            // Последовательность завершена правильно!
                            this.gameState.perfectActions++;
                            this.flashScreen('green', 300);
                            
                            setTimeout(() => {
                                this.continueReactionMaster(callback, container, errors, maxErrors);
                            }, 500);
                        }
                    };
                    
                    inputContainer.appendChild(button);
                });
            }

            continueReactionMaster(callback, container, errors, maxErrors) {
                // Проверяем, нужно ли продолжать или игра завершена
                const currentRound = parseInt(document.getElementById('reaction-stats').textContent.split('/')[0].split(': ')[1]);
                
                if (currentRound >= 5) {
                    // Все раунды пройдены успешно
                    document.body.removeChild(container);
                    this.gameState.skillLevel++;
                    this.flashScreen('gold', 1000);
                    callback(true);
                } else {
                    // Продолжаем с новым раундом
                    this.runReactionMaster([
                        ['↑', '↓', '←', '→'],
                        ['🔴', '🟡', '🔵', '🟢'],
                        ['A', 'B', 'X', 'Y'],
                        ['1', '2', '3', '4']
                    ], 3, callback);
                }
            }

            // ЭКСТРЕМАЛЬНАЯ БОЕВАЯ СИСТЕМА
            startExtremeComBat() {
                const phases = [
                    { name: 'Реакция', type: 'reaction', difficulty: 3 },
                    { name: 'Комбо-удары', type: 'combo', difficulty: 4 },
                    { name: 'Уклонение', type: 'dodge', difficulty: 5 },
                    { name: 'Финальная атака', type: 'final', difficulty: 6 }
                ];
                
                let currentPhase = 0;
                
                const startPhase = () => {
                    if (currentPhase >= phases.length) {
                        // Все фазы пройдены - победа!
                        this.choicesContainer.innerHTML = '';
                        this.addChoice('🎯 ЛЕГЕНДАРНАЯ ПОБЕДА!', () => { this.legendaryVictory(); }, 'primary');
                        return;
                    }
                    
                    const phase = phases[currentPhase];
                    
                    switch(phase.type) {
                        case 'reaction':
                            this.startReactionMaster(phase.difficulty, (success) => {
                                if (success) {
                                    currentPhase++;
                                    startPhase();
                                } else {
                                    this.combatFailure();
                                }
                            });
                            break;
                            
                        case 'combo':
                            this.startComboChallenge(phase.difficulty, (success) => {
                                if (success) {
                                    currentPhase++;
                                    startPhase();
                                } else {
                                    this.combatFailure();
                                }
                            });
                            break;
                            
                        case 'dodge':
                            this.startDodgeChallenge(phase.difficulty, (success) => {
                                if (success) {
                                    currentPhase++;
                                    startPhase();
                                } else {
                                    this.combatFailure();
                                }
                            });
                            break;
                            
                        case 'final':
                            this.startFinalStrike(phase.difficulty, (success) => {
                                if (success) {
                                    currentPhase++;
                                    startPhase();
                                } else {
                                    this.combatFailure();
                                }
                            });
                            break;
                    }
                };
                
                startPhase();
            }

            startComboChallenge(difficulty, callback) {
                const container = document.createElement('div');
                container.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: rgba(139, 0, 0, 0.9);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                `;
                
                const combos = ['👊→🦵→👊', '🦵→👊→🦵→👊', '👊→👊→🦵', '🦵→👊→👊→🦵→👊'];
                const targetCombo = combos[Math.floor(Math.random() * combos.length)];
                const comboArray = targetCombo.split('→');
                let playerCombo = [];
                
                container.innerHTML = `
                    <div style="color: white; font-size: 24px; margin-bottom: 20px;">
                        ⚔️ КОМБО-УДАРЫ ⚔️
                    </div>
                    <div style="color: yellow; font-size: 18px; margin-bottom: 30px;">
                        Повтори комбо: ${targetCombo}
                    </div>
                    <div style="margin: 20px;">
                        <button id="punch-btn" style="font-size: 30px; padding: 15px; margin: 10px; background: #8B0000; color: white; border: none; border-radius: 10px;">
                            👊 УДАР
                        </button>
                        <button id="kick-btn" style="font-size: 30px; padding: 15px; margin: 10px; background: #8B0000; color: white; border: none; border-radius: 10px;">
                            🦵 НОГОЙ
                        </button>
                    </div>
                    <div id="player-combo" style="color: white; font-size: 20px; margin-top: 20px;">
                        Твоё комбо: 
                    </div>
                    <div style="color: red; margin-top: 20px;">
                        Время: <span id="combo-timer">5.0</span>с
                    </div>
                `;
                
                document.body.appendChild(container);
                
                let timeLeft = 5000;
                const countdown = setInterval(() => {
                    timeLeft -= 100;
                    document.getElementById('combo-timer').textContent = (timeLeft / 1000).toFixed(1);
                    
                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        document.body.removeChild(container);
                        callback(false);
                    }
                }, 100);
                
                document.getElementById('punch-btn').onclick = () => {
                    playerCombo.push('👊');
                    this.sounds.alarm();
                    this.vibrate([100]);
                    this.checkCombo(comboArray, playerCombo, container, countdown, callback);
                };
                
                document.getElementById('kick-btn').onclick = () => {
                    playerCombo.push('🦵');
                    this.sounds.alarm();
                    this.vibrate([100]);
                    this.checkCombo(comboArray, playerCombo, container, countdown, callback);
                };
            }

            checkCombo(target, player, container, countdown, callback) {
                document.getElementById('player-combo').textContent = 'Твоё комбо: ' + player.join('→');
                
                if (player.length === target.length) {
                    const success = player.every((move, index) => move === target[index]);
                    clearInterval(countdown);
                    document.body.removeChild(container);
                    
                    if (success) {
                        this.gameState.comboStreak++;
                        this.flashScreen('green', 500);
                        callback(true);
                    } else {
                        this.gameState.comboStreak = 0;
                        this.flashScreen('red', 1000);
                        callback(false);
                    }
                } else if (player[player.length - 1] !== target[player.length - 1]) {
                    // Неправильный ход
                    clearInterval(countdown);
                    document.body.removeChild(container);
                    this.flashScreen('red', 1000);
                    callback(false);
                }
            }

            startDodgeChallenge(difficulty, callback) {
                const container = document.createElement('div');
                container.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: black;
                    z-index: 10000;
                    overflow: hidden;
                `;
                
                container.innerHTML = `
                    <div style="position: absolute; top: 20px; left: 50%; transform: translateX(-50%); color: white; font-size: 20px;">
                        ⚡ УКЛОНЕНИЕ ОТ АТАК ⚡
                    </div>
                    <div id="player-dodge" style="
                        position: absolute;
                        bottom: 50px;
                        left: 50%;
                        transform: translateX(-50%);
                        width: 40px;
                        height: 40px;
                        background: #00ff00;
                        border-radius: 50%;
                    "></div>
                    <div style="position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); color: white;">
                        Используй ←→ для уклонения от красных атак!
                    </div>
                    <div style="position: absolute; top: 60px; right: 20px; color: white;">
                        Уклонений: <span id="dodge-count">0/10</span>
                    </div>
                `;
                
                document.body.appendChild(container);
                this.runDodgeGame(container, difficulty, callback);
            }

            runDodgeGame(container, difficulty, callback) {
                let dodgeCount = 0;
                let playerPosition = 50; // проценты
                let attacks = [];
                
                const player = document.getElementById('player-dodge');
                
                // Управление
                const movePlayer = (direction) => {
                    if (direction === 'left' && playerPosition > 10) {
                        playerPosition -= 10;
                    } else if (direction === 'right' && playerPosition < 90) {
                        playerPosition += 10;
                    }
                    player.style.left = playerPosition + '%';
                };
                
                // Создание атак
                const createAttack = () => {
                    const attack = document.createElement('div');
                    attack.style.cssText = `
                        position: absolute;
                        top: -20px;
                        left: ${Math.random() * 80 + 10}%;
                        width: 30px;
                        height: 30px;
                        background: #ff0000;
                        border-radius: 50%;
                        animation: fall ${3000 / difficulty}ms linear;
                    `;
                    
                    container.appendChild(attack);
                    attacks.push(attack);
                    
                    setTimeout(() => {
                        if (container.contains(attack)) {
                            container.removeChild(attack);
                            attacks = attacks.filter(a => a !== attack);
                        }
                    }, 3000 / difficulty);
                };
                
                // Проверка столкновений
                const checkCollisions = () => {
                    const playerRect = player.getBoundingClientRect();
                    
                    attacks.forEach(attack => {
                        const attackRect = attack.getBoundingClientRect();
                        
                        if (playerRect.left < attackRect.right &&
                            playerRect.right > attackRect.left &&
                            playerRect.top < attackRect.bottom &&
                            playerRect.bottom > attackRect.top) {
                            // Столкновение!
                            document.body.removeChild(container);
                            this.gameState.playerHealth -= 20;
                            this.flashScreen('red', 1000);
                            this.sounds.scream();
                            callback(false);
                            return;
                        }
                    });
                    
                    // Успешное уклонение
                    attacks.forEach(attack => {
                        if (attack.offsetTop > window.innerHeight - 100) {
                            dodgeCount++;
                            document.getElementById('dodge-count').textContent = `${dodgeCount}/10`;
                            
                            if (dodgeCount >= 10) {
                                document.body.removeChild(container);
                                this.gameState.perfectActions++;
                                this.flashScreen('green', 500);
                                callback(true);
                                return;
                            }
                        }
                    });
                };
                
                // События клавиатуры и кнопок
                const handleInput = (e) => {
                    if (e.key === 'ArrowLeft') movePlayer('left');
                    if (e.key === 'ArrowRight') movePlayer('right');
                };
                
                document.addEventListener('keydown', handleInput);
                
                // Добавляем кнопки для мобильных
                const leftBtn = document.createElement('button');
                leftBtn.textContent = '←';
                leftBtn.style.cssText = 'position: absolute; bottom: 100px; left: 20px; font-size: 30px; padding: 15px; background: #333; color: white; border: none; border-radius: 10px;';
                leftBtn.onclick = () => movePlayer('left');
                container.appendChild(leftBtn);
                
                const rightBtn = document.createElement('button');
                rightBtn.textContent = '→';
                rightBtn.style.cssText = 'position: absolute; bottom: 100px; right: 20px; font-size: 30px; padding: 15px; background: #333; color: white; border: none; border-radius: 10px;';
                rightBtn.onclick = () => movePlayer('right');
                container.appendChild(rightBtn);
                
                // Добавляем CSS для анимации падения
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes fall {
                        from { top: -20px; }
                        to { top: 100vh; }
                    }
                `;
                document.head.appendChild(style);
                
                // Генерация атак
                const attackInterval = setInterval(() => {
                    createAttack();
                }, 1000 / difficulty);
                
                // Проверка столкновений
                const collisionInterval = setInterval(checkCollisions, 50);
                
                // Очистка через 30 секунд
                setTimeout(() => {
                    document.removeEventListener('keydown', handleInput);
                    clearInterval(attackInterval);
                    clearInterval(collisionInterval);
                    if (document.body.contains(container)) {
                        document.body.removeChild(container);
                        callback(false);
                    }
                }, 30000);
            }

            startFinalStrike(difficulty, callback) {
                const container = document.createElement('div');
                container.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100vw;
                    height: 100vh;
                    background: linear-gradient(45deg, #8B0000, #000000);
                    z-index: 10000;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                `;
                
                container.innerHTML = `
                    <div style="color: gold; font-size: 32px; margin-bottom: 30px; animation: blink 0.2s infinite;">
                        ⚡ ФИНАЛЬНЫЙ УДАР ⚡
                    </div>
                    <div style="color: white; text-align: center; margin-bottom: 30px;">
                        Идеальное время для решающего удара!<br>
                        Жми ТОЧНО в момент когда цель станет ЗОЛОТОЙ!
                    </div>
                    <div id="final-target" style="
                        width: 100px;
                        height: 100px;
                        border-radius: 50%;
                        background: #ff0000;
                        margin: 30px 0;
                        transition: background-color 0.1s;
                        cursor: pointer;
                        animation: finalPulse 2s infinite;
                    "></div>
                    <div style="color: yellow; font-size: 18px;">
                        Попыток: <span id="final-attempts">3</span>
                    </div>
                `;
                
                document.body.appendChild(container);
                
                let attempts = 3;
                let isGolden = false;
                let gameActive = true;
                
                const target = document.getElementById('final-target');
                
                // Случайные интервалы золотого момента
                const scheduleGoldenMoment = () => {
                    if (!gameActive) return;
                    
                    const delay = Math.random() * 3000 + 1000; // 1-4 секунды
                    
                    setTimeout(() => {
                        if (!gameActive) return;
                        
                        isGolden = true;
                        target.style.background = 'gold';
                        target.style.boxShadow = '0 0 30px gold';
                        this.sounds.alarm();
                        this.vibrate([100]);
                        
                        // Золотой момент длится очень мало времени
                        setTimeout(() => {
                            if (!gameActive) return;
                            isGolden = false;
                            target.style.background = '#ff0000';
                            target.style.boxShadow = 'none';
                            scheduleGoldenMoment();
                        }, 300 / difficulty); // Чем выше сложность, тем короче момент
                        
                    }, delay);
                };
                
                target.onclick = () => {
                    if (!gameActive) return;
                    
                    if (isGolden) {
                        // УСПЕХ!
                        gameActive = false;
                        target.style.background = '#00ff00';
                        target.style.boxShadow = '0 0 50px #00ff00';
                        this.flashScreen('gold', 1000);
                        this.sounds.typing();
                        this.vibrate([200, 100, 200]);
                        
                        setTimeout(() => {
                            document.body.removeChild(container);
                            this.gameState.perfectActions++;
                            this.gameState.comboStreak++;
                            callback(true);
                        }, 1000);
                        
                    } else {
                        // ПРОМАХ!
                        attempts--;
                        document.getElementById('final-attempts').textContent = attempts;
                        this.flashScreen('red', 500);
                        this.sounds.scream();
                        this.vibrate([300]);
                        this.gameState.mistakes++;
                        
                        if (attempts <= 0) {
                            gameActive = false;
                            document.body.removeChild(container);
                            callback(false);
                        }
                    }
                };
                
                // Добавляем CSS для анимации пульса
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes finalPulse {
                        0%, 100% { 
                            transform: scale(1);
                            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
                        }
                        50% { 
                            transform: scale(1.1);
                            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
                        }
                    }
                `;
                document.head.appendChild(style);
                
                // Запускаем первый золотой момент
                scheduleGoldenMoment();
                
                // Таймаут на всю мини-игру
                setTimeout(() => {
                    if (gameActive) {
                        gameActive = false;
                        document.body.removeChild(container);
                        callback(false);
                    }
                }, 20000); // 20 секунд на финальный удар
            }

            combatFailure() {
                this.gameState.playerHealth -= 50;
                this.gameState.stress += 40;
                
                if (this.gameState.playerHealth <= 0) {
                    this.gameFailed('combat_death');
                } else {
                    this.gameContent.innerHTML = `
                        <div class="story-entry death">
                            <div class="story-header">
                                <span>💀 БОЕВАЯ НЕУДАЧА</span>
                                <span>КРИТИЧЕСКОЕ СОСТОЯНИЕ</span>
                            </div>
                            <div class="story-text">
                                Ты получил серьёзные травмы в схватке!<br>
                                Здоровье: ${this.gameState.playerHealth}%<br>
                                Стресс: ${Math.round(this.gameState.stress)}%<br><br>
                                <span style="color: var(--accent-red);">
                                    Нужно быстро принимать решение!
                                </span>
                            </div>
                        </div>
                    `;
                    
                    this.choicesContainer.innerHTML = '';
                    this.addChoice('🏃‍♂️ Спасать Айко любой ценой!', () => { this.desperateRescue(); }, 'danger');
                    this.addChoice('📞 Звать подкрепление', () => { this.callForHelp(); }, 'warning');
                }
            }

            legendaryVictory() {
                this.stopTimer();
                this.gameState.skillLevel = 10;
                this.gameState.perfectActions += 5;
                
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>👑 ЛЕГЕНДАРНЫЙ МАСТЕР</span>
                            <span>АБСОЛЮТНАЯ ПОБЕДА</span>
                        </div>
                        <div class="story-text">
                            <strong style="font-size: 24px; color: gold;">
                                🏆 НЕВЕРОЯТНОЕ МАСТЕРСТВО! 🏆
                            </strong><br><br>
                            ✅ Все экстремальные испытания пройдены<br>
                            ✅ Комбо-стрик: x${this.gameState.comboStreak}<br>
                            ✅ Идеальная точность: ${this.gameState.perfectActions} действий<br>
                            ✅ Уровень мастерства: ${this.gameState.skillLevel}<br><br>
                            <strong>Ты не просто спас Айко - ты стал ЛЕГЕНДОЙ!</strong><br>
                            Сираиси повержен с абсолютным мастерством! 🥋👑
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('👑 Принять статус легенды', () => { this.restart(); }, 'primary');
                this.addChoice('📖 Сравнить с реальной историей', () => { this.investigateKiller(); }, 'secondary');
            }

            // ФУНКЦИИ ДЛЯ КРИТИЧЕСКИХ СИТУАЦИЙ

            desperateRescue() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger heartbeat">
                        <div class="story-header">
                            <span class="panic-text">🔥 ОТЧАЯННОЕ СПАСЕНИЕ</span>
                            <span>КРИТИЧЕСКОЕ СОСТОЯНИЕ</span>
                        </div>
                        <div class="story-text">
                            Несмотря на травмы, ты бросаешься спасать Айко!<br>
                            Кровь застилает глаза, но ты не сдаёшься!<br><br>
                            <span style="color: var(--accent-red);">
                                Здоровье: ${this.gameState.playerHealth}% (КРИТИЧНО!)<br>
                                Стресс: ${Math.round(this.gameState.stress)}% (ЭКСТРЕМАЛЬНЫЙ!)
                            </span><br><br>
                            Это твой последний шанс! Готов рискнуть всем?
                        </div>
                    </div>
                `;

                // УЛЬТРА-СЛОЖНОЕ ИСПЫТАНИЕ ДЛЯ РАНЕНОГО ИГРОКА
                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ ЭКСТРЕМАЛЬНЫЙ СПАСАТЕЛЬНЫЙ РЕЖИМ!', () => { this.extremeRescueMode(); }, 'danger');
                this.addChoice('💊 Попытаться восстановить силы', () => { this.recoverStrength(); }, 'warning');
            }

            callForHelp() {
                this.gameContent.innerHTML = `
                    <div class="story-entry system">
                        <div class="story-header">
                            <span>📞 ЭКСТРЕННЫЙ ВЫЗОВ</span>
                            <span>ПОСЛЕДНЯЯ НАДЕЖДА</span>
                        </div>
                        <div class="story-text">
                            "ПОМОГИТЕ! Я ранен! Убийца держит заложницу!"<br>
                            "Адрес: Дзама, Сибуя-дай-маэ, 2-14-8!"<br><br>
                            <strong>Диспетчер:</strong> "Спецназ выезжает! Не рискуйте!"<br><br>
                            ${this.gameState.timeLimit > 90 ? `
                                <span style="color: var(--accent-green);">🚁 ETA: 3 минуты!</span>
                            ` : `
                                <span style="color: var(--accent-red);">⏰ Они могут не успеть...</span>
                            `}
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 90) {
                    this.addChoice('⏳ Ждать спецназ', () => { this.waitForSWAT(); }, 'primary');
                    this.addChoice('🏃‍♂️ Действовать немедленно', () => { this.actDespite(); }, 'danger');
                } else {
                    this.addChoice('😰 Молиться о чуде...', () => { this.prayForMiracle(); }, 'secondary');
                }
            }

            extremeRescueMode() {
                // ФИНАЛЬНОЕ УЛЬТРА-СЛОЖНОЕ ИСПЫТАНИЕ
                this.gameContent.innerHTML = `
                    <div class="story-entry danger" style="animation: shake 1s infinite;">
                        <div class="story-header">
                            <span style="color: #ff0000; font-size: 20px; animation: blink 0.3s infinite;">
                                ⚡ РЕЖИМ ГЕРОЯ ⚡
                            </span>
                            <span>ЭКСТРЕМАЛЬНАЯ СЛОЖНОСТЬ</span>
                        </div>
                        <div class="story-text">
                            <strong>ФИНАЛЬНОЕ ИСПЫТАНИЕ!</strong><br>
                            Ты должен пройти ВСЕ испытания подряд БЕЗ ОШИБОК!<br><br>
                            <span style="color: var(--accent-red);">
                                ⚠️ ЛЮБАЯ ОШИБКА = СМЕРТЬ! ⚠️<br>
                                ⚠️ ЗДОРОВЬЕ НЕ ВОССТАНАВЛИВАЕТСЯ! ⚠️
                            </span>
                        </div>
                    </div>
                `;

                // Запускаем последовательность из 3 экстремальных испытаний
                this.startHeroicChallenge();
            }

            startHeroicChallenge() {
                let challengesPassed = 0;
                const totalChallenges = 3;

                const nextChallenge = () => {
                    challengesPassed++;
                    
                    if (challengesPassed > totalChallenges) {
                        // ВСЕ ИСПЫТАНИЯ ПРОЙДЕНЫ!
                        this.ultimateVictory();
                        return;
                    }

                    switch(challengesPassed) {
                        case 1:
                            this.startMultiTaskChallenge(['hack', 'sequence', 'reaction'], 6000, (success) => {
                                if (success) {
                                    nextChallenge();
                                } else {
                                    this.gameFailed('heroic_failure');
                                }
                            });
                            break;
                        case 2:
                            this.startReactionMaster(5, (success) => {
                                if (success) {
                                    nextChallenge();
                                } else {
                                    this.gameFailed('heroic_failure');
                                }
                            });
                            break;
                        case 3:
                            this.startFinalStrike(7, (success) => {
                                if (success) {
                                    nextChallenge();
                                } else {
                                    this.gameFailed('heroic_failure');
                                }
                            });
                            break;
                    }
                };

                // Начинаем первое испытание
                nextChallenge();
            }

            recoverStrength() {
                // Мини-игра восстановления
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>💊 ВОССТАНОВЛЕНИЕ СИЛ</span>
                            <span>МЕДИТАЦИЯ</span>
                        </div>
                        <div class="story-text">
                            Ты пытаешься восстановить силы и сосредоточиться...<br>
                            Нужно синхронизировать дыхание с пульсом!<br><br>
                            <div id="breathing-indicator" style="
                                width: 100px; 
                                height: 100px; 
                                border-radius: 50%; 
                                background: #00ff00; 
                                margin: 20px auto;
                                animation: breathe 3s infinite;
                            "></div>
                            <div style="text-align: center;">
                                Кликай в ритм с кругом!
                            </div>
                        </div>
                    </div>
                `;

                this.startBreathingGame();
            }

            startBreathingGame() {
                let clicks = 0;
                let correctClicks = 0;
                const requiredClicks = 10;
                let isInBeat = false;

                const indicator = document.getElementById('breathing-indicator');
                
                // Определяем ритм дыхания
                const beatInterval = setInterval(() => {
                    isInBeat = true;
                    setTimeout(() => {
                        isInBeat = false;
                    }, 500); // Полсекунды на правильный клик
                }, 1500); // Каждые 1.5 секунды

                indicator.onclick = () => {
                    clicks++;
                    
                    if (isInBeat) {
                        correctClicks++;
                        this.sounds.typing();
                        this.vibrate([50]);
                        indicator.style.background = '#00ff00';
                    } else {
                        this.sounds.scream();
                        this.vibrate([200]);
                        indicator.style.background = '#ff0000';
                        setTimeout(() => {
                            indicator.style.background = '#00ff00';
                        }, 200);
                    }

                    if (clicks >= requiredClicks) {
                        clearInterval(beatInterval);
                        
                        const accuracy = correctClicks / requiredClicks;
                        
                        if (accuracy >= 0.8) {
                            // Успешное восстановление
                            this.gameState.playerHealth = Math.min(100, this.gameState.playerHealth + 30);
                            this.gameState.stress = Math.max(0, this.gameState.stress - 20);
                            this.gameState.stamina = Math.min(100, this.gameState.stamina + 40);
                            
                            this.gameContent.innerHTML = `
                                <div class="story-entry normal">
                                    <div class="story-header">
                                        <span>✅ ВОССТАНОВЛЕНИЕ УСПЕШНО</span>
                                        <span>ГОТОВ К БОЮ</span>
                                    </div>
                                    <div class="story-text">
                                        Ты восстановил силы!<br>
                                        Здоровье: ${this.gameState.playerHealth}% (+30)<br>
                                        Стресс: ${Math.round(this.gameState.stress)}% (-20)<br>
                                        Выносливость: ${this.gameState.stamina}% (+40)<br><br>
                                        Теперь ты готов к финальной схватке!
                                    </div>
                                </div>
                            `;
                            
                            this.choicesContainer.innerHTML = '';
                            this.addChoice('⚔️ К ФИНАЛЬНОЙ БИТВЕ!', () => { this.finalBattleRound2(); }, 'danger');
                            
                        } else {
                            // Неудачное восстановление
                            this.gameState.stress += 10;
                            this.gameState.timeLimit -= 30;
                            
                            this.gameContent.innerHTML = `
                                <div class="story-entry danger">
                                    <div class="story-header">
                                        <span>❌ НЕУДАЧНОЕ ВОССТАНОВЛЕНИЕ</span>
                                        <span>СОСТОЯНИЕ УХУДШИЛОСЬ</span>
                                    </div>
                                    <div class="story-text">
                                        Медитация не удалась...<br>
                                        Стресс увеличился! Время тратится!<br><br>
                                        Нужно действовать как есть!
                                    </div>
                                </div>
                            `;
                            
                            this.choicesContainer.innerHTML = '';
                            this.addChoice('😤 Бороться раненым!', () => { this.extremeRescueMode(); }, 'danger');
                        }
                    }
                };

                // Добавляем CSS для анимации дыхания
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes breathe {
                        0%, 100% { transform: scale(1); opacity: 0.8; }
                        50% { transform: scale(1.3); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }

            ultimateVictory() {
                this.stopTimer();
                this.gameState.skillLevel = 15; // Максимальный уровень
                
                this.gameContent.innerHTML = `
                    <div class="story-entry normal" style="background: linear-gradient(45deg, gold, #FFD700, gold); color: black;">
                        <div class="story-header">
                            <span style="font-size: 24px;">👑 АБСОЛЮТНЫЙ ГЕРОЙ 👑</span>
                            <span>НЕВОЗМОЖНОЕ ДОСТИЖЕНИЕ</span>
                        </div>
                        <div class="story-text">
                            <strong style="font-size: 28px;">🏆 ЛЕГЕНДАРНОЕ ДОСТИЖЕНИЕ! 🏆</strong><br><br>
                            
                            ✅ Прошёл все экстремальные испытания раненым<br>
                            ✅ Спас Айко в критическом состоянии<br>
                            ✅ Побил Сираиси несмотря на травмы<br>
                            ✅ Достиг максимального уровня мастерства (15)<br>
                            ✅ Комбо-стрик: x${this.gameState.comboStreak}<br><br>
                            
                            <strong style="font-size: 20px; color: #8B0000;">
                                ТЫ НЕ ПРОСТО ГЕРОЙ - ТЫ ЖИВАЯ ЛЕГЕНДА! 👑<br>
                                ТАКОЕ МАСТЕРСТВО ДОСТУПНО ЛИШЬ ЕДИНИЦАМ!
                            </strong><br><br>
                            
                            История запомнит твоё имя навеки! 🌟
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('👑 Войти в зал славы', () => { this.restart(); }, 'primary');
                this.addChoice('📜 Записать в летописи', () => { this.investigateKiller(); }, 'secondary');
            }

            finalBattleRound2() {
                // Повторная схватка с восстановленными силами
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>⚔️ ФИНАЛЬНАЯ СХВАТКА</span>
                            <span>РАУНД 2</span>
                        </div>
                        <div class="story-text">
                            Восстановив силы, ты снова сталкиваешься с Сираиси!<br>
                            На этот раз ты готов к бою!<br><br>
                            <span style="color: var(--accent-green);">
                                Здоровье: ${this.gameState.playerHealth}%<br>
                                Готовность: МАКСИМАЛЬНАЯ!
                            </span>
                        </div>
                    </div>
                `;

                // Запускаем облегчённую версию боевой системы
                this.startExtremeComBat();
            }

            startCriticalTimer() {
                this.createComplexityUI();
                this.startStressSystem();
                
                this.gameTimer = setInterval(() => {
                    // Ускоренное время в зависимости от стресса
                    this.gameState.timeLimit -= this.gameState.timePreasure;
                    this.updateStressLevel();
                    const timeLeftSpan = document.getElementById('time-left');
                    if (timeLeftSpan) {
                        const minutes = Math.floor(this.gameState.timeLimit / 60);
                        const seconds = this.gameState.timeLimit % 60;
                        timeLeftSpan.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                        
                        // Меняем цвет по мере приближения к концу
                        if (this.gameState.timeLimit <= 60) {
                            timeLeftSpan.style.color = '#ff0000';
                            timeLeftSpan.style.animation = 'blink 0.5s infinite';
                        } else if (this.gameState.timeLimit <= 120) {
                            timeLeftSpan.style.color = '#ff8800';
                        }
                    }
                    
                    if (this.gameState.timeLimit <= 0) {
                        this.gameFailed('time_up');
                    }
                }, 1000);
            }

            stopTimer() {
                if (this.gameTimer) {
                    clearInterval(this.gameTimer);
                }
            }

            showIntro() {
                this.startCriticalTimer(); // НЕМЕДЛЕННО запускаем смертельный таймер!
                
                // ЗАПУСК ЭКСТРЕННОГО РЕЖИМА
                this.sounds.alarm();
                this.flashScreen('red', 2000);
                this.vibrate([200, 100, 200]);
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div class="japanese-text" style="font-size: 16px; color: var(--accent-pink); margin-bottom: 8px;">
                                <span class="japanese-symbol">白</span>УБИЙЦА ИЗ TWITTER
                            </div>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                Дзама, Канагава • Октябрь 2017
                            </div>
                            <div style="font-size: 11px; color: var(--accent-red); margin-top: 4px; animation: blink 1s infinite;">
                                ⚠️ АЙКО УЖЕ В ПУТИ К УБИЙЦЕ! ⚠️
                            </div>
                            <div id="death-countdown" style="
                                color: #ff4444; 
                                font-size: 18px; 
                                margin: 10px 0; 
                                text-align: center;
                                border: 2px solid #ff4444;
                                padding: 8px;
                                background: rgba(255,68,68,0.1);
                            ">
                                ⏱️ ДО УБИЙСТВА: <span id="time-left">5:00</span>
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>📱 Персональные данные</span>
                                <span>СЕКРЕТНО</span>
                            </div>
                            <div class="story-text">
                                <strong>Игрок:</strong> ${this.story.playerName}, брат жертвы<br>
                                <strong>Жертва:</strong> Тамура Айко (田村愛子), 23 года<br>
                                <strong>Семья:</strong> Родители в разводе, бросила школу<br>
                                <strong>Диагноз:</strong> Шизофрения (2014), стеснительная, замкнутая<br>
                                <strong>Twitter посты:</strong> "Ищу того, кто поможет мне покончить с собой"<br>
                                "Хочу умереть, но одной страшно, если кто-то хочет вместе - напишите"<br><br>
                                <strong>Контекст:</strong> Мать умерла в июне 2017, винит себя, 
                                жила в психиатрическом общежитии в Хатиодзи.
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>⚠️ РЕАЛЬНАЯ УГРОЗА</span>
                                <span>ОКТЯБРЬ 2017</span>
                            </div>
                            <div class="story-text">
                                <strong>ВАЖНО:</strong> 27 июня 2025 года Сираиси был казнён - первая казнь в Японии с 2022 года.
                                <br><br>
                                Но в октябре 2017 он активно охотится на жертв через Twitter,
                                используя хэштег "#вербовка_самоубийц".
                                <br><br>
                                <span style="color: var(--accent-pink);">
                                Каждое твоё решение может спасти жизнь или привести к трагедии.
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚨 НЕМЕДЛЕННО К КВАРТИРЕ УБИЙЦЫ!', () => {
                    this.emergencyRush();
                }, 'danger');
                this.addChoice('📞 ЭКСТРЕННЫЙ ВЫЗОВ ПОЛИЦИИ', () => {
                    this.callPoliceEmergency();
                }, 'warning');
                this.addChoice('📱 ПРЕДУПРЕДИТЬ АЙКО В TWITTER', () => {
                    this.warnVictimTwitter();
                }, 'primary');
                this.addChoice('🔍 Быстро найти адрес убийцы', () => {
                    this.fastInvestigation();
                }, 'secondary');
            }

            // КРИТИЧЕСКИЕ ДЕЙСТВИЯ С РЕАЛЬНЫМИ ПОСЛЕДСТВИЯМИ

            emergencyRush() {
                if (this.gameState.timeLimit > 240) {
                    this.gameContent.innerHTML = `
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🚨 СТРЕМИТЕЛЬНЫЙ РЫВОК</span>
                                <span>ЭКСТРЕННАЯ СИТУАЦИЯ</span>
                            </div>
                            <div class="story-text">
                                Ты бросаешь всё и мчишься к Дзама на поезде!<br>
                                Сердце бешено колотится... Успеешь ли?<br><br>
                                <strong>⚡ Но где именно квартира убийцы?!</strong><br>
                                У тебя нет точного адреса... только район Дзама!
                            </div>
                        </div>
                    `;
                    this.choicesContainer.innerHTML = '';
                    this.addChoice('🏃‍♂️ Бежать по району и искать!', () => { this.searchBlindly(); }, 'danger');
                    this.addChoice('📞 Звонить в полицию по дороге', () => { this.callWhileRunning(); }, 'warning');
                    this.addChoice('📱 Искать его Twitter-аккаунт', () => { this.hackTwitter(); }, 'primary');
                } else {
                    this.gameFailed('too_late');
                }
            }

            callPoliceEmergency() {
                if (this.gameState.timeLimit > 180) {
                    this.gameContent.innerHTML = `
                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📞 ЭКСТРЕННЫЙ ВЫЗОВ</span>
                                <span>110 - ПОЛИЦИЯ ЯПОНИИ</span>
                            </div>
                            <div class="story-text">
                                "Алло! Полиция? Серийный убийца собирается убить мою сестру!"<br><br>
                                <strong>Оператор:</strong> "Где именно происходит преступление?"<br>
                                <strong>Ты:</strong> "В Дзама... но я не знаю точный адрес..."<br><br>
                                <span style="color: var(--accent-red);">
                                ⚠️ Без точного адреса полиция не может действовать быстро!
                                </span>
                            </div>
                        </div>
                    `;
                    this.choicesContainer.innerHTML = '';
                    this.addChoice('🔍 Быстро найти адрес через Twitter', () => { this.hackTwitterAdvanced(); }, 'primary');
                    this.addChoice('📋 Дать полиции все известные данные', () => { this.givePoliceInfo(); }, 'warning');
                    this.addChoice('🚗 Встретиться с полицией в Дзама', () => { this.meetPolice(); }, 'secondary');
                } else {
                    this.gameFailed('police_too_slow');
                }
            }

            warnVictimTwitter() {
                this.gameContent.innerHTML = `
                    <div class="story-entry twitter">
                        <div class="story-header">
                            <span>📱 ОТЧАЯННАЯ ПОПЫТКА</span>
                            <span>TWITTER DM</span>
                        </div>
                        <div class="story-text">
                            Ты лихорадочно пишешь Айко в личные сообщения:<br><br>
                            <div style="background: rgba(29,161,242,0.1); padding: 10px; margin: 10px 0; border-left: 3px solid #1da1f2;">
                                "АЙКО! НЕ ИДИ К ЭТОМУ ЧЕЛОВЕКУ! ОН УБИЙЦА!"<br>
                                "СИРАИСИ ТАКАХИРО = СЕРИЙНЫЙ УБИЙЦА!"<br>
                                "ВЫЗЫВАЮ ПОЛИЦИЮ! НЕ ДОВЕРЯЙ ЕМУ!"
                            </div>
                            <strong>Статус:</strong> <span style="color: #666;">Прочитано ✓✓</span><br><br>
                            ${this.gameState.timeLimit > 200 ? 
                                '<span style="color: var(--accent-green);">📱 Она ОНЛАЙН! Есть шанс!</span>' : 
                                '<span style="color: var(--accent-red);">📵 Она уже оффлайн... поздно?</span>'
                            }
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 200) {
                    this.addChoice('📞 Звонить ей прямо сейчас!', () => { this.callVictimDirect(); }, 'danger');
                    this.addChoice('📍 Отправить геолокацию полицейского участка', () => { this.sendSafeLocation(); }, 'primary');
                    this.addChoice('💣 Рассказать всё о методах убийцы', () => { this.explainKillerMethods(); }, 'warning');
                } else {
                    this.addChoice('😰 Молиться, что она поверила...', () => { this.prayForSuccess(); }, 'secondary');
                }
            }

            fastInvestigation() {
                this.gameContent.innerHTML = `
                    <div class="story-entry hacker">
                        <div class="story-header">
                            <span>💻 ЭКСТРЕМАЛЬНЫЙ ХАКИНГ</span>
                            <span>МНОГОЗАДАЧНЫЙ ВЗЛОМ</span>
                        </div>
                        <div class="story-text">
                            Ты должен взломать ВСЕ системы одновременно:<br>
                            • Twitter API + геолокация<br>
                            • Камеры безопасности<br>
                            • Базы данных недвижимости<br>
                            • Архивы полиции<br><br>
                            <div style="color: var(--accent-red); animation: blink 0.5s infinite;">
                                ⚡ ЭКСТРЕМАЛЬНАЯ СЛОЖНОСТЬ АКТИВИРОВАНА!
                            </div>
                        </div>
                    </div>
                `;
                
                // ЗАПУСК ЭКСТРЕМАЛЬНОЙ МНОГОЗАДАЧНОСТИ
                this.startMultiTaskChallenge(['hack', 'sequence', 'reaction'], 8000, (success) => {
                    if (success) {
                        this.gameState.comboStreak++;
                        this.foundAddress();
                    } else {
                        this.gameState.playerHealth -= 30;
                        this.gameState.stress += 30;
                        if (this.gameState.playerHealth <= 0) {
                            this.gameFailed('stress_overload');
                        } else {
                            this.partialHackSuccess();
                        }
                    }
                });
            }

            partialHackSuccess() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>⚠️ ЧАСТИЧНЫЙ УСПЕХ</span>
                            <span>ОСЛОЖНЕНИЯ</span>
                        </div>
                        <div class="story-text">
                            Ты взломал не все системы...<br>
                            Есть только приблизительный район!<br><br>
                            <span style="color: var(--accent-red);">
                                Стресс возрос! Здоровье упало!<br>
                                Времени остается меньше!
                            </span>
                        </div>
                    </div>
                `;
                
                this.gameState.timeLimit -= 60; // Штраф времени
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🏃‍♂️ Бежать в район вслепую!', () => { this.searchBlindly(); }, 'danger');
                this.addChoice('📞 Просить помощи у полиции', () => { this.requestPoliceHelp(); }, 'warning');
            }

            // ФУНКЦИИ ПРОВАЛА ИГРЫ
            gameFailed(reason) {
                this.stopTimer();
                
                // УЖАСАЮЩИЕ ЭФФЕКТЫ ПРОВАЛА
                this.sounds.scream();
                this.activateHorrorMode();
                this.shakeScreen(5000);
                this.flashScreen('darkred', 3000);
                this.vibrate([500, 200, 500, 200, 1000]);
                
                let failMessage = '';
                
                switch(reason) {
                    case 'time_up':
                        failMessage = `
                            <div class="story-entry death">
                                <div class="story-header">
                                    <span>💀 ВРЕМЯ ИСТЕКЛО</span>
                                    <span>ПРОВАЛ</span>
                                </div>
                                <div class="story-text">
                                    Ты не успел... Айко уже в квартире убийцы.<br>
                                    Через 15 минут её найдут мёртвой в ванной...<br><br>
                                    <strong>🔴 УБИЙЦА ДОБАВИЛ ЕЩЁ ОДНУ ГОЛОВУ В КОЛЛЕКЦИЮ</strong>
                                </div>
                            </div>
                        `;
                        break;
                    case 'too_late':
                        failMessage = `
                            <div class="story-entry death">
                                <div class="story-header">
                                    <span>💀 СЛИШКОМ ПОЗДНО</span>
                                    <span>ПРОВАЛ</span>
                                </div>
                                <div class="story-text">
                                    Ты принял решение слишком поздно!<br>
                                    Пока ты раздумывал, Айко уже погибла...<br><br>
                                    <strong>⚰️ ПРОМЕДЛЕНИЕ СМЕРТИ ПОДОБНО</strong>
                                </div>
                            </div>
                        `;
                        break;
                    default:
                        failMessage = `
                            <div class="story-entry death">
                                <div class="story-header">
                                    <span>💀 ИГРА ОКОНЧЕНА</span>
                                    <span>ПРОВАЛ</span>
                                </div>
                                <div class="story-text">
                                    Твоё решение привело к трагедии...<br>
                                    Айко мертва. Убийца продолжает охотиться.<br><br>
                                    <strong>🔴 ТЫ МОГ БЫ СПАСТИ ЕЁ</strong>
                                </div>
                            </div>
                        `;
                }
                
                this.gameContent.innerHTML = failMessage;
                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Попробовать ещё раз', () => { this.restart(); }, 'danger');
                this.addChoice('📖 Изучить настоящую историю', () => { this.showRealStory(); }, 'secondary');
                
                this.gameState.deathCounter++;
            }

            restart() {
                this.gameState.timeLimit = 300;
                this.gameState.deathCounter++;
                this.gameState.killerAlerted = false;
                this.gameState.playerLocation = 'home';
                this.init();
            }

            // НОВЫЕ ФУНКЦИИ ДЛЯ ЭКШН-ГЕЙМПЛЕЯ

            searchBlindly() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>🏃‍♂️ ОТЧАЯННЫЙ ПОИСК</span>
                            <span>ДЗАМА, КАНАГАВА</span>
                        </div>
                        <div class="story-text">
                            Ты бежишь по улицам Дзамы, заглядывая в каждое здание!<br>
                            Двухэтажные дома, квартиры... где же нужная?<br><br>
                            ${this.gameState.timeLimit > 120 ? 
                                '<span style="color: var(--accent-green);">🏠 Нашёл подозрительное здание с запахом!</span>' : 
                                '<span style="color: var(--accent-red);">⏰ Времени почти не осталось...</span>'
                            }
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 120) {
                    this.addChoice('🚪 Ворваться в подозрительную квартиру!', () => { this.breakInBlind(); }, 'danger');
                    this.addChoice('👂 Прислушаться у двери', () => { this.listenAtDoor(); }, 'warning');
                } else {
                    this.gameFailed('blind_search_too_slow');
                }
            }

            callWhileRunning() {
                this.gameContent.innerHTML = `
                    <div class="story-entry system">
                        <div class="story-header">
                            <span>📞 ЗВОНОК НА БЕГУ</span>
                            <span>ПОЛИЦИЯ + ПОИСК</span>
                        </div>
                        <div class="story-text">
                            "Алло, полиция? Я в Дзаме, ищу серийного убийцу!"<br>
                            "Район станции Сибуя-дай-маэ, двухэтажные дома..."<br><br>
                            <strong>Оператор:</strong> "Патруль выезжает! Вы видите что-то подозрительное?"<br><br>
                            ${this.gameState.timeLimit > 90 ? 
                                '<span style="color: var(--accent-green);">🚔 Полиция уже близко!</span>' : 
                                '<span style="color: var(--accent-red);">🚨 Нужно действовать самому!</span>'
                            }
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🕵️ Продолжить поиск с полицией', () => { this.policeAssisted(); }, 'primary');
                this.addChoice('⚡ Действовать быстрее полиции', () => { this.actFaster(); }, 'danger');
            }

            hackTwitter() {
                this.gameContent.innerHTML = `
                    <div class="story-entry hacker">
                        <div class="story-header">
                            <span>💻 ВЗЛОМ TWITTER</span>
                            <span>ПОИСК УБИЙЦЫ</span>
                        </div>
                        <div class="story-text">
                            Ты ищешь все аккаунты Сираиси:<br>
                            • @hanging_helper_2017<br>
                            • @suicide_support_tokyo<br>
                            • @death_together_now<br><br>
                            <div style="color: var(--accent-green);">
                                💡 НАЙДЕНО! Геолокация в его последнем посте!<br>
                                📍 "Сибуя-дай-маэ, 2-14-8, кв. 203"
                            </div>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🚨 НЕМЕДЛЕННО К ЭТОМУ АДРЕСУ!', () => { this.rushToFoundAddress(); }, 'danger');
                this.addChoice('📞 Передать адрес полиции', () => { this.giveAddressToPolice(); }, 'primary');
            }

            hackTwitterAdvanced() {
                if (this.gameState.timeLimit > 120) {
                    this.hackTwitter(); // Перенаправляем к успешному взлому
                } else {
                    this.gameFailed('hack_too_slow');
                }
            }

            callVictimDirect() {
                this.gameContent.innerHTML = `
                    <div class="story-entry twitter">
                        <div class="story-header">
                            <span>📞 ЭКСТРЕННЫЙ ЗВОНОК</span>
                            <span>АЙКО ОТВЕЧАЕТ!</span>
                        </div>
                        <div class="story-text">
                            "Алло? Брат?! Я... я сейчас еду к одному человеку..."<br><br>
                            <strong>ТЫ:</strong> "АЙКО! НЕ ИДИ К НЕМУ! ОН УБИЙЦА!"<br>
                            <strong>АЙКО:</strong> "Что?! Ты серьёзно?!"<br>
                            <strong>ТЫ:</strong> "Сираиси Такахиро! Он уже убил 8 человек!"<br><br>
                            <span style="color: var(--accent-green);">
                                📱 Она остановилась! Ты её убедил!
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎉 Айко спасена! Вызвать полицию', () => { this.victimSaved(); }, 'primary');
                this.addChoice('⚖️ Помочь поймать убийцу', () => { this.helpCatchKiller(); }, 'secondary');
            }

            sendSafeLocation() {
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>📍 БЕЗОПАСНОЕ МЕСТО</span>
                            <span>ПОЛИЦЕЙСКИЙ УЧАСТОК</span>
                        </div>
                        <div class="story-text">
                            Ты отправляешь Айко точную геолокацию ближайшего участка:<br>
                            📍 Полицейский участок Дзама<br>
                            "Айко, НЕМЕДЛЕННО иди сюда! Полиция защитит тебя!"<br><br>
                            ${this.gameState.timeLimit > 150 ? 
                                '<span style="color: var(--accent-green);">✅ "Понятно! Еду к полиции!"</span>' : 
                                '<span style="color: var(--accent-red);">❌ "Слишком поздно, я уже почти пришла..."</span>'
                            }
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 150) {
                    this.addChoice('🎉 Айко в безопасности!', () => { this.victimSaved(); }, 'primary');
                } else {
                    this.addChoice('😰 Попытаться её перехватить', () => { this.interceptVictim(); }, 'danger');
                }
            }

            explainKillerMethods() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>💣 ШОКИРУЮЩАЯ ПРАВДА</span>
                            <span>МЕТОДЫ УБИЙЦЫ</span>
                        </div>
                        <div class="story-text">
                            Ты отправляешь Айко детали:<br><br>
                            "Он даёт снотворное в напитке, потом душит верёвкой!<br>
                            Расчленяет в ванной! Уже 9 голов в морозильниках!<br>
                            НЕ ПЕЙ НИЧЕГО У НЕГО! НЕ ЗАХОДИ В КВАРТИРУ!"<br><br>
                            <span style="color: var(--accent-red);">
                                😱 "БОЖЕ МОЙ! Я не пойду к нему!"
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 Теперь поймать убийцу!', () => { this.huntKiller(); }, 'danger');
                this.addChoice('🛡️ Сосредоточиться на защите Айко', () => { this.protectVictim(); }, 'primary');
            }

            prayForSuccess() {
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>🙏 НАДЕЖДА</span>
                            <span>ПОСЛЕДНИЙ ШАНС</span>
                        </div>
                        <div class="story-text">
                            Ты можешь только надеяться, что твоё сообщение её спасёт...<br>
                            Часы тикают... телефон молчит...<br><br>
                            ${Math.random() > 0.5 ? 
                                '<span style="color: var(--accent-green);">📱 Новое сообщение: "Спасибо! Я не пошла к нему!"</span>' : 
                                '<span style="color: var(--accent-red);">📵 Тишина... что-то не так...</span>'
                            }
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    if (Math.random() > 0.3) {
                        this.victimSaved();
                    } else {
                        this.gameFailed('prayer_failed');
                    }
                }, 2000);
            }

            foundAddress() {
                this.gameContent.innerHTML = `
                    <div class="story-entry hacker">
                        <div class="story-header">
                            <span>🎯 АДРЕС НАЙДЕН!</span>
                            <span>УСПЕХ РАССЛЕДОВАНИЯ</span>
                        </div>
                        <div class="story-text">
                            <div style="color: var(--accent-green); font-size: 18px;">
                                📍 НАЙДЕНО!<br>
                                Сираиси Такахиро<br>
                                Дзама, Сибуя-дай-маэ, 2-14-8, кв. 203<br>
                                2-этажный дом, арендная плата 22,000¥
                            </div><br>
                            Теперь у тебя есть точный адрес! Что делать?
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🚨 НЕМЕДЛЕННО ТУДА!', () => { this.rushToFoundAddress(); }, 'danger');
                this.addChoice('📞 Вызвать SWAT по адресу', () => { this.callSWATToAddress(); }, 'primary');
                this.addChoice('📱 Предупредить Айко об адресе', () => { this.warnAboutAddress(); }, 'warning');
            }

            victimSaved() {
                this.stopTimer();
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>🎉 АЙКО СПАСЕНА!</span>
                            <span>МИССИЯ ВЫПОЛНЕНА</span>
                        </div>
                        <div class="story-text">
                            Айко в безопасности! Ты предотвратил убийство!<br>
                            Полиция арестует Сираиси в течение 3 дней...<br><br>
                            <strong>🏆 ГЕРОИЧЕСКИЙ ИСХОД!</strong><br>
                            Ты спас жизнь и остановил серийного убийцу!
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Играть снова', () => { this.restart(); }, 'primary');
                this.addChoice('📖 Узнать реальную историю', () => { this.showRealStory(); }, 'secondary');
            }

            showRealStory() {
                this.stopTimer();
                window.location.href = '#real-story'; // Переход к реальной истории
                this.investigateKiller(); // Показываем полную историю
            }

            // ===== ЭКШН-ФУНКЦИИ 3 ЭТАПА =====

            breakInBlind() {
                // ЗВУКОВЫЕ И ВИЗУАЛЬНЫЕ ЭФФЕКТЫ
                this.sounds.alarm();
                this.shakeScreen(2000);
                this.flashScreen('red', 1000);
                this.vibrate([200, 100, 200, 100, 200]);
                this.activateHorrorMode();
                
                const content = document.createElement('div');
                content.innerHTML = `
                    <div class="story-entry danger heartbeat">
                        <div class="story-header">
                            <span class="panic-text">💥 СЛЕПОЕ ВТОРЖЕНИЕ</span>
                            <span>КВАРТИРА УБИЙЦЫ</span>
                        </div>
                        <div class="story-text">
                            <div class="typing-effect">КРАХ! Ты выбиваешь дверь и врываешься внутрь!</div><br><br>
                            ${this.gameState.timeLimit > 60 ? `
                                <span style="color: var(--accent-green);">🎯 ПОПАЛ! Это действительно логово Сираиси!</span><br>
                                <span class="panic-text">Вонь трупов, коробки в углу... и АЙКО ЖИВА!</span><br>
                                Убийца в шоке от внезапного вторжения!
                            ` : `
                                <span style="color: var(--accent-red); animation: shake 1s infinite;">💀 ОПОЗДАЛ! Айко уже мертва на полу...</span><br>
                                <span class="panic-text">Сираиси стоит над телом с окровавленной верёвкой...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.gameContent.innerHTML = '';
                this.gameContent.appendChild(content);
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 60) {
                    this.addChoice('👊 АТАКОВАТЬ УБИЙЦУ!', () => { this.fightKiller(); }, 'danger');
                    this.addChoice('📞 Кричать в телефон полиции!', () => { this.callForBackup(); }, 'warning');
                    this.addChoice('🛡️ Защищать Айко!', () => { this.shieldVictim(); }, 'primary');
                } else {
                    this.addChoice('😢 Слишком поздно...', () => { this.gameFailed('too_late_rescue'); }, 'secondary');
                }
            }

            listenAtDoor() {
                this.gameContent.innerHTML = `
                    <div class="story-entry hacker">
                        <div class="story-header">
                            <span>👂 ПОДСЛУШИВАНИЕ</span>
                            <span>ЗА ДВЕРЬЮ</span>
                        </div>
                        <div class="story-text">
                            Ты прижимаешься ухом к двери...<br><br>
                            ${this.gameState.timeLimit > 90 ? `
                                <span style="color: var(--accent-blue);">🔊 Слышишь голоса:</span><br>
                                "Не бойся, это не больно..." - мужской голос<br>
                                "Нет, пожалуйста..." - женский голос!<br><br>
                                <span style="color: var(--accent-red);">ЭТО АЙКО! ОНА ЕЩЁ ЖИВА!</span>
                            ` : `
                                <span style="color: var(--accent-red);">🔇 Подозрительная тишина...</span><br>
                                Только звук пилы из ванной комнаты...<br>
                                Боишься, что уже поздно...
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 90) {
                    this.addChoice('💥 ВРЫВАТЬСЯ НЕМЕДЛЕННО!', () => { this.burstIn(); }, 'danger');
                    this.addChoice('📞 Тихо вызвать полицию', () => { this.silentPoliceCall(); }, 'primary');
                    this.addChoice('📱 Отвлечь убийцу звонком', () => { this.distractWithCall(); }, 'warning');
                } else {
                    this.addChoice('💔 Входить и видеть ужас...', () => { this.witnessHorror(); }, 'danger');
                }
            }

            policeAssisted() {
                this.gameContent.innerHTML = `
                    <div class="story-entry system">
                        <div class="story-header">
                            <span>🚔 ПОЛИЦЕЙСКАЯ ОПЕРАЦИЯ</span>
                            <span>КООРДИНИРОВАННЫЙ ШТУРМ</span>
                        </div>
                        <div class="story-text">
                            Полицейские машины окружают здание!<br>
                            Спецназ готовится к штурму!<br><br>
                            <strong>Командир:</strong> "У нас есть снайпер на позиции!"<br>
                            <strong>Ты:</strong> "Жертва может быть ещё жива!"<br><br>
                            ${this.gameState.timeLimit > 60 ? `
                                <span style="color: var(--accent-green);">📡 Тепловизор показывает 2 фигуры!</span>
                            ` : `
                                <span style="color: var(--accent-red);">📡 Тепловизор показывает только 1 фигуру...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('💥 "ШТУРМ НЕМЕДЛЕННО!"', () => { this.swatRaid(); }, 'danger');
                this.addChoice('📢 "Попробовать переговоры"', () => { this.negotiate(); }, 'warning');
                this.addChoice('🎯 "Снайперский выстрел"', () => { this.sniperShot(); }, 'primary');
            }

            actFaster() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>⚡ ОПЕРЕЖАЕМ ПОЛИЦИЮ</span>
                            <span>СОЛО-МИССИЯ</span>
                        </div>
                        <div class="story-text">
                            Ты бежишь быстрее полицейских патрулей!<br>
                            Подбегаешь к зданию первым!<br><br>
                            Видишь открытое окно на 2 этаже...<br>
                            Слышишь крики изнутри!<br><br>
                            ${this.gameState.timeLimit > 45 ? `
                                <span style="color: var(--accent-green);">🔊 "ПОМОГИТЕ!" - голос Айко!</span>
                            ` : `
                                <span style="color: var(--accent-red);">🔇 Крики затихли...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🧗‍♂️ Лезть через окно!', () => { this.climbWindow(); }, 'danger');
                this.addChoice('🚪 Ломать входную дверь!', () => { this.breakMainDoor(); }, 'warning');
                this.addChoice('📞 Кричать через окно!', () => { this.yellThroughWindow(); }, 'primary');
            }

            rushToFoundAddress() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>🏃‍♂️ ГОНКА СО СМЕРТЬЮ</span>
                            <span>СИБУЯ-ДАЙ-МАЭ, 2-14-8</span>
                        </div>
                        <div class="story-text">
                            Ты мчишься к найденному адресу!<br>
                            Сердце колотится... успеешь ли?<br><br>
                            Подбегаешь к дому... 2-этажное здание...<br>
                            Квартира 203... 2 этаж...<br><br>
                            ${this.gameState.timeLimit > 30 ? `
                                <span style="color: var(--accent-green);">💡 Свет в окнах! Кто-то дома!</span>
                            ` : `
                                <span style="color: var(--accent-red);">🔇 Подозрительная тишина...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('💥 ЛОМАТЬ ДВЕРЬ!', () => { this.smashDoor(); }, 'danger');
                this.addChoice('🔑 Попробовать тихо войти', () => { this.sneakIn(); }, 'warning');
                this.addChoice('📞 Вызвать подкрепление', () => { this.callBackup(); }, 'primary');
            }

            giveAddressToPolice() {
                this.gameContent.innerHTML = `
                    <div class="story-entry system">
                        <div class="story-header">
                            <span>📞 ПЕРЕДАЧА ДАННЫХ</span>
                            <span>ПОЛИЦЕЙСКАЯ СЛУЖБА</span>
                        </div>
                        <div class="story-text">
                            "Алло! У меня точный адрес серийного убийцы!"<br>
                            "Сибуя-дай-маэ, 2-14-8, квартира 203!"<br>
                            "Там сейчас происходит убийство!"<br><br>
                            <strong>Диспетчер:</strong> "Спецподразделения выдвигаются!"<br>
                            <strong>ETA:</strong> ${this.gameState.timeLimit > 60 ? '2 минуты' : '5 минут'}<br><br>
                            ${this.gameState.timeLimit > 60 ? `
                                <span style="color: var(--accent-green);">🚁 Вертолёт уже в воздухе!</span>
                            ` : `
                                <span style="color: var(--accent-red);">⏰ Возможно, будет поздно...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🏃‍♂️ Бежать туда самому', () => { this.rushAlone(); }, 'danger');
                this.addChoice('⏳ Ждать полицию', () => { this.waitForSWAT(); }, 'warning');
                this.addChoice('📱 Предупредить Айко об адресе', () => { this.warnVictimAboutAddress(); }, 'primary');
            }

            fightKiller() {
                // ИНТЕНСИВНЫЕ БОЕВЫЕ ЭФФЕКТЫ
                this.sounds.scream();
                this.shakeScreen(3000);
                this.flashScreen('darkred', 2000);
                this.vibrate([300, 200, 300, 200, 500]);
                
                // Создаем интерактивную боевую сцену
                this.gameContent.innerHTML = `
                    <div class="story-entry danger heartbeat" style="animation: shake 2s infinite;">
                        <div class="story-header">
                            <span class="panic-text">👊 СХВАТКА С УБИЙЦЕЙ</span>
                            <span style="color: #ff0000; animation: blink 0.5s infinite;">ЖИЗНЬ ИЛИ СМЕРТЬ</span>
                        </div>
                        <div class="story-text">
                            <div id="fight-sequence" style="line-height: 1.8;">
                                <!-- Боевая последовательность будет добавлена динамически -->
                            </div>
                        </div>
                    </div>
                `;
                
                // ЭКСТРЕМАЛЬНАЯ БОЕВАЯ СИСТЕМА
                this.startExtremeComBat();
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 ГЕРОИЧЕСКАЯ ПОБЕДА!', () => { this.heroicVictory(); }, 'primary');
            }

            heroicVictory() {
                this.stopTimer();
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>🏆 ЛЕГЕНДАРНЫЙ ГЕРОЙ</span>
                            <span>ИДЕАЛЬНАЯ КОНЦОВКА</span>
                        </div>
                        <div class="story-text">
                            <strong style="font-size: 20px; color: var(--accent-green);">
                                🎉 НЕВЕРОЯТНАЯ ПОБЕДА! 🎉
                            </strong><br><br>
                            ✅ Айко спасена живой и здоровой<br>
                            ✅ Сираиси схвачен до убийства<br>
                            ✅ 8 других потенциальных жертв предупреждены<br>
                            ✅ Серийный убийца за решёткой<br><br>
                            <strong>Ты изменил историю!</strong><br>
                            В реальности Айко стала 9-й жертвой...<br>
                            Но ТЫ спас её! 🦸‍♂️
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Сыграть другой сценарий', () => { this.restart(); }, 'primary');
                this.addChoice('📖 Изучить реальную историю', () => { this.investigateKiller(); }, 'secondary');
            }

            // ===== ДОПОЛНИТЕЛЬНЫЕ ЭКШН-ФУНКЦИИ =====

            burstIn() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>💥 МГНОВЕННОЕ ВТОРЖЕНИЕ</span>
                            <span>СПАСЕНИЕ ИЛИ СМЕРТЬ</span>
                        </div>
                        <div class="story-text">
                            ТРЕСК! Дверь слетает с петель!<br>
                            Ты врываешься как ураган!<br><br>
                            Сираиси оборачивается в шоке!<br>
                            Айко связана, но жива!<br><br>
                            <span style="color: var(--accent-green);">
                                ⚡ Эффект внезапности на твоей стороне!
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('👊 Атаковать убийцу!', () => { this.fightKiller(); }, 'danger');
                this.addChoice('🏃‍♂️ Хватать Айко и бежать!', () => { this.grabAndRun(); }, 'warning');
                this.addChoice('📞 Кричать в телефон!', () => { this.yellToPhone(); }, 'primary');
            }

            climbWindow() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>🧗‍♂️ ЛАЗАНИЕ ПО СТЕНЕ</span>
                            <span>НИНДЗЯ-ПОДХОД</span>
                        </div>
                        <div class="story-text">
                            Ты карабкаешься по стене к окну 2 этажа!<br>
                            Руки дрожат от адреналина...<br><br>
                            Заглядываешь в окно...<br><br>
                            ${this.gameState.timeLimit > 30 ? `
                                <span style="color: var(--accent-green);">🎯 ВИДИШЬ АЙКО! Она связана, но жива!</span><br>
                                Сираиси стоит спиной к окну с верёвкой...
                            ` : `
                                <span style="color: var(--accent-red);">💀 Ужасное зрелище... слишком поздно...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 30) {
                    this.addChoice('💥 Разбивать окно и прыгать!', () => { this.smashWindowJump(); }, 'danger');
                    this.addChoice('📱 Кричать Айко из окна!', () => { this.yellFromWindow(); }, 'warning');
                    this.addChoice('📞 Тихо вызвать спецназ', () => { this.silentSWATCall(); }, 'primary');
                } else {
                    this.addChoice('😢 Стать свидетелем ужаса...', () => { this.witnessHorror(); }, 'danger');
                }
            }

            smashDoor() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>💥 РАЗРУШЕНИЕ ДВЕРИ</span>
                            <span>МАКСИМАЛЬНАЯ АГРЕССИЯ</span>
                        </div>
                        <div class="story-text">
                            БАМ! БАМ! БАМ!<br>
                            Ты колотишь в дверь плечом и ногами!<br><br>
                            Дверь начинает трещать...<br>
                            Из квартиры доносятся звуки паники!<br><br>
                            ${this.gameState.timeLimit > 20 ? `
                                <span style="color: var(--accent-green);">ТРЕСК! Дверь поддаётся!</span>
                            ` : `
                                <span style="color: var(--accent-red);">Слишком поздно... тишина внутри...</span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 20) {
                    this.addChoice('🏃‍♂️ Врываться немедленно!', () => { this.burstIn(); }, 'danger');
                } else {
                    this.addChoice('💔 Войти в мёртвую тишину...', () => { this.enterSilence(); }, 'danger');
                }
            }

            swatRaid() {
                this.gameContent.innerHTML = `
                    <div class="story-entry system">
                        <div class="story-header">
                            <span>🚁 СПЕЦНАЗ АТАКУЕТ</span>
                            <span>ПРОФЕССИОНАЛЬНАЯ ОПЕРАЦИЯ</span>
                        </div>
                        <div class="story-text">
                            "АЛЬФА-ГРУППА, ВПЕРЁД!"<br><br>
                            💥 Светошумовые гранаты!<br>
                            🚪 Тараны ломают дверь!<br>
                            🎯 Снайперы на позициях!<br><br>
                            ${this.gameState.timeLimit > 45 ? `
                                <span style="color: var(--accent-green);">
                                ✅ ОПЕРАЦИЯ УСПЕШНА!<br>
                                Сираиси нейтрализован, Айко спасена!
                                </span>
                            ` : `
                                <span style="color: var(--accent-red);">
                                ⚰️ Найдена только одна жертва...
                                </span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (this.gameState.timeLimit > 45) {
                    this.addChoice('🎉 МИССИЯ ВЫПОЛНЕНА!', () => { this.victimSaved(); }, 'primary');
                } else {
                    this.addChoice('💔 Скорбеть о потере...', () => { this.gameFailed('swat_too_late'); }, 'secondary');
                }
            }

            sniperShot() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>🎯 СНАЙПЕРСКИЙ ВЫСТРЕЛ</span>
                            <span>ТОЧНОСТЬ ИЛИ СМЕРТЬ</span>
                        </div>
                        <div class="story-text">
                            Снайпер на позиции... цель в прицеле...<br>
                            "Есть чистый выстрел по цели!"<br><br>
                            ${Math.random() > 0.3 ? `
                                <span style="color: var(--accent-green);">
                                🎯 ВЫСТРЕЛ! Попадание в голову!<br>
                                Сираиси мгновенно убит!<br>
                                Айко в безопасности!
                                </span>
                            ` : `
                                <span style="color: var(--accent-red);">
                                ❌ ПРОМАХ! Пуля задела Айко!<br>
                                Трагический исход операции...
                                </span>
                            `}
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                if (Math.random() > 0.3) {
                    this.addChoice('🎯 Снайпер-герой!', () => { this.victimSaved(); }, 'primary');
                } else {
                    this.addChoice('💔 Операция провалена...', () => { this.gameFailed('sniper_miss'); }, 'danger');
                }
            }

            grabAndRun() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>🏃‍♂️ ПОБЕГ С ЗАЛОЖНИЦЕЙ</span>
                            <span>СПАСЕНИЕ НА ХОДУ</span>
                        </div>
                        <div class="story-text">
                            Ты хватаешь связанную Айко на руки!<br>
                            "ДЕРЖИСЬ!" - кричишь ты!<br><br>
                            Сираиси бросается за вами с ножом!<br>
                            Бежишь к выходу с Айко на руках!<br><br>
                            <span style="color: var(--accent-green);">
                                💨 Успеваешь выскочить на улицу!<br>
                                🚔 Полиция уже там!
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎉 Айко спасена!', () => { this.victimSaved(); }, 'primary');
            }

            smashWindowJump() {
                this.gameContent.innerHTML = `
                    <div class="story-entry danger">
                        <div class="story-header">
                            <span>💥 ПРЫЖОК ЧЕРЕЗ ОКНО</span>
                            <span>ГОЛЛИВУДСКИЙ СТИЛЬ</span>
                        </div>
                        <div class="story-text">
                            ТРЕСК! Стекло разлетается во все стороны!<br>
                            Ты врываешься в комнату как супергерой!<br><br>
                            Сираиси в полном шоке от твоего появления!<br>
                            Айко кричит от неожиданности!<br><br>
                            <span style="color: var(--accent-green);">
                                ⚡ Эффект полной внезапности!<br>
                                У тебя несколько секунд преимущества!
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('👊 Немедленная атака!', () => { this.fightKiller(); }, 'danger');
                this.addChoice('🛡️ Закрывать Айко собой!', () => { this.protectVictimDirect(); }, 'primary');
            }

            witnessHorror() {
                this.gameFailed('witness_horror');
            }

            enterSilence() {
                this.gameFailed('entered_too_late');
            }

            protectVictimDirect() {
                this.gameContent.innerHTML = `
                    <div class="story-entry normal">
                        <div class="story-header">
                            <span>🛡️ ЗАЩИТА ЖЕРТВЫ</span>
                            <span>САМОПОЖЕРТВОВАНИЕ</span>
                        </div>
                        <div class="story-text">
                            Ты встаёшь между Сираиси и Айко!<br>
                            "Если хочешь её - сначала убей меня!"<br><br>
                            Убийца колеблется... он не ожидал такого сопротивления...<br>
                            В этот момент прибывает полиция!<br><br>
                            <span style="color: var(--accent-green);">
                                🚔 СПЕЦНАЗ ВРЫВАЕТСЯ В ЗДАНИЕ!<br>
                                🎉 ВЫ ОБА СПАСЕНЫ!
                            </span>
                        </div>
                    </div>
                `;
                
                this.choicesContainer.innerHTML = '';
                this.addChoice('🏆 Героическое спасение!', () => { this.victimSaved(); }, 'primary');
            }

            startSearch() {
                this.gameState.isSearching = true;
                this.startTimer();
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-blue);">
                                🔍 ПОИСК НАЧАТ
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>📱 Последняя активность Тамура Айко</span>
                                <span>21 октября 2017</span>
                            </div>
                            <div class="story-text">
                                <strong>21 октября:</strong> Друг навестил её в общежитии<br>
                                <strong>Камеры JR Хатиодзи:</strong> Айко с неизвестным мужчиной садятся на поезд<br>
                                <strong>Поезд направление:</strong> Одакю-линия → Дзама, Канагава<br><br>
                                <span style="color: var(--accent-blue);">
                                Мужчина соответствует описанию пользователя Twitter "首吊り士" (Повешенный самурай)
                                </span>
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-text">
                                Ты видишь камеры наблюдения на станции. Можешь попросить охрану показать записи, 
                                но это займёт время. Или можешь сразу идти по следу.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📹 Запросить записи с камер', () => {
                    this.requestCCTV();
                }, false, 'Надёжно, но медленно');
                this.addChoice('🏃‍♂️ Идти по следу немедленно', () => {
                    this.followTrail();
                }, true, 'Быстро, но рискованно');
                this.addChoice('🚔 Обратиться в полицию', () => {
                    this.contactPolice();
                }, false, 'Официально, но долго');
                this.addChoice('📊 Изучить схему "вербовки самоубийц"', () => {
                    this.analyzeSuicideRecruitment();
                }, false, 'Понять методы убийцы');
            }

            requestCCTV() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-text">⏳ Запрос записей с камер... Ожидание 30 минут...</div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>📹 Записи получены</span>
                                <span>15:30</span>
                            </div>
                            <div class="story-text">
                                На записи видно: Айко выходит из поезда в 14:20. 
                                К ней подходит мужчина (27-30 лет). Они разговаривают. 
                                Направляются к выходу вместе.
                                <br><br>
                                <strong>КРИТИЧНО:</strong> Мужчина ведёт её к Одакю-линии, направление Дзама!
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-text">
                                Пока ты получал записи, в Twitter появились новые жертвы:<br>
                                @yuki_15: "Встретилась с тем парнем... он такой понимающий"<br>
                                @mika_student: "Еду к нему домой. Наконец-то покой..."<br><br>
                                <span style="color: var(--accent-pink);">
                                ДВЕ ДЕВУШКИ В ОПАСНОСТИ ПРЯМО СЕЙЧАС!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ Предупредить девушек в Twitter', () => {
                    this.warnVictims();
                }, true, 'Можешь спасти их!');
                this.addChoice('🏃‍♂️ Ехать в Дзаму за Аякой', () => {
                    this.goToDzama();
                }, false, 'Сосредоточиться на поиске');
                this.addChoice('📞 Вызвать полицию И предупредить девушек', () => {
                    this.doAll();
                }, false, 'Попытаться всё сразу');
            }

            followTrail() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🏃‍♂️ Быстрое преследование</span>
                                <span>РЕАЛЬНОЕ ВРЕМЯ</span>
                            </div>
                            <div class="story-text">
                                Ты мчишься к последнему местоположению Аяки. Интуиция подсказывает — каждая минута на счёту.
                                <br><br>
                                По пути получаешь сообщение от незнакомого номера:
                                <br><br>
                                <em>"Твоя девушка со мной. Хочешь увидеть её? Приезжай в Дзаму."</em>
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>📱 СРОЧНОЕ УВЕДОМЛЕНИЕ</span>
                                <span>СЕЙЧАС</span>
                            </div>
                            <div class="story-text">
                                Новый пост в Twitter от @helper_shiraishi:<br>
                                "Сегодня помогу двум ангелам. Встречаемся в 18:00 на станции."<br><br>
                                <span style="color: var(--accent-pink);">
                                У ТЕБЯ ЕСТЬ 1 ЧАС ЧТОБЫ ОСТАНОВИТЬ ЕГО!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📞 НЕМЕДЛЕННО ЗВОНИТЬ В ПОЛИЦИЮ', () => {
                    this.emergencyCall();
                }, true, 'Правильный выбор!');
                this.addChoice('💀 Ехать одному в ловушку', () => {
                    this.goAlone();
                }, true, 'ОПАСНО!');
                this.addChoice('📱 Предупредить потенциальных жертв', () => {
                    this.warnTwitterUsers();
                }, false, 'Спасти других');
            }

            contactPolice() {
                this.gameState.contactedPolice = true;
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-header">
                                <span>🚔 Отдел полиции Хатиодзи</span>
                                <span>16:00</span>
                            </div>
                            <div class="story-text">
                                Полицейский: "Понятно. Девушка взрослая, пропала только 3 дня. Официально можем начать поиски только через 7 дней."<br><br>
                                Ты показываешь Twitter переписки.<br><br>
                                "Хм... это серьёзно. Передаю в киберотдел. Они займутся через 2-3 дня."
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-text">
                                <strong>ПОКА ПОЛИЦИЯ ОФОРМЛЯЕТ ДОКУМЕНТЫ:</strong><br><br>
                                В новостях: "Найдено тело 19-летней студентки в Канагаве"<br>
                                Twitter: @yuki_15 не отвечает на сообщения<br><br>
                                <span style="color: var(--accent-pink);">
                                БЮРОКРАТИЯ УБИВАЕТ. ТЫ МОГ БЫ ДЕЙСТВОВАТЬ БЫСТРЕЕ.
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('💔 Понимаешь, что опоздал', () => {
                    this.showBadEnding();
                });
            }

            warnVictims() {
                this.gameState.warnedOthers = true;
                this.gameState.savedLives += 2;
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>📱 Twitter DM • ЭКСТРЕННО</span>
                                <span>СЕЙЧАС</span>
                            </div>
                            <div class="story-text">
                                <strong>Ты → @yuki_15:</strong> "НЕ ВСТРЕЧАЙСЯ С НИМ! Это убийца! Звони в полицию!"<br>
                                <strong>@yuki_15:</strong> "ЧТО?! Я уже еду к нему... Спасибо!!!"<br><br>
                                <strong>Ты → @mika_student:</strong> "ОПАСНОСТЬ! @helper_shiraishi - маньяк!"<br>
                                <strong>@mika_student:</strong> "Боже... я чуть не... СПАСИБО!"<br><br>
                                <span style="color: var(--text-primary);">
                                ✓ СПАСЕНО 2 ЖИЗНИ
                                </span>
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-text">
                                Девушки репостят твои предупреждения. Создаётся цепочка.<br>
                                Хэштег #ShiraishiKiller начинает трендить.<br><br>
                                Но Айко всё ещё в опасности...
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🏃‍♂️ Теперь ехать спасать Аяку', () => {
                    this.rescueGirlfriend();
                });
            }

            emergencyCall() {
                this.gameState.contactedPolice = true;
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📞 Экстренный вызов 110</span>
                                <span>17:15</span>
                            </div>
                            <div class="story-text">
                                <strong>Ты:</strong> "У меня есть адрес серийного убийцы! Дзама, Канагава!"<br>
                                <strong>Оператор:</strong> "Передаю в спецподразделение. Наряд выезжает."<br><br>
                                Ты даёшь все данные: Twitter аккаунт, адрес, описание схемы.
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>🚔 Результат операции</span>
                                <span>18:30</span>
                            </div>
                            <div class="story-text">
                                Полиция врывается в квартиру Сираиси в Дзаме.<br><br>
                                <strong>НАЙДЕНО:</strong><br>
                                • Айко - жива, но в шоке<br>
                                • 240 фрагментов человеческих останков<br>
                                • 8 уже убитых жертв<br>
                                • Сираиси арестован<br><br>
                                <span style="color: var(--text-primary);">
                                ✓ АЯКА СПАСЕНА!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('💚 Увидеть счастливую концовку', () => {
                    this.showGoodEnding();
                });
            }

            goAlone() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>💀 Квартира Сираиси</span>
                                <span>19:00</span>
                            </div>
                            <div class="story-text">
                                Ты приезжаешь один. Дверь открыта - ловушка.<br><br>
                                Сираиси ждёт тебя с верёвкой в руках:<br>
                                "Хочешь увидеть свою девушку? Она в морозилке."<br><br>
                                <span style="color: var(--accent-pink);">
                                Ты стал 10-й жертвой. Никто не знал, куда ты поехал.
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('💔 Понимаешь свою ошибку', () => {
                    this.showBadEnding();
                });
            }

            showGoodEnding() {
                this.stopTimer();
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--text-primary);">
                                ✓ ЛУЧШАЯ КОНЦОВКА
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-text">
                                <strong>РЕЗУЛЬТАТЫ ТВОИХ ДЕЙСТВИЙ:</strong><br><br>
                                ✓ Айко спасена и жива<br>
                                ✓ Сираиши арестован 31 октября 2017<br>
                                ✓ Спасено ${this.gameState.savedLives} дополнительных жизней<br>
                                ✓ Предотвращена серия убийств<br><br>
                                <span style="color: var(--text-primary);">
                                Быстрое мышление и правильные приоритеты спасли множество жизней.
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-text">
                                <strong>ИСТОРИЧЕСКИЙ ФАКТ:</strong><br>
                                В реальности Сираиши убил 9 человек и был казнён 27 июня 2025 года.<br><br>
                                Твои действия изменили историю.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Попробовать другой сценарий', () => {
                    location.reload();
                });
                this.addChoice('📱 Поделиться историей', () => {
                    if (tg) {
                        tg.switchInlineQuery('Спас жизни в истории о Twitter-убийце! 💚');
                    }
                });
            }

            showBadEnding() {
                this.stopTimer();
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--accent-pink);">
                                💔 ТРАГИЧЕСКАЯ КОНЦОВКА
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-text">
                                <strong>ПОСЛЕДСТВИЯ:</strong><br><br>
                                💔 Айко погибла<br>
                                💔 Сираиши убил ещё 8 человек<br>
                                💔 Арест только через месяц<br><br>
                                <span style="color: var(--accent-pink);">
                                Промедление стоило множества жизней.
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-text">
                                <strong>УРОК:</strong><br>
                                В кризисных ситуациях скорость и правильные приоритеты решают всё.<br><br>
                                Попробуй снова и измени историю.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Попробовать снова', () => {
                    location.reload();
                });
            }

            investigateKiller() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-purple);">
                                🔬 ПРОФИЛЬ УБИЙЦЫ
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>👤 Сираиси Такахиро (白石隆浩)</span>
                                <span>27 лет</span>
                            </div>
                            <div class="story-text">
                                <strong>Родился:</strong> 9 октября 1990, Дзама, Канагава<br>
                                <strong>Семья:</strong> Родители живут в 2.5 км от места преступления, есть старшая сестра<br>
                                <strong>Детство:</strong> Средние оценки, средняя внешность, участвовал в клубах<br>
                                <strong>Характер:</strong> Тихий, мягкий, но странный. В школе говорил о попытках суицида<br>
                                <strong>Работа:</strong> Супермаркет в Хатиодзи (зарплата 140,000 иен), игровая зависимость<br>
                                <strong>Разрыв:</strong> Родители развелись, мать с сестрой уехали, почти нет контакта
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🚨 КРИМИНАЛЬНОЕ ПРОШЛОЕ</span>
                                <span>Март 2017</span>
                            </div>
                            <div class="story-text">
                                <strong>Работа:</strong> Кадровое агентство в Синдзюку-Кабукитё<br>
                                <strong>Специализация:</strong> Отправка женщин в "фузоку" (секс-индустрия)<br>
                                <strong>Февраль 2017:</strong> Арестован за нарушение закона о трудоустройстве<br>
                                <strong>Приговор:</strong> 1 год 2 месяца условно, отсрочка на 3 года<br>
                                <strong>Реакция:</strong> "Меня предали!" - озлобленность<br>
                                <strong>Результат:</strong> Начал писать о самоубийствах в Twitter и на "суицидальных сайтах"
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>📱 НАЧАЛО ОХОТЫ</span>
                                <span>Март-Август 2017</span>
                            </div>
                            <div class="story-text">
                                Март: Создаёт Twitter аккаунт @helper_shiraishi<br>
                                Август: Снимает квартиру в Дзаме за 510,000 иен<br>
                                <br>
                                <span style="color: var(--accent-pink);">
                                Схема: Находит суицидальных жертв → предлагает "помощь" → 
                                заманивает домой → насилие → убийство → расчленение
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📊 Изучить хронологию убийств', () => {
                    this.showTimeline();
                });
                this.addChoice('🎯 Понять схему охоты', () => {
                    this.analyzePattern();
                });
                this.addChoice('🔙 Вернуться к поискам Аяки', () => {
                    this.startSearch();
                });
            }

            showTimeline() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-red);">
                                📊 ХРОНОЛОГИЯ УЖАСА
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>💀 22 августа 2017</span>
                                <span>ПЕРВОЕ УБИЙСТВО</span>
                            </div>
                            <div class="story-text">
                                <strong>Жертва 1:</strong> Мизуура Мики (三浦瑞季), 21 год, офисная служащая<br>
                                <strong>История:</strong> Познакомились в Интернете 8 августа, встретились 13 августа<br>
                                <strong>Связь:</strong> Она помогла снять квартиру, дала в долг 360,000 иен<br>
                                <strong>Убийство:</strong> Заманил в квартиру, наркотики + изнасилование + удушение
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>🎯 АВГУСТ 2017</span>
                                <span>УСТРАНЕНИЕ СВИДЕТЕЛЯ</span>
                            </div>
                            <div class="story-text">
                                <strong>Жертва 2:</strong> Ниси-нака Шого (西中匠吾), 20 лет<br>
                                <strong>Связь:</strong> Парень первой жертвы Мики<br>
                                <strong>Причина убийства:</strong> Начал искать пропавшую девушку<br>
                                <strong>Схема:</strong> "Давай встретимся, поговорим о ней" → алкоголь → убийство<br>
                                <strong>Цитата Сираиси:</strong> "Чтобы полиция не заподозрила меня"
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>💀 СЕНТЯБРЬ-ОКТЯБРЬ</span>
                                <span>СЕРИЙНЫЕ УБИЙСТВА</span>
                            </div>
                            <div class="story-text">
                                <strong>Самая молодая:</strong> 15-летняя школьница из Гумма<br>
                                <strong>Самая старая:</strong> 26-летняя женщина<br>
                                <strong>География:</strong> Жертвы из 4 префектур вокруг Токио<br>
                                <strong>Профиль:</strong> Большинство - студенты, 4 из них несовершеннолетние
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-text">
                                <strong>Статистика убийств по словам Сираиси:</strong><br>
                                • <strong>Август:</strong> 2 жертвы (Мизуура Мики + Ниси-нака Шого)<br>
                                • <strong>Сентябрь:</strong> 4 жертвы (включая 15-летнюю из Гумма)<br>
                                • <strong>Октябрь:</strong> 4 жертвы (включая Тамура Айко)<br><br>
                                <strong>Итого:</strong> 9 жертв за 2 месяца и 8 дней<br>
                                <strong>Частота:</strong> В среднем 1 убийство в неделю<br>
                                <strong>Анализ ДНК:</strong> 2 жертвы мертвы 1-2 недели, 7 жертв - 1-2 месяца<br><br>
                                <span style="color: var(--accent-red);">
                                "Кроме первых трёх, порядок убийств уже не помню" - Сираиси
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ ЭКСТРЕННО: Предупредить всех в Twitter', () => {
                    this.massWarning();
                }, true, 'Спасти всех потенциальных жертв!');
                this.addChoice('🕵️ Сфокусироваться на Аяке', () => {
                    this.focusOnGirlfriend();
                });
            }

            analyzePattern() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-blue);">
                                🎯 СХЕМА ОХОТЫ
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>1️⃣ ПОИСК ЖЕРТВ</span>
                                <span>TWITTER</span>
                            </div>
                            <div class="story-text">
                                <strong>Целевая аудитория:</strong> Девушки 15-26 лет с суицидальными мыслями<br>
                                <strong>Подход:</strong> "Я тоже хочу умереть. Давайте вместе"<br>
                                <strong>Профиль:</strong> @helper_shiraishi - "Помощник суицидникам"
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>2️⃣ ЗАМАНИВАНИЕ</span>
                                <span>ПСИХОЛОГИЯ</span>
                            </div>
                            <div class="story-text">
                                <strong>Цитата Сираиси:</strong> <em>"Нервными и обеспокоенными людьми, 
                                которые выражают желание покончить с собой, было легче манипулировать"</em>
                                <br><br>
                                <strong>Признание:</strong> "Хотя я писал о желании умереть, 
                                на самом деле у меня не было суицидальных мыслей"<br>
                                <strong>О жертвах:</strong> "Ни одна из 9 жертв на самом деле не хотела умирать"<br>
                                <strong>Мотив:</strong> "Ради денег и секса" (от нескольких сотен до десятков тысяч иен)
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>3️⃣ КВАРТИРА СМЕРТИ</span>
                                <span>ДЗАМА</span>
                            </div>
                            <div class="story-text">
                                <strong>Адрес:</strong> Квартира в Дзаме (510,000 иен/месяц)<br>
                                <strong>Метод А:</strong> Немедленное нападение (кабель + верёвка)<br>
                                <strong>Метод Б:</strong> Снотворное в напитке → потеря сознания<br>
                                <strong>Финал:</strong> Изнасилование + убийство + грабёж + расчленение
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📍 Ехать в Дзаму НЕМЕДЛЕННО', () => {
                    this.rushToDzama();
                }, true, 'Прямая атака!');
                this.addChoice('🕳️ Попытаться проникнуть в его сеть', () => {
                    this.infiltrateNetwork();
                }, false, 'Опасная игра');
                this.addChoice('📞 Координировать с полицией', () => {
                    this.coordinatePolice();
                });
            }

            massWarning() {
                this.gameState.savedLives = 15; // Больше спасённых
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>⚡ МАССОВОЕ ПРЕДУПРЕЖДЕНИЕ</span>
                                <span>В РЕАЛЬНОМ ВРЕМЕНИ</span>
                            </div>
                            <div class="story-text">
                                Ты создаёшь вирусный пост с реальными данными Сираиси:<br><br>
                                <strong>"ВНИМАНИЕ! @helper_shiraishi = УБИЙЦА!"</strong><br>
                                📍 Имя: Сираиси Такахиро<br>
                                📍 Возраст: 27 лет<br>
                                📍 Адрес: Дзама, Канагава<br>
                                📍 Схема: Предлагает "совместное самоубийство"<br><br>
                                <span style="color: var(--text-primary);">
                                🔄 РЕТВИТЫ: 50,000+<br>
                                💬 КОММЕНТАРИИ: "ОН ПИСАЛ МНЕ!" "ЧУТЬ НЕ ПОЕХАЛА К НЕМУ!"<br>
                                ✅ СПАСЕНО: 15+ ПОТЕНЦИАЛЬНЫХ ЖЕРТВ
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📺 РЕАКЦИЯ СМИ</span>
                                <span>ЧЕРЕЗ 30 МИНУТ</span>
                            </div>
                            <div class="story-text">
                                Новостные каналы подхватывают историю.<br>
                                Полиция получает сотни звонков.<br>
                                Сираиси понимает, что раскрыт...<br><br>
                                <span style="color: var(--accent-pink);">
                                НО АЯКА ВСЁ ЕЩЁ У НЕГО!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚁 Полиция штурмует квартиру', () => {
                    this.policeRaid();
                }, true, 'Финальная операция');
                this.addChoice('📞 Попытаться связаться с Сираиси', () => {
                    this.contactKiller();
                }, true, 'КРАЙНЕ ОПАСНО');
            }

            policeRaid() {
                this.stopTimer();
                
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 16px; color: var(--text-primary);">
                                🎯 СПЕЦОПЕРАЦИЯ: УСПЕХ
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>🚁 30 октября 2017, 14:00</span>
                                <span>ШТУРМ</span>
                            </div>
                            <div class="story-text">
                                Спецподразделение полиции врывается в квартиру в Дзаме.<br><br>
                                <strong>ОБНАРУЖЕНО:</strong><br>
                                ✅ Тамура Айко - жива, в шоке, но спасена<br>
                                💀 8 больших коробок с останками<br>
                                💀 9 человеческих голов в морозильниках<br>
                                💀 240+ фрагментов тел, расчленённых в ванной<br>
                                🔒 Сираиси арестован без сопротивления<br>
                                📱 Телефон с фотографиями жертв<br>
                                🪓 Пилы, ножи, верёвки с кровью жертв
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>📊 ИТОГИ ТВОИХ ДЕЙСТВИЙ</span>
                                <span>ГЕРОИЧЕСКИЙ РЕЗУЛЬТАТ</span>
                            </div>
                            <div class="story-text">
                                ✅ Тамура Айко (田村愛子) спасена<br>
                                ✅ Сираиси арестован 30 октября (исторически точно)<br>
                                ✅ Предотвращена последняя жертва серии<br>
                                ✅ Спасено ${this.gameState.savedLives} потенциальных жертв<br>
                                ✅ Разоблачён "首吊り士" (Повешенный самурай)<br>
                                ✅ 8 коробок с останками найдены<br><br>
                                <span style="color: var(--text-primary);">
                                Твоя быстрая реакция помогла поймать одного из самых жестоких убийц Японии!
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>⚖️ ИСТОРИЧЕСКИЙ ФИНАЛ</span>
                                <span>2020-2025</span>
                            </div>
                            <div class="story-text">
                                <strong>Суд:</strong> 15 декабря 2020 - смертный приговор<br>
                                <strong>Казнь:</strong> 27 июня 2025 (повешение)<br><br>
                                Благодаря твоим действиям последняя жертва была спасена.
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🔄 Попробовать другой сценарий', () => {
                    location.reload();
                });
                this.addChoice('📱 Поделиться победой', () => {
                    if (tg) {
                        tg.switchInlineQuery('Остановил серийного убийцу и спас жизни! 🦸‍♂️');
                    }
                });
            }

            focusOnGirlfriend() {
                // Перенаправляем к существующему методу
                this.startSearch();
            }

            rushToDzama() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🏃‍♂️ ПОЕЗДКА В ДЗАМУ</span>
                                <span>ПРЯМАЯ АТАКА</span>
                            </div>
                            <div class="story-text">
                                Ты мчишься в Дзаму один, зная адрес квартиры убийцы.
                                <br><br>
                                По дороге звонишь в полицию и сообщаешь о намерении.
                                Они просят подождать, но ты понимаешь - каждая минута на счёту.
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>🚪 У ДВЕРИ УБИЙЦЫ</span>
                                <span>17:30</span>
                            </div>
                            <div class="story-text">
                                Квартира в Дзаме. Ты видишь окна, слышишь звуки внутри.
                                <br><br>
                                Полиция будет через 15 минут. Айко может не дожить...
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚪 Врываться немедленно', () => {
                    this.heroicEntry();
                }, true, 'ОЧЕНЬ ОПАСНО!');
                this.addChoice('📞 Дозвониться и отвлечь Сираиси', () => {
                    this.distractKiller();
                }, false, 'Выиграть время');
                this.addChoice('⏰ Ждать полицию', () => {
                    this.waitForPolice();
                }, false, 'Безопасно, но...');
            }

            infiltrateNetwork() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>🕳️ ПРОНИКНОВЕНИЕ В СЕТЬ</span>
                                <span>ОПАСНАЯ ИГРА</span>
                            </div>
                            <div class="story-text">
                                Ты создаёшь фальшивый профиль депрессивной девушки
                                и пытаешься связаться с @helper_shiraishi.
                                <br><br>
                                <strong>Риск:</strong> Он может заподозрить подвох<br>
                                <strong>Награда:</strong> Узнать точное местоположение жертв
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>📱 КОНТАКТ УСТАНОВЛЕН</span>
                                <span>ЧЕРЕЗ 20 МИНУТ</span>
                            </div>
                            <div class="story-text">
                                Сираиши отвечает: "Привет. Я понимаю твою боль. 
                                Хочешь встретиться и обсудить наш план?"
                                <br><br>
                                <span style="color: var(--accent-pink);">
                                ОН КЛЮНУЛ! Но времени мало...
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📍 Получить адрес и вызвать полицию', () => {
                    this.getTrapAddress();
                }, false, 'Умный ход');
                this.addChoice('🎭 Поехать на встречу как приманка', () => {
                    this.goBait();
                }, true, 'СМЕРТЕЛЬНО ОПАСНО!');
            }

            coordinatePolice() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📞 КООРДИНАЦИЯ С ПОЛИЦИЕЙ</span>
                                <span>ОФИЦИАЛЬНО</span>
                            </div>
                            <div class="story-text">
                                Ты передаёшь полиции всю собранную информацию:
                                <br><br>
                                • Полное имя: Сираиси Такахиро<br>
                                • Адрес: Квартира в Дзаме<br>
                                • Twitter: @helper_shiraishi<br>
                                • Схема охоты через суицидальные посты<br>
                                • Временные рамки активности
                            </div>
                        </div>

                        <div class="story-entry normal">
                            <div class="story-header">
                                <span>🚔 ПОЛИЦЕЙСКАЯ ОПЕРАЦИЯ</span>
                                <span>ЧЕРЕЗ 2 ЧАСА</span>
                            </div>
                            <div class="story-text">
                                Полиция формирует план операции, получает ордера,
                                координирует с киберотделом...
                                <br><br>
                                <span style="color: var(--accent-red);">
                                За это время Сираиши может убить Аяку!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ Убедить их действовать СЕЙЧАС', () => {
                    this.policeRaid();
                }, true, 'Экстренная операция');
                this.addChoice('📱 Самому предупредить в Twitter', () => {
                    this.massWarning();
                }, false, 'Параллельные действия');
            }

            contactKiller() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>📞 ЗВОНОК УБИЙЦЕ</span>
                                <span>КРАЙНЕ ОПАСНО</span>
                            </div>
                            <div class="story-text">
                                Ты звонишь Сираиси с заблокированного номера:
                                <br><br>
                                <strong>Ты:</strong> "Я знаю, кто ты. У тебя Айко."<br>
                                <strong>Сираиси:</strong> "...Кто это? Как ты узнал?"<br>
                                <strong>Ты:</strong> "Весь интернет уже знает. Отпусти её."<br>
                                <strong>Сираиси:</strong> "Слишком поздно. Она уже..."
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>⚡ КРИТИЧЕСКИЙ МОМЕНТ</span>
                                <span>СЕЙЧАС ИЛИ НИКОГДА</span>
                            </div>
                            <div class="story-text">
                                Линия не прерывается. Он ещё говорит.
                                <br><br>
                                <span style="color: var(--accent-pink);">
                                Есть шанс спасти Аяку переговорами!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🗣️ "Я приеду один. Обменяй меня на неё"', () => {
                    this.offerExchange();
                }, true, 'Героический поступок');
                this.addChoice('😨 "Полиция уже едет! Сдавайся!"', () => {
                    this.threatenHim();
                }, true, 'Может разозлить его');
                this.addChoice('💰 "Я заплачу любые деньги"', () => {
                    this.offerMoney();
                }, false, 'Попытка торговаться');
            }

            heroicEntry() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-text">
                                Ты врываешься в квартиру. Сираиси в шоке от неожиданности.
                                <br><br>
                                Айко связана, но жива! Ты успел!
                                <br><br>
                                <span style="color: var(--text-primary);">
                                Твоя решимость спасла ей жизнь!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 Увидеть героическую концовку', () => {
                    this.showGoodEnding();
                });
            }

            offerExchange() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-text">
                                Сираiши соглашается на обмен. Полиция прибывает
                                в момент передачи и арестовывает его.
                                <br><br>
                                <span style="color: var(--text-primary);">
                                Твоя готовность пожертвовать собой спасла Аяку!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 Увидеть концовку героя', () => {
                    this.showGoodEnding();
                });
            }

            // Дополнительные методы для новых веток
            distractKiller() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-text">
                                Ты отвлекаешь Сираиси звонками, выигрывая время
                                для прибытия полиции. Стратегия работает!
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 К спасательной операции', () => {
                    this.policeRaid();
                });
            }

            waitForPolice() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-text">
                                Ты ждёшь полицию. Слышишь крики из квартиры...
                                <br><br>
                                <span style="color: var(--accent-red);">
                                Возможно, было слишком поздно...
                                </span>
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('💔 Увидеть последствия', () => {
                    this.showBadEnding();
                });
            }

            getTrapAddress() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry normal">
                            <div class="story-text">
                                Ты получаешь адрес встречи и немедленно передаёшь
                                его полиции. Операция проходит успешно!
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 К успешной операции', () => {
                    this.policeRaid();
                });
            }

            goBait() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-text">
                                Ты идёшь на встречу как приманка, но Сираиси
                                раскрывает обман. Ситуация становится критической...
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ Экстренные меры', () => {
                    this.emergencyCall();
                });
                this.addChoice('💔 Плохая концовка', () => {
                    this.showBadEnding();
                });
            }

            threatenHim() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-text">
                                Угрозы только разозлили Сираиси. Он ускоряет
                                свои действия...
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('💔 К трагическому финалу', () => {
                    this.showBadEnding();
                });
            }

            offerMoney() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-text">
                                Сираиси не интересуют деньги. Его мотивы
                                гораздо темнее...
                                <br><br>
                                Но разговор выигрывает время для полиции!
                            </div>
                        </div>
                    </div>
                `;
                this.choicesContainer.innerHTML = '';
                this.addChoice('🚁 Прибытие полиции', () => {
                    this.policeRaid();
                });
            }

            // Дополняем существующий метод investigateTwitter для связности
            investigateTwitter() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>📱 АНАЛИЗ TWITTER АЯКИ</span>
                                <span>ПОСЛЕДНИЕ СООБЩЕНИЯ</span>
                            </div>
                            <div class="story-text">
                                Последний твит: "Больше не могу... никто не понимает..."<br>
                                Лайки на посты о суициде в 02:30<br>
                                Странные ответы от @helper_shiraishi: "Помогу тебе"<br><br>
                                <span style="color: var(--accent-blue);">
                                В личных сообщениях: адрес встречи в Дзаме!
                                </span>
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>⚠️ СХЕМА РАСКРЫТА</span>
                                <span>ЭКСТРЕННО</span>
                            </div>
                            <div class="story-text">
                                @helper_shiraishi использует ту же схему с десятками девушек:
                                <br><br>
                                "Я тоже хочу умереть. Давайте встретимся и сделаем это вместе."
                                <br><br>
                                <span style="color: var(--accent-pink);">
                                Ты понял его метод! Можешь предупредить других!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('📍 Ехать по адресу в Дзаму', () => {
                    this.rushToDzama();
                }, true, 'Прямое действие');
                this.addChoice('📢 Предупредить всех в Twitter', () => {
                    this.massWarning();
                }, false, 'Спасти других');
                this.addChoice('📞 Сообщить в полицию', () => {
                    this.coordinatePolice();
                }, false, 'Официальный путь');
            }

            analyzeSuicideRecruitment() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-purple);">
                                📊 СХЕМА "ВЕРБОВКИ САМОУБИЙЦ"
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>🎯 МЕТОД СИРАИСИ</span>
                                <span>ВЕЧЕРНЯЯ МОСКВА</span>
                            </div>
                            <div class="story-text">
                                <strong>Схема работы:</strong><br>
                                1. Мониторит Twitter по хэштегу #вербовка_самоубийц<br>
                                2. Находит уязвимых людей в депрессии<br>
                                3. Предлагает "совместное самоубийство"<br>
                                4. Заманивает к себе в квартиру в Дзаме<br><br>
                                <span style="color: var(--accent-pink);">
                                НА САМОМ ДЕЛЕ: Убивает жертв и расчленяет тела
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>⚖️ ИСТОРИЧЕСКАЯ СПРАВКА</span>
                                <span>2025</span>
                            </div>
                            <div class="story-text">
                                <strong>Важно знать:</strong><br>
                                27 июня 2025 года Сираиси был казнён - 
                                первая казнь в Японии с 2022 года.<br><br>
                                Но в октябре 2017 года он ещё на свободе и активно охотится.
                                <strong>Айко может стать его последней жертвой!</strong>
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🚨 КРИТИЧЕСКАЯ ИНФОРМАЦИЯ</span>
                                <span>СЕЙЧАС</span>
                            </div>
                            <div class="story-text">
                                Если Айко действительно была его последней жертвой,
                                то её исчезновение произошло незадолго до ареста Сираиси.
                                <br><br>
                                <span style="color: var(--accent-red);">
                                У ТЕБЯ ЕСТЬ ПОСЛЕДНИЙ ШАНС ЕЁ СПАСТИ!
                                </span>
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📰 ИСТОЧНИК</span>
                                <span>ВЕЧЕРНЯЯ МОСКВА</span>
                            </div>
                            <div class="story-text">
                                Информация основана на реальных событиях, описанных в статье 
                                "Вечерней Москвы" о казни Такахиро Сираиси 27 июня 2025 года.
                                <br><br>
                                <em>Айко из Токио действительно писала: 
                                "Я ищу человека, готового умереть вместе со мной"</em>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('⚡ ЭКСТРЕННО: Ехать в Дзаму', () => {
                    this.rushToDzama();
                }, true, 'Последний шанс!');
                this.addChoice('📱 Начать массовое предупреждение', () => {
                    this.massWarning();
                }, false, 'Защитить других');
                this.addChoice('📞 Координировать с полицией', () => {
                    this.coordinatePolice();
                }, false, 'Официальный путь');
            }

            analyzeHangingMethod() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 14px; color: var(--accent-purple);">
                                📊 АНАЛИЗ "首吊り士" (ПОВЕШЕННЫЙ САМУРАЙ)
                            </div>
                        </div>

                        <div class="story-entry twitter">
                            <div class="story-header">
                                <span>👤 ПРОФИЛЬ УБИЙЦЫ</span>
                                <span>ЯПОНСКИЕ ИСТОЧНИКИ</span>
                            </div>
                            <div class="story-text">
                                <strong>Ник:</strong> 首吊り士 (Kubishiri-shi) - "Повешенный самурай"<br>
                                <strong>Схема:</strong> Советует методы самоубийства, особенно повешение<br>
                                <strong>Тактика:</strong> "Не связывайтесь с семьёй перед самоубийством"<br>
                                <strong>Ловушка:</strong> "Мы можем умереть вместе"<br><br>
                                <span style="color: var(--accent-pink);">
                                НА САМОМ ДЕЛЕ: Сам никогда не планировал самоубийство
                                </span>
                            </div>
                        </div>

                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🏠 КВАРТИРА СМЕРТИ</span>
                                <span>ДЗАМА, КАНАГАВА</span>
                            </div>
                            <div class="story-text">
                                <strong>Адрес:</strong> 2-этажный дом, 10+ квартир<br>
                                <strong>Аренда:</strong> 22,000 иен/месяц + залог 360,000 иен<br>
                                <strong>Размер:</strong> Всего 10+ кв.м с чердаком<br>
                                <strong>Особенности:</strong> Рядом Одакю-линия (шум поездов маскирует крики)<br><br>
                                <strong>УЖАС:</strong> 8 коробок с останками, 9 голов, 240 частей тел<br>
                                <strong>Невероятно:</strong> Убийца ел, спал и жил с трупами 2+ месяца<br>
                                <strong>Маскировка запаха:</strong> Кошачий наполнитель поверх голов<br>
                                <strong>Соседи:</strong> "С августа ужасный запах как из канализации"<br>
                                <strong>Мусор:</strong> Выносил тяжёлые пакеты по ночам (мясо и органы)
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>⚖️ МЕТОД УБИЙСТВА</span>
                                <span>ПОКАЗАНИЯ</span>
                            </div>
                            <div class="story-text">
                                1. <strong>Заманивание:</strong> Алкоголь + снотворное ИЛИ внезапное удушение<br>
                                2. <strong>Удушение:</strong> Верёвка, привязанная к чердаку<br>
                                3. <strong>Изнасилование:</strong> До и после смерти<br>
                                4. <strong>Расчленение:</strong> В ванной (3 дня на первых, потом в тот же день)<br>
                                5. <strong>Хранение:</strong> Первые 2 жертвы временно в холодильнике<br>
                                6. <strong>Утилизация:</strong> Мясо и органы в мусор, головы в морозильники<br>
                                7. <strong>Причина сохранения голов:</strong> "Боялся, что их узнают"<br><br>
                                <span style="color: var(--accent-red);">
                                Фотографировал трупы, готовил 10-ю коробку для следующей жертвы...
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚨 НЕМЕДЛЕННО К КВАРТИРЕ!', () => {
                    this.rushToApartment();
                }, true, 'Айко может быть ещё жива!');
                this.addChoice('📞 Экстренный вызов спецназа', () => {
                    this.callSwat();
                }, false, 'Координация с полицией');
                this.addChoice('📱 Предупредить всех в соцсетях', () => {
                    this.massWarning();
                }, false, 'Защитить других жертв');
            }

            rushToApartment() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>🏃‍♂️ ЭКСТРЕННАЯ ПОЕЗДКА</span>
                                <span>ДЗАМА</span>
                            </div>
                            <div class="story-text">
                                Ты мчишься на Одакю-линии к станции "Соубудайямэ".
                                <br><br>
                                По пути вызываешь полицию: "У меня точный адрес серийного убийцы!"
                                <br><br>
                                <strong>Адрес:</strong> 2-этажное здание в 800м от станции<br>
                                <strong>Квартира:</strong> 2 этаж, средняя комната с чердаком
                            </div>
                        </div>

                        <div class="story-entry system">
                            <div class="story-header">
                                <span>🚪 У ДВЕРИ УБИЙЦЫ</span>
                                <span>30 октября 2017</span>
                            </div>
                            <div class="story-text">
                                Ты стоишь у входной двери. Сильный запах разложения...
                                <br><br>
                                Полиция будет через 15 минут. 
                                <br><br>
                                <span style="color: var(--accent-red);">
                                ЕСЛИ АЙКО ВСЁ ЕЩЁ ЖИВА - КАЖДАЯ СЕКУНДА РЕШАЕТ ВСЁ!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚪 Ворваться немедленно', () => {
                    this.breakIn();
                }, true, 'КРАЙНЕ ОПАСНО!');
                this.addChoice('📞 Позвонить в дверь и отвлечь убийцу', () => {
                    this.distractKiller();
                }, false, 'Выиграть время');
                this.addChoice('⏰ Дождаться полицию', () => {
                    this.waitForPolice();
                }, false, 'Безопасно, но поздно...');
            }

            callSwat() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry system">
                            <div class="story-header">
                                <span>📞 ВЫЗОВ СПЕЦНАЗА</span>
                                <span>ЭКСТРЕННАЯ ОПЕРАЦИЯ</span>
                            </div>
                            <div class="story-text">
                                Ты даёшь полиции максимально детальную информацию:
                                <br><br>
                                • Точный адрес в Дзаме<br>
                                • Схема квартиры с чердаком<br>
                                • Методы убийцы (верёвка на чердаке)<br>
                                • Вероятность, что жертва ещё жива<br><br>
                                Полиция мобилизует спецназ и едет со всех сторон!
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🚁 К финальной операции', () => {
                    this.policeRaid();
                });
            }

            breakIn() {
                this.gameContent.innerHTML = `
                    <div style="padding: 15px;">
                        <div class="story-entry danger">
                            <div class="story-header">
                                <span>💥 ВТОРЖЕНИЕ</span>
                                <span>ПОСЛЕДНИЙ ШАНС</span>
                            </div>
                            <div class="story-text">
                                Ты врываешься в дверь! Сираиси в шоке от неожиданности.
                                <br><br>
                                В углу комнаты - 8 больших коробок со страшным запахом.
                                На чердаке - верёвка с петлёй.
                                <br><br>
                                <strong>АЙКО СВЯЗАНА, НО ЖИВА!</strong> Ты успел на несколько минут!
                                <br><br>
                                <span style="color: var(--text-primary);">
                                Твоя решимость спасла последнюю жертву Twitter-убийцы!
                                </span>
                            </div>
                        </div>
                    </div>
                `;

                this.choicesContainer.innerHTML = '';
                this.addChoice('🎯 Увидеть героическую концовку', () => {
                    this.showGoodEnding();
                });
            }

            addChoice(text, callback, type = 'normal', description = '') {
                const button = document.createElement('button');
                let buttonClass = 'choice-button';
                
                // Определяем стиль кнопки по типу
                switch(type) {
                    case 'danger':
                        buttonClass += ' dangerous';
                        break;
                    case 'warning':
                        buttonClass += ' warning';
                        break;
                    case 'primary':
                        buttonClass += ' primary';
                        break;
                    case 'secondary':
                        buttonClass += ' secondary';
                        break;
                    case true: // обратная совместимость со старым dangerous параметром
                        buttonClass += ' dangerous';
                        break;
                }
                
                button.className = buttonClass;
                button.innerHTML = `
                    ${text}
                    ${description ? `<div style="font-size: 10px; opacity: 0.7; margin-top: 4px;">${description}</div>` : ''}
                `;
                button.onclick = callback;
                this.choicesContainer.appendChild(button);
            }
        }

        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new ShiraishiGame();
        });

        // Глитч эффекты
        setInterval(() => {
            if (Math.random() < 0.02) {
                document.body.style.filter = `hue-rotate(${Math.random() * 360}deg) saturate(${1 + Math.random()})`;
                setTimeout(() => { document.body.style.filter = 'none'; }, 100);
            }
        }, 3000);
    </script>
</body>
</html>
