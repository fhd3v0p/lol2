<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テケテケ | URBAN LEGENDS</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono:wght@400&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap');
        
        :root {
            --bg-primary: #0d0d14;
            --bg-secondary: #1a1a24;
            --bg-tertiary: #242438;
            --text-primary: #ff4444;
            --text-secondary: #999;
            --accent-blood: #cc0000;
            --accent-pale: #ffeeee;
            --accent-blue: #4488ff;
            --shadow-red: rgba(204, 0, 0, 0.3);
            --glow-red: rgba(255, 68, 68, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
            color: var(--text-primary);
            font-family: 'Share Tech Mono', 'Noto Sans JP', monospace;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Эффект царапания и ползания */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    45deg,
                    transparent,
                    transparent 1px,
                    rgba(204, 0, 0, 0.02) 1px,
                    rgba(204, 0, 0, 0.02) 2px
                );
            animation: scratch 10s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes scratch {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(2px) translateY(-1px); }
            50% { transform: translateX(-1px) translateY(1px); }
            75% { transform: translateX(1px) translateY(-2px); }
            100% { transform: translateX(0) translateY(0); }
        }

        /* Звуковые эффекты "тэкэ-тэкэ" */
        .teke-sound {
            position: fixed;
            bottom: 20px;
            left: 20px;
            font-size: 14px;
            color: var(--accent-blood);
            opacity: 0;
            animation: tekeSound 3s infinite;
            pointer-events: none;
            z-index: 1000;
        }

        @keyframes tekeSound {
            0%, 90% { opacity: 0; }
            5% { opacity: 1; }
            10% { opacity: 0; }
            15% { opacity: 1; }
            20% { opacity: 0; }
        }

        .phone-container {
            width: 390px;
            height: 750px;
            margin: 20px auto;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 3px solid #444;
            border-radius: 25px;
            padding: 15px;
            box-shadow: 
                0 0 40px var(--shadow-red),
                inset 0 0 20px rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 10;
        }

        .screen {
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            border-radius: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .phone-header {
            background: var(--bg-tertiary);
            padding: 12px 16px;
            font-size: 11px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .carrier-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .signal-strength {
            display: flex;
            gap: 2px;
        }

        .signal-bar {
            width: 3px;
            height: 8px;
            background: var(--text-primary);
            opacity: 0.3;
        }

        .signal-bar.active {
            opacity: 1;
            animation: signalFlicker 2s infinite;
        }

        @keyframes signalFlicker {
            0%, 70% { opacity: 1; }
            85%, 100% { opacity: 0.3; }
        }

        .battery-indicator {
            color: var(--accent-blood);
            animation: batteryDrain 4s infinite;
        }

        @keyframes batteryDrain {
            0%, 60% { opacity: 1; }
            80%, 100% { opacity: 0.4; }
        }

        .content-area {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
            position: relative;
        }

        .legend-selector {
            display: grid;
            gap: 15px;
            margin: 20px 0;
        }

        .legend-card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 2px solid #444;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .legend-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-red), transparent);
            transition: left 0.6s;
        }

        .legend-card:hover::before {
            left: 100%;
        }

        .legend-card:hover {
            border-color: var(--text-primary);
            box-shadow: 0 0 25px var(--glow-red);
            transform: translateY(-3px);
        }

        .legend-card.active {
            border-color: var(--accent-blood);
            background: linear-gradient(135deg, rgba(204, 0, 0, 0.1), var(--bg-tertiary));
        }

        .legend-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .legend-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .legend-description {
            font-size: 11px;
            line-height: 1.4;
            color: var(--accent-pale);
        }

        .chapter-container {
            animation: slideIn 0.6s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chapter-title {
            text-align: center;
            margin-bottom: 25px;
        }

        .chapter-title h2 {
            font-size: 18px;
            color: var(--accent-blood);
            margin-bottom: 8px;
        }

        .chapter-title .subtitle {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .story-log {
            background: rgba(255, 68, 68, 0.05);
            border: 1px solid rgba(255, 68, 68, 0.2);
            border-radius: 10px;
            padding: 16px;
            margin: 16px 0;
            position: relative;
        }

        .story-log.corrupted {
            background: rgba(204, 0, 0, 0.1);
            border-color: var(--accent-blood);
            animation: logCorruption 0.5s ease-out;
        }

        @keyframes logCorruption {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-2px); }
            75% { transform: translateX(2px); }
        }

        .story-log.phone-call {
            background: rgba(68, 136, 255, 0.1);
            border-color: var(--accent-blue);
        }

        .story-log.bathroom {
            background: rgba(255, 238, 238, 0.1);
            border-color: var(--accent-pale);
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 10px;
            color: var(--text-secondary);
        }

        .log-content {
            font-size: 13px;
            line-height: 1.5;
            margin-bottom: 8px;
        }

        .log-timestamp {
            font-size: 9px;
            color: var(--text-secondary);
            text-align: right;
            opacity: 0.7;
        }

        .japanese-text {
            font-family: 'Noto Sans JP', sans-serif;
            font-weight: 300;
        }

        .japanese-symbol {
            font-family: 'Noto Sans JP', sans-serif;
            font-size: 22px;
            color: var(--accent-blood);
            display: inline-block;
            margin-right: 8px;
            animation: symbolPulse 4s infinite;
        }

        @keyframes symbolPulse {
            0%, 100% { 
                text-shadow: 0 0 10px var(--accent-blood);
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 20px var(--accent-blood), 0 0 30px var(--accent-blood);
                transform: scale(1.1);
            }
        }

        .interactive-element {
            background: var(--bg-secondary);
            border: 1px solid #555;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .mini-game {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 2px solid #666;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .game-title {
            color: var(--accent-blood);
            font-size: 14px;
            margin-bottom: 15px;
            text-align: center;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .choice-button {
            padding: 15px 12px;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border: 1px solid #555;
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .choice-button:hover {
            border-color: var(--text-primary);
            box-shadow: 0 0 15px var(--glow-red);
            transform: translateY(-2px);
        }

        .choice-button.dangerous {
            border-color: var(--accent-blood);
            background: linear-gradient(135deg, rgba(204, 0, 0, 0.1), var(--bg-tertiary));
        }

        .choice-button.dangerous:hover {
            box-shadow: 0 0 20px rgba(204, 0, 0, 0.5);
        }

        .choice-button.full-width {
            grid-column: span 2;
        }

        .progress-tracker {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }

        .progress-step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #444;
            border: 2px solid #666;
            transition: all 0.3s;
        }

        .progress-step.completed {
            background: var(--accent-blood);
            border-color: var(--accent-blood);
            box-shadow: 0 0 10px var(--accent-blood);
        }

        .progress-step.active {
            background: var(--text-primary);
            border-color: var(--text-primary);
            animation: stepPulse 1.5s infinite;
        }

        @keyframes stepPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .fear-meter {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #555;
            border-radius: 6px;
            padding: 10px;
            font-size: 10px;
            z-index: 100;
        }

        .fear-bar {
            width: 70px;
            height: 8px;
            background: #333;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }

        .fear-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--text-primary), var(--accent-blood));
            width: 0%;
            transition: width 0.8s ease;
        }

        .choices-container {
            padding: 16px;
            border-top: 1px solid #444;
            background: var(--bg-tertiary);
        }

        .interaction-hint {
            text-align: center;
            color: var(--accent-blood);
            font-size: 11px;
            margin-bottom: 12px;
            animation: hintPulse 2s infinite;
        }

        @keyframes hintPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .crawling-animation {
            position: absolute;
            width: 40px;
            height: 20px;
            background: var(--accent-blood);
            border-radius: 50% 50% 0 0;
            opacity: 0.2;
            animation: crawl 6s linear infinite;
        }

        @keyframes crawl {
            0% { left: -40px; bottom: 10px; }
            50% { left: 50%; bottom: 15px; transform: scaleX(-1); }
            100% { left: calc(100% + 40px); bottom: 10px; transform: scaleX(-1); }
        }

        .phone-vibration {
            animation: phoneVibrate 0.1s infinite;
        }

        @keyframes phoneVibrate {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-1px); }
            75% { transform: translateX(1px); }
        }

        .hidden { display: none; }

        /* Специальные эффекты для каждой легенды */
        .teke-teke-effect {
            background: linear-gradient(45deg, 
                rgba(204, 0, 0, 0.1) 0%, 
                transparent 50%, 
                rgba(204, 0, 0, 0.1) 100%);
        }

        .okiku-effect {
            background: radial-gradient(circle at center, 
                rgba(255, 238, 238, 0.1) 0%, 
                transparent 70%);
        }

        .phone-call-effect {
            background: linear-gradient(180deg, 
                rgba(68, 136, 255, 0.1) 0%, 
                transparent 100%);
        }
    </style>
</head>
<body>
    <div class="teke-sound" id="tekeSound">テケテケ... テケテケ...</div>
    
    <div class="fear-meter">
        <div class="japanese-text">恐怖度</div>
        <div class="fear-bar">
            <div class="fear-fill" id="fearFill"></div>
        </div>
    </div>

    <div class="phone-container" id="phoneContainer">
        <div class="screen">
            <div class="phone-header">
                <div class="carrier-info">
                    <div class="signal-strength">
                        <div class="signal-bar active"></div>
                        <div class="signal-bar active"></div>
                        <div class="signal-bar"></div>
                        <div class="signal-bar"></div>
                    </div>
                    <span class="japanese-text" style="font-size: 10px;">DoCoMo</span>
                </div>
                <div class="battery-indicator">05% ⚠️</div>
            </div>

            <div id="gameContent" class="content-area">
                <!-- Контент загружается динамически -->
            </div>

            <div id="choicesContainer" class="choices-container">
                <div class="interaction-hint japanese-text">システム読み込み中...</div>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram?.WebApp;
        if (tg) {
            tg.ready();
            tg.expand();
            tg.setHeaderColor('#0d0d14');
            tg.setBackgroundColor('#0d0d14');
        }

        class TokyoLegendsGame {
            constructor() {
                this.gameContent = document.getElementById('gameContent');
                this.choicesContainer = document.getElementById('choicesContainer');
                this.fearLevel = 0;
                this.gameState = {
                    currentLegend: null,
                    chapter: 0,
                    choices: [],
                    playerName: '',
                    completedLegends: [],
                    secretsFound: [],
                    jumpScares: 0
                };

                this.legends = {
                    teke_teke: {
                        title: 'テケテケ (Тэкэ-тэкэ)',
                        subtitle: 'Девушка без ног',
                        description: 'Дух школьницы, разрезанной поездом, ползает на руках по железнодорожным путям и издает звук "тэкэ-тэкэ"',
                        chapters: 4,
                        difficulty: 'extreme'
                    },
                    okiku: {
                        title: 'お菊さん (Окику-сан)',
                        subtitle: 'Дух из туалета',
                        description: 'Призрак девушки, убитой в многоэтажке, обитает в женских туалетах бизнес-центров Токио',
                        chapters: 3,
                        difficulty: 'hard'
                    },
                    moshi_moshi: {
                        title: 'もしもし (Моши-моши)',
                        subtitle: 'Звонки с того света',
                        description: 'В 03:00 можно получить звонок с неизвестного номера, где слышишь свой собственный голос',
                        chapters: 3,
                        difficulty: 'medium'
                    }
                };

                if (tg?.initDataUnsafe?.user) {
                    this.gameState.playerName = tg.initDataUnsafe.user.first_name || 'Исследователь';
                }

                this.init();
            }

            init() {
                this.showLegendSelector();
            }

            showLegendSelector() {
                this.gameContent.innerHTML = `
                    <div style="text-align: center; margin-bottom: 25px;">
                        <h1 style="font-size: 20px; color: var(--accent-blood); margin-bottom: 10px;">
                            <span class="japanese-symbol">怖</span>ГОРОДСКИЕ ЛЕГЕНДЫ ТОКИО
                        </h1>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            2005 год • Выберите историю для расследования
                        </div>
                    </div>

                    <div style="background: rgba(204, 0, 0, 0.1); border: 1px solid var(--accent-blood); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="color: var(--accent-blood); font-size: 11px; font-weight: bold; margin-bottom: 8px;">⚠️ ПРЕДУПРЕЖДЕНИЕ</div>
                        <div style="font-size: 10px;">
                            Найден телефон с записями о паранормальных явлениях в Токио. 
                            Каждая история основана на реальных городских легендах. 
                            Просмотр на ваш страх и риск.
                        </div>
                    </div>

                    <div class="legend-selector">
                        ${Object.entries(this.legends).map(([key, legend]) => `
                            <div class="legend-card" onclick="game.selectLegend('${key}')">
                                <div class="legend-title">${legend.title}</div>
                                <div class="legend-subtitle">${legend.subtitle}</div>
                                <div class="legend-description">${legend.description}</div>
                                <div style="margin-top: 12px; display: flex; justify-content: between; align-items: center;">
                                    <span style="font-size: 10px; color: var(--text-secondary);">
                                        ${legend.chapters} глав • ${this.getDifficultyLabel(legend.difficulty)}
                                    </span>
                                    ${this.gameState.completedLegends.includes(key) ? 
                                        '<span style="color: var(--accent-blood); font-size: 10px;">✓ Пройдено</span>' : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <div style="font-size: 10px; color: var(--text-secondary);">
                            Рекомендуется играть в темноте с наушниками
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '📱 Информация об устройстве',
                        action: () => this.showDeviceInfo(),
                        description: 'Техническая информация'
                    }
                ]);
            }

            selectLegend(legendKey) {
                this.gameState.currentLegend = legendKey;
                this.gameState.chapter = 1;
                this.updateFearLevel(10);

                switch(legendKey) {
                    case 'teke_teke':
                        this.startTekeTekeStory();
                        break;
                    case 'okiku':
                        this.startOkikuStory();
                        break;
                    case 'moshi_moshi':
                        this.startMoshiMoshiStory();
                        break;
                }
            }

            // ИСТОРИЯ ТЭКЭ-ТЭКЭ
            startTekeTekeStory() {
                this.addCrawlingAnimation();
                this.playTekeSound();
                
                this.gameContent.innerHTML = `
                    <div class="chapter-container teke-teke-effect">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">テ</span>ТЭКЭ-ТЭКЭ</h2>
                            <div class="subtitle">Глава 1: Станция Сибуя • 23:45</div>
                        </div>

                        <div class="story-log">
                            <div class="log-header">
                                <span>📱 Запись от лица Аяки Мори (森彩香)</span>
                                <span>12.10.05</span>
                            </div>
                            <div class="log-content">
                                Возвращалась домой последним поездом. Платформа пустая, только я и еще пара человек.
                                <br><br>
                                Вдруг услышала странный звук со стороны путей: "тэкэ-тэкэ... тэкэ-тэкэ..."
                                <br><br>
                                Как будто кто-то скребет руками по бетону.
                            </div>
                        </div>

                        <div class="interactive-element">
                            <div style="color: var(--accent-blood); margin-bottom: 15px;">
                                🎮 Что вы слышите в наушниках?
                            </div>
                            <div class="choice-grid">
                                <button class="choice-button" onclick="game.tekeChoice('sound1')">
                                    🔊 Царапание по металлу
                                </button>
                                <button class="choice-button" onclick="game.tekeChoice('sound2')">
                                    👥 Шепот нескольких голосов
                                </button>
                                <button class="choice-button" onclick="game.tekeChoice('sound3')">
                                    🚂 Приближающийся поезд
                                </button>
                                <button class="choice-button" onclick="game.tekeChoice('sound4')">
                                    💀 Тэкэ-тэкэ... тэкэ-тэкэ...
                                </button>
                            </div>
                        </div>

                        <div class="progress-tracker">
                            <div class="progress-step active"></div>
                            <div class="progress-step"></div>
                            <div class="progress-step"></div>
                            <div class="progress-step"></div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '⏳ Выберите звук в мини-игре выше',
                        action: () => {},
                        description: 'Сначала определите, что слышите'
                    }
                ]);
            }

            tekeChoice(choice) {
                if (choice === 'sound4') {
                    this.updateFearLevel(25);
                    this.tekeChapter2();
                } else {
                    this.updateFearLevel(15);
                    this.showJumpScare('Неправильно! Тэкэ-тэкэ уже рядом!');
                    setTimeout(() => this.tekeChapter2(), 2000);
                }
            }

            tekeChapter2() {
                this.gameState.chapter = 2;
                this.addCrawlingAnimation();
                
                this.gameContent.innerHTML = `
                    <div class="chapter-container teke-teke-effect">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">這</span>ПОЛЗУЩАЯ ТЕНЬ</h2>
                            <div class="subtitle">Глава 2: Железнодорожные пути • 00:10</div>
                        </div>

                        <div class="story-log corrupted">
                            <div class="log-header">
                                <span>📱 Экстренная запись • Аяки</span>
                                <span>12.10.05</span>
                            </div>
                            <div class="log-content">
                                Я спустилась к путям посмотреть, что там. ОШИБКА!
                                <br><br>
                                Между рельсами... девушка. Или то, что от неё осталось. 
                                Верхняя половина тела ползёт на руках.
                                <br><br>
                                <span style="color: var(--accent-blood);">Её ноги отрезаны на уровне талии.</span>
                                <br><br>
                                Она заметила меня. Поворачивается. Улыбается...
                            </div>
                        </div>

                        <div class="mini-game">
                            <div class="game-title">⚡ РЕАКЦИЯ: Тэкэ-тэкэ приближается!</div>
                            <div style="position: relative; height: 80px; background: var(--bg-tertiary); border-radius: 8px; margin: 15px 0; overflow: hidden;">
                                <div id="tekeSprite" style="position: absolute; width: 50px; height: 30px; background: var(--accent-blood); left: 0; top: 25px; border-radius: 50% 50% 0 0; transition: left 3s linear;">
                                    <div style="position: absolute; top: 5px; left: 10px; width: 6px; height: 6px; background: #fff; border-radius: 50%;"></div>
                                    <div style="position: absolute; top: 5px; right: 10px; width: 6px; height: 6px; background: #fff; border-radius: 50%;"></div>
                                </div>
                                <div style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); font-size: 24px;">🏃‍♀️</div>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button class="choice-button" onclick="game.tekeReaction('run')" style="flex: 1;">
                                    🏃‍♀️ БЕЖАТЬ!
                                </button>
                                <button class="choice-button dangerous" onclick="game.tekeReaction('look')" style="flex: 1;">
                                    👀 Смотреть на неё
                                </button>
                            </div>
                            <div id="reactionResult" style="text-align: center; margin-top: 10px; font-size: 11px;"></div>
                        </div>

                        <div class="progress-tracker">
                            <div class="progress-step completed"></div>
                            <div class="progress-step active"></div>
                            <div class="progress-step"></div>
                            <div class="progress-step"></div>
                        </div>
                    </div>
                `;

                // Запускаем анимацию приближения
                setTimeout(() => {
                    const sprite = document.getElementById('tekeSprite');
                    if (sprite) sprite.style.left = 'calc(100% - 60px)';
                }, 500);

                this.setChoices([
                    {
                        text: '⏳ Принимайте решение быстро!',
                        action: () => {},
                        description: 'Тэкэ-тэкэ приближается...'
                    }
                ]);
            }

            tekeReaction(action) {
                const result = document.getElementById('reactionResult');
                
                if (action === 'run') {
                    result.textContent = '✅ Вы убежали! Но тэкэ-тэкэ запомнила вас...';
                    result.style.color = 'var(--text-primary)';
                    this.updateFearLevel(40);
                    setTimeout(() => this.tekeChapter3(), 2000);
                } else {
                    result.textContent = '❌ Вы посмотрели ей в глаза... Теперь она будет преследовать вас вечно!';
                    result.style.color = 'var(--accent-blood)';
                    this.updateFearLevel(60);
                    this.showJumpScare('Тэкэ-тэкэ: "Теперь ты моя..."');
                    setTimeout(() => this.tekeChapter3(), 3000);
                }
            }

            tekeChapter3() {
                this.gameState.chapter = 3;
                
                this.gameContent.innerHTML = `
                    <div class="chapter-container">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">終</span>НЕИЗБЕЖНАЯ СУДЬБА</h2>
                            <div class="subtitle">Глава 3: Ваша квартира • 03:00</div>
                        </div>

                        <div class="story-log corrupted">
                            <div class="log-header">
                                <span>📱 Последняя запись • Аяки</span>
                                <span>13.10.05</span>
                            </div>
                            <div class="log-content">
                                Я дома, но чувствую, что она следует за мной. 
                                <br><br>
                                Каждую ночь слышу "тэкэ-тэкэ" под окнами. Она ползёт по стенам здания.
                                <br><br>
                                Сегодня нашла царапины на двери. Длинные, от ногтей.
                                <br><br>
                                <span style="color: var(--accent-blood);">Она поднимается по лестнице. К моему этажу...</span>
                            </div>
                        </div>

                        <div class="story-log">
                            <div class="log-content" style="text-align: center; font-style: italic;">
                                <span style="color: var(--accent-blood); font-size: 16px;">
                                    "Тэкэ-тэкэ... тэкэ-тэкэ..."
                                </span>
                                <br><br>
                                <span style="font-size: 11px; color: var(--text-secondary);">
                                    [СТУК В ДВЕРЬ]
                                </span>
                            </div>
                        </div>

                        <div class="progress-tracker">
                            <div class="progress-step completed"></div>
                            <div class="progress-step completed"></div>
                            <div class="progress-step completed"></div>
                            <div class="progress-step active"></div>
                        </div>
                    </div>
                `;

                this.updateFearLevel(80);
                
                this.setChoices([
                    {
                        text: '🚪 Открыть дверь',
                        action: () => this.tekeEnding('open'),
                        description: 'Встретиться с судьбой лицом к лицу',
                        dangerous: true
                    },
                    {
                        text: '🔇 Не отвечать',
                        action: () => this.tekeEnding('hide'),
                        description: 'Попытаться спрятаться'
                    },
                    {
                        text: '📞 Позвонить в полицию',
                        action: () => this.tekeEnding('police'),
                        description: 'Обратиться за помощью'
                    },
                    {
                        text: '🏃‍♀️ Убежать через окно',
                        action: () => this.tekeEnding('escape'),
                        description: 'Экстремальный побег',
                        dangerous: true
                    }
                ]);
            }

            tekeEnding(choice) {
                this.updateFearLevel(100);
                this.gameState.completedLegends.push('teke_teke');
                
                let endingContent = '';
                
                switch(choice) {
                    case 'open':
                        endingContent = `
                            <div class="story-log corrupted">
                                <div class="log-content">
                                    Вы открываете дверь. Тэкэ-тэкэ ползёт к вам по полу коридора.
                                    <br><br>
                                    "Наконец-то мы встретились," - шепчет она. "Теперь я не одинока..."
                                    <br><br>
                                    <span style="color: var(--accent-blood);">
                                        Ваши ноги становятся холодными. Очень холодными...
                                    </span>
                                </div>
                            </div>
                        `;
                        break;
                    case 'hide':
                        endingContent = `
                            <div class="story-log">
                                <div class="log-content">
                                    Вы молчите. Стук прекращается.
                                    <br><br>
                                    Тишина длится час. Два. К утру она исчезает.
                                    <br><br>
                                    Но теперь вы знаете - она вернётся. Каждую ночь в 03:00...
                                </div>
                            </div>
                        `;
                        break;
                    case 'police':
                        endingContent = `
                            <div class="story-log">
                                <div class="log-content">
                                    Полиция приезжает, но не находит никого. 
                                    <br><br>
                                    "Возможно, это розыгрыш," - говорят они.
                                    <br><br>
                                    Но на двери остались царапины. Очень глубокие царапины...
                                </div>
                            </div>
                        `;
                        break;
                    case 'escape':
                        endingContent = `
                            <div class="story-log corrupted">
                                <div class="log-content">
                                    Вы выпрыгиваете в окно. Падение с третьего этажа...
                                    <br><br>
                                    Ваши ноги сломаны. Вы ползёте по асфальту на руках.
                                    <br><br>
                                    <span style="color: var(--accent-blood);">
                                        "Тэкэ-тэкэ... тэкэ-тэкэ..." - теперь этот звук издаёте вы...
                                    </span>
                                </div>
                            </div>
                        `;
                        break;
                }

                this.gameContent.innerHTML = `
                    <div class="chapter-container">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">終</span>ФИНАЛ</h2>
                            <div class="subtitle">История Тэкэ-тэкэ завершена</div>
                        </div>

                        ${endingContent}

                        <div style="text-align: center; margin: 20px 0; padding: 15px; background: rgba(255, 68, 68, 0.1); border-radius: 8px;">
                            <div style="color: var(--text-primary); margin-bottom: 10px;">
                                📊 СТАТИСТИКА ПРОХОЖДЕНИЯ
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                Уровень страха: ${this.fearLevel}%<br>
                                Концовка: ${this.getEndingName(choice)}<br>
                                Легенд пройдено: ${this.gameState.completedLegends.length}/3
                            </div>
                        </div>

                        <div class="progress-tracker">
                            <div class="progress-step completed"></div>
                            <div class="progress-step completed"></div>
                            <div class="progress-step completed"></div>
                            <div class="progress-step completed"></div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '👻 Попробовать другую легенду',
                        action: () => this.showLegendSelector(),
                        description: 'Вернуться к выбору историй'
                    },
                    {
                        text: '🔄 Пройти Тэкэ-тэкэ заново',
                        action: () => this.startTekeTekeStory(),
                        description: 'Изменить свою судьбу'
                    },
                    {
                        text: '🎓 Изучить тату-мастерство',
                        action: () => this.showCoursesOverview(),
                        description: 'Переключиться на созидательное искусство'
                    }
                ]);
            }

            // ИСТОРИЯ ОКИКУ-САН
            startOkikuStory() {
                this.gameContent.innerHTML = `
                    <div class="chapter-container okiku-effect">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">菊</span>ОКИКУ-САН</h2>
                            <div class="subtitle">Глава 1: Бизнес-центр Синдзюку • 22:30</div>
                        </div>

                        <div class="story-log bathroom">
                            <div class="log-header">
                                <span>📱 Запись сотрудницы Юки Сато (佐藤雪)</span>
                                <span>25.10.05</span>
                            </div>
                            <div class="log-content">
                                Работаю допоздна в 47-этажном бизнес-центре. Все разошлись по домам.
                                <br><br>
                                Иду в женский туалет на 30-м этаже. Слышу из последней кабинки царапание.
                                <br><br>
                                Кто-то скребёт ногтями по металлической перегородке изнутри...
                            </div>
                        </div>

                        <div class="interactive-element">
                            <div style="color: var(--accent-pale); margin-bottom: 15px;">
                                🚪 Что делать с подозрительной кабинкой?
                            </div>
                            <div class="choice-grid">
                                <button class="choice-button" onclick="game.okikuChoice('ignore')">
                                    🚶‍♀️ Проигнорировать
                                </button>
                                <button class="choice-button dangerous" onclick="game.okikuChoice('ask')">
                                    💬 Спросить "Окику, ты здесь?"
                                </button>
                                <button class="choice-button" onclick="game.okikuChoice('call')">
                                    📞 Вызвать охрану
                                </button>
                                <button class="choice-button dangerous" onclick="game.okikuChoice('open')">
                                    🔓 Открыть кабинку
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                this.updateFearLevel(20);
                this.setChoices([
                    {
                        text: '⏳ Выберите действие в мини-игре',
                        action: () => {},
                        description: 'Каждый выбор влияет на развитие истории'
                    }
                ]);
            }

            okikuChoice(choice) {
                let nextChapter = '';
                
                switch(choice) {
                    case 'ask':
                        this.updateFearLevel(50);
                        nextChapter = 'Вы трижды спрашиваете "Окику, ты здесь?" Царапание усиливается...';
                        break;
                    case 'open':
                        this.updateFearLevel(60);
                        nextChapter = 'Кабинка пуста, но на стенах свежие царапины от ногтей...';
                        break;
                    case 'ignore':
                        this.updateFearLevel(30);
                        nextChapter = 'Вы уходите, но звук следует за вами по коридору...';
                        break;
                    case 'call':
                        this.updateFearLevel(40);
                        nextChapter = 'Охранник не находит никого, но камеры зафиксировали странные кадры...';
                        break;
                }

                setTimeout(() => this.okikuChapter2(choice), 2000);
            }

            // ИСТОРИЯ МОШИ-МОШИ
            startMoshiMoshiStory() {
                this.makePhoneVibrate();
                
                this.gameContent.innerHTML = `
                    <div class="chapter-container phone-call-effect">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">電</span>МОШИ-МОШИ</h2>
                            <div class="subtitle">Глава 1: Звонок в 03:00</div>
                        </div>

                        <div class="story-log phone-call">
                            <div class="log-header">
                                <span>📱 Запись студента Кэнта Иноуэ (井上健太)</span>
                                <span>08.11.05</span>
                            </div>
                            <div class="log-content">
                                Получил странное письмо по электронной почте. Цепочка: 
                                "Если хочешь услышать свой голос из прошлого, не спи в 03:00..."
                                <br><br>
                                Глупости, конечно. Но сейчас 02:58, и я не могу заснуть.
                                <br><br>
                                Телефон лежит рядом. Ждёт...
                            </div>
                        </div>

                        <div style="text-align: center; margin: 20px 0; padding: 20px; background: var(--bg-secondary); border-radius: 8px; position: relative;">
                            <div style="font-size: 36px; color: var(--accent-blue); margin-bottom: 10px;" id="digitalClock">03:00</div>
                            <div style="font-size: 12px; color: var(--text-secondary);">Текущее время</div>
                            <div id="phoneRing" style="position: absolute; top: 10px; right: 10px; font-size: 20px; opacity: 0; animation: phoneRingAnimation 1s infinite;">📞</div>
                        </div>

                        <div class="interactive-element">
                            <div style="color: var(--accent-blue); margin-bottom: 15px; text-align: center;">
                                📞 ТЕЛЕФОН ЗВОНИТ!
                            </div>
                            <button class="choice-button full-width" onclick="game.answerPhone()" style="font-size: 16px; padding: 20px;">
                                📱 ОТВЕТИТЬ НА ЗВОНОК
                            </button>
                        </div>
                    </div>
                `;

                // Анимация звонка
                setTimeout(() => {
                    const ring = document.getElementById('phoneRing');
                    if (ring) ring.style.opacity = '1';
                }, 1000);

                this.updateFearLevel(25);
                this.setChoices([
                    {
                        text: '📞 Используйте кнопку выше для ответа',
                        action: () => {},
                        description: 'Кто-то звонит вам в 03:00...'
                    }
                ]);
            }

            answerPhone() {
                this.makePhoneVibrate();
                this.updateFearLevel(70);
                
                this.gameContent.innerHTML = `
                    <div class="chapter-container phone-call-effect">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">声</span>СВОЙ ГОЛОС</h2>
                            <div class="subtitle">Глава 2: Разговор с собой</div>
                        </div>

                        <div class="story-log phone-call">
                            <div class="log-content" style="text-align: center;">
                                <div style="font-size: 14px; margin-bottom: 15px;">📞 ЛИНИЯ АКТИВНА</div>
                                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <div style="color: var(--accent-blue);">Незнакомец:</div>
                                    <div style="font-style: italic;">"Моши-моши... моши-моши..."</div>
                                </div>
                                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <div style="color: var(--text-primary);">Вы:</div>
                                    <div>"Кто это? Откуда у вас мой номер?"</div>
                                </div>
                                <div style="background: var(--bg-primary); padding: 15px; border-radius: 8px; margin: 10px 0;">
                                    <div style="color: var(--accent-blood);">Незнакомец (ваш голос):</div>
                                    <div style="font-style: italic;">"Кто это? Откуда у вас мой номер?"</div>
                                </div>
                            </div>
                        </div>

                        <div style="background: rgba(204, 0, 0, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; text-align: center;">
                            <div style="color: var(--accent-blood); font-size: 12px; margin-bottom: 8px;">
                                ⚠️ АНОМАЛИЯ ОБНАРУЖЕНА
                            </div>
                            <div style="font-size: 11px;">
                                Голос в трубке повторяет ваши слова с задержкой в 3 секунды.
                                Но вы произносили их 5 лет назад...
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '📞 Продолжить разговор',
                        action: () => this.moshiEnding('continue'),
                        description: 'Выяснить правду о звонке',
                        dangerous: true
                    },
                    {
                        text: '📵 Повесить трубку',
                        action: () => this.moshiEnding('hangup'),
                        description: 'Прервать аномальную связь'
                    },
                    {
                        text: '📝 Записать разговор',
                        action: () => this.moshiEnding('record'),
                        description: 'Сохранить доказательства'
                    }
                ]);
            }

            moshiEnding(choice) {
                this.updateFearLevel(100);
                this.gameState.completedLegends.push('moshi_moshi');
                
                let endingContent = '';
                
                switch(choice) {
                    case 'continue':
                        endingContent = `
                            <div class="story-log phone-call">
                                <div class="log-content">
                                    Вы продолжаете разговор с собой из прошлого.
                                    <br><br>
                                    Голос рассказывает о событиях, которые произойдут с вами.
                                    О каждом дне следующих пяти лет.
                                    <br><br>
                                    <span style="color: var(--accent-blood);">
                                        Последние слова: "Завтра ты умрёшь в 15:30..."
                                    </span>
                                </div>
                            </div>
                        `;
                        break;
                    case 'hangup':
                        endingContent = `
                            <div class="story-log">
                                <div class="log-content">
                                    Вы кладёте трубку. Тишина.
                                    <br><br>
                                    Но теперь каждую ночь в 03:00 телефон звонит.
                                    И каждый раз голос становится всё более...реальным.
                                </div>
                            </div>
                        `;
                        break;
                    case 'record':
                        endingContent = `
                            <div class="story-log">
                                <div class="log-content">
                                    Запись получилась. Но при прослушивании слышен только ваш голос.
                                    <br><br>
                                    Вы разговариваете сами с собой. 20 минут монолога...
                                    <br><br>
                                    О вещах, которые случатся через 5 лет.
                                </div>
                            </div>
                        `;
                        break;
                }

                this.showLegendEnding('moshi_moshi', endingContent);
            }

            showLegendEnding(legendKey, content) {
                this.gameContent.innerHTML = `
                    <div class="chapter-container">
                        <div class="chapter-title">
                            <h2><span class="japanese-symbol">終</span>ФИНАЛ</h2>
                            <div class="subtitle">${this.legends[legendKey].title} завершён</div>
                        </div>

                        ${content}

                        <div style="text-align: center; margin: 20px 0; padding: 15px; background: rgba(255, 68, 68, 0.1); border-radius: 8px;">
                            <div style="color: var(--text-primary); margin-bottom: 10px;">
                                🏆 ЛЕГЕНДА ИЗУЧЕНА
                            </div>
                            <div style="font-size: 11px; color: var(--text-secondary);">
                                Страх: ${this.fearLevel}% • Пройдено: ${this.gameState.completedLegends.length}/3
                            </div>
                        </div>
                    </div>
                `;

                const choices = [
                    {
                        text: '🔮 Другие легенды Токио',
                        action: () => this.showLegendSelector(),
                        description: 'Исследовать новые тайны'
                    }
                ];

                if (this.gameState.completedLegends.length >= 2) {
                    choices.push({
                        text: '🎓 Изучить тату-мастерство',
                        action: () => this.showCoursesOverview(),
                        description: 'От мистики к искусству'
                    });
                }

                this.setChoices(choices);
            }

            // ОБЗОР КУРСОВ (появляется после прохождения нескольких легенд)
            showCoursesOverview() {
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 25px;">
                            <h2 style="font-size: 18px; color: var(--text-primary);">
                                <span class="japanese-symbol">学</span>АКАДЕМИЯ ТАТУ-МАСТЕРСТВА
                            </h2>
                            <div style="font-size: 12px; color: var(--text-secondary);">
                                От городских легенд к созидательному искусству
                            </div>
                        </div>

                        <div class="story-log">
                            <div class="log-content">
                                Погружение в мистические истории Токио показало тёмную сторону города. 
                                Но есть и светлая - искусство татуировки, которое превращает страхи в красоту.
                            </div>
                        </div>

                        <div style="background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(68, 136, 255, 0.1)); border: 1px solid var(--text-primary); border-radius: 10px; padding: 20px; margin: 20px 0;">
                            <div style="font-size: 14px; font-weight: bold; margin-bottom: 15px; color: var(--text-primary); text-align: center;">
                                ДОСТУПНЫЕ КУРСЫ:
                            </div>
                            
                            <div style="margin: 12px 0; padding: 15px; background: rgba(204, 0, 0, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold;">Полный курс тату-мастера</div>
                                <div style="font-size: 11px; margin: 5px 0;">Теория + видео + наставничество • 1-2 месяца</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="text-decoration: line-through; opacity: 0.6;">45,000₽</span>
                                    <span style="font-size: 16px; font-weight: bold; color: var(--accent-blood);">22,500₽</span>
                                </div>
                            </div>

                            <div style="margin: 12px 0; padding: 15px; background: rgba(68, 136, 255, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold;">SMM для тату-мастеров</div>
                                <div style="font-size: 11px; margin: 5px 0;">Instagram, TikTok, продвижение • 3 недели</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="text-decoration: line-through; opacity: 0.6;">25,000₽</span>
                                    <span style="font-size: 16px; font-weight: bold; color: var(--accent-blue);">12,500₽</span>
                                </div>
                            </div>

                            <div style="margin: 12px 0; padding: 15px; background: rgba(255, 238, 238, 0.1); border-radius: 8px;">
                                <div style="font-weight: bold;">Procreate для эскизов</div>
                                <div style="font-size: 11px; margin: 5px 0;">Цифровое рисование тату-эскизов</div>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="text-decoration: line-through; opacity: 0.6;">15,000₽</span>
                                    <span style="font-size: 16px; font-weight: bold; color: var(--accent-pale);">7,500₽</span>
                                </div>
                            </div>
                        </div>

                        <div style="text-align: center; padding: 15px; background: var(--bg-secondary); border-radius: 8px; margin: 15px 0;">
                            <div style="color: var(--accent-blood); font-size: 14px; margin-bottom: 8px;">🎁 ПРОМОКОД</div>
                            <div style="font-size: 20px; font-weight: bold; letter-spacing: 3px; color: var(--text-primary);">
                                LEGENDS50
                            </div>
                            <div style="font-size: 10px; margin-top: 5px; color: var(--text-secondary);">
                                Скидка 50% + бесплатная консультация
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '📋 Скопировать промокод',
                        action: () => {
                            if (navigator.clipboard) {
                                navigator.clipboard.writeText('LEGENDS50');
                            }
                            this.showNotification('Промокод LEGENDS50 скопирован!');
                        },
                        description: 'Сохранить в буфер обмена'
                    },
                    {
                        text: '💬 Консультация с мастером',
                        action: () => this.contactSupport(),
                        description: 'Получить персональную помощь'
                    },
                    {
                        text: '👻 Вернуться к легендам',
                        action: () => this.showLegendSelector(),
                        description: 'Продолжить исследование'
                    }
                ]);
            }

            // СЛУЖЕБНЫЕ МЕТОДЫ
            updateFearLevel(level) {
                this.fearLevel = Math.min(100, level);
                const fill = document.getElementById('fearFill');
                if (fill) {
                    fill.style.width = this.fearLevel + '%';
                }
            }

            setChoices(choices) {
                this.choicesContainer.innerHTML = `
                    <div class="interaction-hint">Выберите действие:</div>
                    ${choices.map(choice => `
                        <button class="choice-button ${choice.dangerous ? 'dangerous' : ''}" data-action="${choice.text}">
                            ${choice.text}
                            ${choice.description ? `<div style="font-size: 10px; opacity: 0.7; margin-top: 5px;">${choice.description}</div>` : ''}
                        </button>
                    `).join('')}
                `;

                const buttons = this.choicesContainer.querySelectorAll('.choice-button');
                buttons.forEach((button, index) => {
                    button.onclick = choices[index].action;
                });
            }

            addCrawlingAnimation() {
                const crawler = document.createElement('div');
                crawler.className = 'crawling-animation';
                this.gameContent.appendChild(crawler);
                
                setTimeout(() => {
                    if (crawler.parentNode) crawler.remove();
                }, 6000);
            }

            playTekeSound() {
                const sound = document.getElementById('tekeSound');
                if (sound) {
                    sound.style.opacity = '1';
                    setTimeout(() => {
                        sound.style.opacity = '0';
                    }, 3000);
                }
            }

            makePhoneVibrate() {
                const phone = document.getElementById('phoneContainer');
                if (phone) {
                    phone.classList.add('phone-vibration');
                    setTimeout(() => {
                        phone.classList.remove('phone-vibration');
                    }, 2000);
                }
            }

            showJumpScare(text) {
                const scare = document.createElement('div');
                scare.style.cssText = `
                    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                    background: var(--accent-blood); color: white; z-index: 10000;
                    display: flex; align-items: center; justify-content: center;
                    font-size: 18px; font-weight: bold; text-align: center;
                    animation: jumpScare 0.5s ease-out;
                `;
                scare.textContent = text;
                document.body.appendChild(scare);
                
                setTimeout(() => scare.remove(), 1500);
            }

            showNotification(text) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed; top: 50px; right: 20px; 
                    background: var(--text-primary); color: black; 
                    padding: 12px 16px; border-radius: 8px; 
                    z-index: 1000; font-size: 12px;
                    box-shadow: 0 0 20px var(--glow-red);
                `;
                notification.textContent = text;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }

            getDifficultyLabel(difficulty) {
                const labels = {
                    'easy': '😌 Легко',
                    'medium': '😰 Средне', 
                    'hard': '😱 Сложно',
                    'extreme': '💀 Экстрим'
                };
                return labels[difficulty] || '❓ Неизвестно';
            }

            getEndingName(choice) {
                const names = {
                    'open': 'Встреча с судьбой',
                    'hide': 'Временное спасение',
                    'police': 'Скептическое расследование',
                    'escape': 'Проклятый побег',
                    'continue': 'Знание будущего',
                    'hangup': 'Бесконечные звонки',
                    'record': 'Доказательства безумия'
                };
                return names[choice] || 'Неизвестная судьба';
            }

            contactSupport() {
                if (tg) {
                    tg.openTelegramLink('https://t.me/your_tattoo_master');
                }
            }

            showDeviceInfo() {
                this.gameContent.innerHTML = `
                    <div>
                        <div style="text-align: center; margin-bottom: 20px;">
                            <h2 style="font-size: 16px; color: var(--accent-blue);">
                                <span class="japanese-symbol">機</span>ИНФОРМАЦИЯ ОБ УСТРОЙСТВЕ
                            </h2>
                        </div>

                        <div class="story-log">
                            <div class="log-content">
                                <strong>Модель:</strong> DoCoMo FOMA P901i (2005)<br>
                                <strong>Владелец:</strong> Неизвестно (данные повреждены)<br>
                                <strong>Статус:</strong> Найден в Токио<br>
                                <strong>Память:</strong> 100MB (аномальные данные)<br>
                                <strong>GPS:</strong> Показывает несуществующие места<br>
                                <strong>Связь:</strong> Принимает звонки из прошлого
                            </div>
                        </div>

                        <div class="story-log corrupted">
                            <div class="log-content">
                                ⚠️ <strong>АНОМАЛИИ:</strong><br>
                                • Записи появляются самостоятельно<br>
                                • Камера снимает призраков<br>
                                • Телефон звонит мёртвым людям<br>
                                • Батарея не разряжается
                            </div>
                        </div>
                    </div>
                `;

                this.setChoices([
                    {
                        text: '👻 К городским легендам',
                        action: () => this.showLegendSelector(),
                        description: 'Начать исследование'
                    }
                ]);
            }
        }

        // Инициализация
        let game;
        document.addEventListener('DOMContentLoaded', () => {
            game = new TokyoLegendsGame();
        });

        // Атмосферные эффекты
        setInterval(() => {
            if (Math.random() < 0.03) {
                document.body.style.filter = `hue-rotate(${Math.random() * 30}deg) contrast(${1.1 + Math.random() * 0.2})`;
                setTimeout(() => { document.body.style.filter = 'none'; }, 300);
            }
        }, 8000);

        // CSS для джамп-скэров
        const style = document.createElement('style');
        style.textContent = `
            @keyframes jumpScare {
                0% { opacity: 0; transform: scale(0.8); }
                50% { opacity: 1; transform: scale(1.2); }
                100% { opacity: 1; transform: scale(1); }
            }
            @keyframes phoneRingAnimation {
                0%, 100% { transform: scale(1); opacity: 1; }
                50% { transform: scale(1.2); opacity: 0.7; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
